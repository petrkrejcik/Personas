{"version":3,"sources":["data-provider/google-drive/google-drive-api.js","person/person-actions.js","data-provider/actions.js","app/app-action.js","store/reducer.js","store/store.js","data-provider/google-drive/google-drive-model.js","components/birthday-picker.js","components/icons.js","utils/date.js","person/persons-view.js","router/routes.js","router/router-actions.js","person/persons-model.js","overlay.js","data-provider/data-provider.js","login/login-view.js","header/header.js","person/person-add.js","router/router.js","index.js"],"names":["APP_FOLDER","FILE_NAME","onSignInChangeHandler","Function","fileId","Object","folderId","defaultContent","init","options","setupOptions","console","info","Promise","resolve","reject","gapi","load","initClient","then","defaultContentOption","onSignInChange","client","auth2","getAuthInstance","isSignedIn","listen","updateSignInStatus","get","isInitiated","isLogged","connect","fetchData","signIn","getFolder","getFile","getFileContent","drive","files","list","q","execute","response","length","createFolder","id","metadata","name","mimeType","create","resource","createFile","boundary","delimiter","parents","multipartRequestBody","JSON","stringify","request","alt","error","message","log","result","save","content","path","method","body","fileContent","ACTIONS","edit","SYNC","FETCH","SET","ADD","REMOVE","field","value","type","payload","person","LIB_LOADED","SYNC_ENABLED","IS_LOGGED","LOGIN","setActiveElement","storeActiveElement","el","document","activeElement","key","getAttribute","getActiveElement","querySelector","reducer","state","action","PERSON","persons","concat","filter","personEdit","DATA_PROVIDER","dataProvider","APP","listeners","googleSyncEnabled","isLoading","view","editingPerson","day","month","year","getState","setState","newState","dispatch","forEach","listener","subscribe","callback","push","setup","updateGoogleButton","button","getGoogleSyncButton","addEventListener","connectGoogle","onLibLoaded","onError","fetch","Array","isArray","map","unescape","login","alert","isEnabled","removeAttribute","birthdayPicker","onChange","createOptions","start","end","selected","keys","slice","i","option","createElement","innerText","dayEl","monthEl","yearEl","appendChild","ev","target","remove","parseDate","isoDate","date","Date","getDate","getMonth","getFullYear","createDate","createIso","d","padStart","formatDMY","renderPersons","classList","add","setAttribute","renderPerson","renderEmpty","renderTitle","renderBirthday","renderSeen","seenBefore","renderCustomTexts","customTexts","Boolean","handleEdit","bind","handleRemove","innerHTML","ICONS","renderText","birthday","age","daysToBirthday","birthdayDMY","days","values","clearPersons","render","props","ROUTES","home","go","goToAdd","goToEdit","goToHome","update","updatePersons","getProps","getAge","getDaysToBirthday","getSeenBefore","seen","sort","sortByBirthday","personA","personB","isoDay","now","getTime","diff","Math","abs","getUTCFullYear","round","nowYear","ceil","diffNext","getValidationError","match","resetSeen","confirm","ELEMENTS","overlay","selector","show","loader","singIn","showElement","includes","renderEdit","find","cancel","element","style","GDRIVE","getSelectedStorage","dataProviderFactory","onReady","fetchLib","storageType","eval","text","handleLoginClick","wrap","renderSync","renderAdd","c","renderName","renderPicker","renderSave","placeholder","e","personRest","random","toString","substring","getRoute","window","location","pathname","split","history","pushState","route","app","getElementById","focus","onpopstate","store","Cypress"],"mappings":"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","file":"src.bd3fff1e.js","sourceRoot":"../src","sourcesContent":["// @flow\nconst APP_FOLDER = 'App-Personas'\nconst FILE_NAME = 'persons.json'\nlet onSignInChangeHandler = Function\nlet fileId = Object\nlet folderId = Object\nlet defaultContent = null\n\nconst init = (options = {}) => {\n\tsetupOptions(options)\n\tconsole.info('👉', 'init gdrive')\n\treturn new Promise ((resolve, reject) => {\n\t\tgapi.load('client:auth2', () => {\n\t\t\tinitClient().then(resolve)\n\t\t})\n\t})\n}\n\nconst setupOptions = ({defaultContent: defaultContentOption, onSignInChange}) => {\n\tif (onSignInChange) onSignInChangeHandler = onSignInChange\n\tif (defaultContentOption) defaultContent = defaultContentOption\n}\n\nconst initClient = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tgapi.client.init({\n\t\t\t'apiKey': 'AIzaSyBYItpNT8k2Y2AEHz2E2kI2EqMULh5C4m0',\n\t\t\t'discoveryDocs': ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],\n\t\t\t'clientId': '614338309616-st9nui22tf3sa1cm9m1l3nd439n50frg.apps.googleusercontent.com',\n\t\t\t'scope': 'https://www.googleapis.com/auth/drive.file'\n\t\t})\n\t\t.then(() => {\n\t\t\tgapi.auth2.getAuthInstance().isSignedIn.listen(updateSignInStatus)\n\t\t\tupdateSignInStatus(gapi.auth2.getAuthInstance().isSignedIn.get())\n\t\t\tresolve({isInitiated: true})\n\t\t})\n\t})\n}\n\nconst updateSignInStatus = (isLogged) => {\n\t// TODO: Pass logged user instead of `isLogged`\n\tonSignInChangeHandler(isLogged)\n}\n\nconst connect = () => {\n\tif (gapi.auth2.getAuthInstance().isSignedIn.get()) {\n\t\tfetchData()\n\t} else {\n\t\tgapi.auth2.getAuthInstance().signIn()\n\t}\n}\n\nconst fetchData = () => {\n\t// return Promise.resolve()\n\n\treturn getFolder()\n\t.then(getFile)\n\t.then(getFileContent)\n}\n\nconst getFolder = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst request = gapi.client.drive.files.list({\n\t\t\tq: `name='${APP_FOLDER}' and trashed=false`,\n\t\t})\n\n\t\trequest.execute((response) => {\n\t\t\tif (response.files.length === 0) {\n\t\t\t\tcreateFolder().then(resolve)\n\t\t\t} else {\n\t\t\t\tfolderId = response.files[0].id\n\t\t\t\tresolve()\n\t\t\t}\n\t\t})\n\t})\n}\n\nconst createFolder = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst metadata = {\n\t\t\tname: APP_FOLDER,\n\t\t\tmimeType: 'application/vnd.google-apps.folder'\n\t\t}\n\t\tconst request = gapi.client.drive.files.create({resource: metadata})\n\t\trequest.execute((response) => {\n\t\t\tfolderId = response.id\n\t\t\tresolve()\n\t\t})\n\t})\n}\n\nconst getFile = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst request = gapi.client.drive.files.list({\n\t\t\tq: `name=\"${FILE_NAME}\" and '${folderId}' in parents and trashed=false`,\n\t\t})\n\t\trequest.execute((response) => {\n\t\t\tif (response.files.length === 0) {\n\t\t\t\tcreateFile().then(resolve)\n\t\t\t} else {\n\t\t\t\tfileId = response.files[0].id\n\t\t\t\tresolve()\n\t\t\t}\n\t\t})\n\t})\n}\nconst createFile = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst boundary = '-------314159265358979323846'\n\t\tconst delimiter = \"\\r\\n--\" + boundary + \"\\r\\n\"\n\t\tconst close_delim = \"\\r\\n--\" + boundary + \"--\"\n\n\t\tconst contentType = 'application/json'\n\n\t\tconst metadata = {\n\t\t\tname: FILE_NAME,\n\t\t\tmimeType: contentType,\n\t\t\tparents: [folderId],\n\t\t}\n\n\t\tconst multipartRequestBody =\n\t\t\tdelimiter +\n\t\t\t'Content-Type: application/json\\r\\n\\r\\n' +\n\t\t\tJSON.stringify(metadata) +\n\t\t\tdelimiter +\n\t\t\t'Content-Type: ' + contentType + '\\r\\n\\r\\n' +\n\t\t\t(defaultContent ? JSON.stringify(defaultContent) : '') +\n\t\t\tclose_delim\n\n\t\tconst request = gapi.client.request({\n\t\t\t'path': '/upload/drive/v3/files',\n\t\t\t'method': 'POST',\n\t\t\t'params': {'uploadType': 'multipart'},\n\t\t\t'headers': {\n\t\t\t  'Content-Type': 'multipart/related; boundary=\"' + boundary + '\"'\n\t\t\t},\n\t\t\t'body': multipartRequestBody\n\t\t})\n\n\t\trequest.execute((response) => {\n\t\t\tfileId = response.id\n\t\t\tresolve()\n\t\t})\n\t})\n}\n\nconst getFileContent = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst request = gapi.client.drive.files.get({\n\t\t\tfileId: fileId,\n\t\t\talt: 'media',\n\t\t})\n\t\trequest.execute((response) => {\n\t\t\tif (response.error) {\n\t\t\t\treject(`Error during file download: ${response.error.message}`)\n\t\t\t\treturn\n\t\t\t}\n\t\t\tconsole.log('response.result', response.result);\n\t\t\tresolve(response.result)\n\t\t})\n\t})\n}\n\nconst save = (content) => {\n\tconsole.info('👉', 'API save')\n\treturn new Promise ((resolve, reject) => {\n\t\tconst request = gapi.client.request({\n\t\t\tpath: '/upload/drive/v2/files/' + fileId,\n\t\t\tmethod: 'PUT',\n\t\t\talt: 'media',\n\t\t\tbody: content,\n\t\t})\n\t\trequest.execute((response) => {\n\t\t\tif (response.error) {\n\t\t\t\treject(`Error during sync: ${response.error.message}`)\n\t\t\t\treturn\n\t\t\t}\n\t\t\tgetFileContent().then((fileContent) => {\n\t\t\t\tresolve(fileContent)\n\t\t\t})\n\t\t})\n\t})\n}\n\nexport {\n\tconnect,\n\tfetchData,\n\tinit,\n\tsave,\n}\n","export const ACTIONS = {\n\tedit: 'person/edit', // when typing in add/edit fields\n\tsave: 'person/save', // when saving added/edited person\n\tSYNC: 'person/sync',\n\tFETCH: 'person/fetch',\n\tSET: 'person/set', // when setting from remote storage\n\tADD: 'person/add',\n\tREMOVE: 'person/remove',\n}\n\nexport const edit = (field, value) => ({type: ACTIONS.edit, payload: {field, value}})\nexport const save = (person) => ({type: ACTIONS.save, payload: person})\n","// @flow\nexport const ACTIONS = {\n\tLIB_LOADED: 'data-provider/lib-loaded',\n\tSYNC_ENABLED: 'data-provider/sync-enabled',\n\tSYNC: 'data-provider/sync',\n\tIS_LOGGED: 'data-provider/is-logged',\n\tLOGIN: 'data-provider/login',\n}\n","import {getState} from '/store/store.js'\n\nexport const ACTIONS = {\n  setActiveElement: 'utils/set-active-element',\n}\n\nexport const storeActiveElement = () => {\n\tconst el = document.activeElement\n\tif (!el) return {type: ''}\n\tconst key = el.getAttribute('data-prsKey')\n  if (!key) return {type: ''}\n\treturn {\n    type: ACTIONS.setActiveElement,\n    payload: key,\n  }\n}\n\nexport const getActiveElement = () => {\n  const key = getState().activeElement\n  if (!key) return null\n  const el = document.querySelector(`[data-prsKey=${key}]`)\n  return el\n}\n","// @flow\nimport {ACTIONS as PERSON} from '/person/person-actions.js'\nimport {ACTIONS as DATA_PROVIDER} from '/data-provider/actions.js'\nimport {ACTIONS as APP} from '/app/app-action.js'\n\nexport const reducer = (state: Object, action: ActionT) => {\n\tswitch (action.type) {\n\t\tcase PERSON.save: {\n\t\t\tconst persons = {\n\t\t\t\t...state.persons,\n\t\t\t\t[action.payload.id]: action.payload\n\t\t\t}\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tpersons,\n\t\t\t}\n\t\t}\n\t\tcase PERSON.SET: {\n\t\t\treturn {\n\t\t\t\tpersons: action.payload,\n\t\t\t}\n\t\t}\n\t\tcase PERSON.ADD: {\n\t\t\tconst persons = state.persons.concat(action.payload)\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tpersons,\n\t\t\t}\n\t\t}\n\t\tcase PERSON.REMOVE: {\n\t\t\tif (!action.payload) return state\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tpersons: state.persons.filter(person => person.id !== action.payload),\n\t\t\t}\n\t\t}\n\t\tcase PERSON.edit: {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tpersonEdit: {\n\t\t\t\t\t...state.personEdit,\n\t\t\t\t\t[action.payload.field]: action.payload.value,\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t\tcase DATA_PROVIDER.IS_LOGGED: {\n\t\t\tconst dataProvider = {\n\t\t\t\t...state.dataProvider,\n\t\t\t\tisLogged: action.payload,\n\t\t\t}\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tdataProvider,\n\t\t\t}\n\t\t}\n\t\tcase APP.setActiveElement: {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tactiveElement: action.payload,\n\t\t\t}\n\t\t}\n\t}\n}\n","// @flow\nimport {reducer} from '/store/reducer.js'\n\ntype ActionT = {\n\ttype: string,\n\tpayload?: any,\n}\n\nconst listeners = []\nlet state = {\n\tgoogleSyncEnabled: false,\n\tisSignedIn: false,\n\tpersons: {},\n\tisLoading: true,\n\tview: 'loading',\n\teditingPerson: null,\n\tactiveElement: null,\n\tpersonEdit: {\n\t\tname: '',\n\t\tday: '1',\n\t\tmonth: '1',\n\t\tyear: '1980',\n\t},\n}\n\nconst getState = (): Object => {\n\treturn state\n}\n\nconst setState = (newState: Object) => {\n\tstate = {\n\t\t...state,\n\t\t...newState,\n\t}\n}\n\nconst dispatch = (action: ActionT) => {\n\tconst state = getState()\n\t// console.log('🔊', action.type, action.payload)\n\tif (!action.type) return\n\tconst newState = reducer(state, action)\n\tsetState(newState)\n\tlisteners.forEach(listener => {\n\t\tlistener(action)\n\t})\n}\n\nconst subscribe = (callback: Function) => {\n\tlisteners.push(callback)\n}\n\nexport {\n\tsubscribe,\n\tdispatch,\n\tgetState,\n}\n","// @flow\nimport {connect as connectGoogle, fetchData, init, save as apiSave} from '/data-provider/google-drive/google-drive-api.js'\nimport {dispatch, subscribe, getState} from '/store/store.js'\nimport {ACTIONS as DATA_PROVIDER} from '/data-provider/actions.js'\nimport {ACTIONS as PERSON} from '/person/person-actions.js'\n\nconst setup = () => {\n\tsubscribe(action => {\n\t\tif (action === DATA_PROVIDER.SYNC_ENABLED) {\n\t\t\tconsole.info('👉', 'update google button', action.payload)\n\t\t\tupdateGoogleButton(action.payload)\n\t\t}\n\t})\n\tconst button = getGoogleSyncButton()\n\tif (button) {\n\t\tbutton.addEventListener('click', connectGoogle)\n\t}\n}\n\nconst onLibLoaded = () => {\n\tconst options = {\n\t\tonSignInChange: onSignInChange,\n\t\tonError: onError,\n\t\tdefaultContent: [],\n\t\t// TODO: apiKey, etc\n\t}\n\tinit(options).then((result) => {\n\t\tconst {isInitiated} = result\n\t\tdispatch({type: DATA_PROVIDER.SYNC_ENABLED, payload: isInitiated})\n\t\t// setState({'googleSyncEnabled': isInitiated})\n\t})\n}\n\nconst onSignInChange = (isSignedIn) => {\n\tconsole.info('👉', 'onSignInChange')\n\tif (isSignedIn) {\n\t\t// setState({isSignedIn, view: 'loading'})\n\t\tdispatch({type: PERSON.FETCH})\n\t} else {\n\t\tdispatch({type: DATA_PROVIDER.IS_LOGGED, payload: false})\n\t\t// setState({isSignedIn, view: 'signIn'})\n\t}\n}\n\nconst save = (payload): Promise<Array<Object>> => {\n\tconsole.info('👉', 'call GDrive API from model', payload)\n\treturn apiSave(payload) // TODO: rejected\n}\n\nconst fetch = () => {\n\tfetchData().then(response => {\n\t\tif (!Array.isArray(response)) {\n\t\t\tonError('Unknown reposonse from server')\n\t\t\treturn\n\t\t}\n\t\tconst persons = response.map(person => {\n\t\t\treturn {\n\t\t\t\t...person,\n\t\t\t\tname: unescape(person.name),\n\t\t\t}\n\t\t})\n\t\treturn persons\n\t\t// dispatch({type: PERSON.SET, payload: persons})\n\t})\n}\n\nconst login = () => {\n\tconnectGoogle()\n}\n\nconst onError = (error) => {\n\t// setState({view: 'error'})\n\talert(error)\n}\n\nconst updateGoogleButton = (isEnabled) => {\n\tif (isEnabled) {\n\t\tconst button = getGoogleSyncButton()\n\t\tif (button) {\n\t\t\tbutton.removeAttribute('disabled')\n\t\t}\n\t}\n}\n\nconst getGoogleSyncButton = () => {\n\treturn document.querySelector('button[data-prs=\"googleDriveButton\"]')\n}\n\nexport default function(options): DataProviderT {\n\tsetup()\n\n\treturn {\n\t\tsave,\n\t\tonLibLoaded,\n\t\tfetch,\n\t\tlogin,\n\t}\n}\n","export const birthdayPicker = ({day, month, year}, onChange) => {\n\tconst createOptions = (start, end, selected) => {\n\t\treturn [...Array(end + 1).keys()].slice(start).map(i => {\n\t\t\tconst option = document.createElement('option')\n\t\t\tconst value = i + ''\n\t\t\toption.innerText = value\n\t\t\toption.value = value\n\t\t\tif (selected && value === selected) option.selected = true\n\t\t\treturn option\n\t\t})\n\t}\n\n\tconst dayEl = document.createElement('select')\n\tconst monthEl = document.createElement('select')\n\tconst yearEl = document.createElement('select')\n\tconst dayOptions = createOptions(1, 31, day).forEach(option => dayEl.appendChild(option))\n\tconst monthOptions = createOptions(1, 12, month).forEach(option => monthEl.appendChild(option))\n\tconst yearOptions = createOptions(1900, 2019, year).forEach(option => yearEl.appendChild(option))\n\tdayEl.addEventListener('change', (ev) => onChange('day', ev.target.value))\n\tmonthEl.addEventListener('change', (ev) => onChange('month', ev.target.value))\n\tyearEl.addEventListener('change', (ev) => onChange('year', ev.target.value))\n\treturn [dayEl, monthEl, yearEl]\n}\n","export default {\n\tedit: `\n\t\t<svg version=\"1.1\" id=\"Capa_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\"\n\t\t\t viewBox=\"0 0 469.331 469.331\" style=\"enable-background:new 0 0 469.331 469.331;\" xml:space=\"preserve\">\n\t\t\t<g>\n\t\t\t\t<path d=\"M438.931,30.403c-40.4-40.5-106.1-40.5-146.5,0l-268.6,268.5c-2.1,2.1-3.4,4.8-3.8,7.7l-19.9,147.4\n\t\t\t\t\tc-0.6,4.2,0.9,8.4,3.8,11.3c2.5,2.5,6,4,9.5,4c0.6,0,1.2,0,1.8-0.1l88.8-12c7.4-1,12.6-7.8,11.6-15.2c-1-7.4-7.8-12.6-15.2-11.6\n\t\t\t\t\tl-71.2,9.6l13.9-102.8l108.2,108.2c2.5,2.5,6,4,9.5,4s7-1.4,9.5-4l268.6-268.5c19.6-19.6,30.4-45.6,30.4-73.3\n\t\t\t\t\tS458.531,49.903,438.931,30.403z M297.631,63.403l45.1,45.1l-245.1,245.1l-45.1-45.1L297.631,63.403z M160.931,416.803l-44.1-44.1\n\t\t\t\t\tl245.1-245.1l44.1,44.1L160.931,416.803z M424.831,152.403l-107.9-107.9c13.7-11.3,30.8-17.5,48.8-17.5c20.5,0,39.7,8,54.2,22.4\n\t\t\t\t\ts22.4,33.7,22.4,54.2C442.331,121.703,436.131,138.703,424.831,152.403z\"/>\n\t\t\t</g>\n\t\t</svg>\n\t`,\n\tremove: `\n\t\t<svg version=\"1.1\" id=\"Capa_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\"\n\t\t\t viewBox=\"0 0 486.4 486.4\" style=\"enable-background:new 0 0 486.4 486.4;\" xml:space=\"preserve\">\n\t\t\t<g>\n\t\t\t\t<g>\n\t\t\t\t\t<path d=\"M446,70H344.8V53.5c0-29.5-24-53.5-53.5-53.5h-96.2c-29.5,0-53.5,24-53.5,53.5V70H40.4c-7.5,0-13.5,6-13.5,13.5\n\t\t\t\t\t\tS32.9,97,40.4,97h24.4v317.2c0,39.8,32.4,72.2,72.2,72.2h212.4c39.8,0,72.2-32.4,72.2-72.2V97H446c7.5,0,13.5-6,13.5-13.5\n\t\t\t\t\t\tS453.5,70,446,70z M168.6,53.5c0-14.6,11.9-26.5,26.5-26.5h96.2c14.6,0,26.5,11.9,26.5,26.5V70H168.6V53.5z M394.6,414.2\n\t\t\t\t\t\tc0,24.9-20.3,45.2-45.2,45.2H137c-24.9,0-45.2-20.3-45.2-45.2V97h302.9v317.2H394.6z\"/>\n\t\t\t\t\t<path d=\"M243.2,411c7.5,0,13.5-6,13.5-13.5V158.9c0-7.5-6-13.5-13.5-13.5s-13.5,6-13.5,13.5v238.5\n\t\t\t\t\t\tC229.7,404.9,235.7,411,243.2,411z\"/>\n\t\t\t\t\t<path d=\"M155.1,396.1c7.5,0,13.5-6,13.5-13.5V173.7c0-7.5-6-13.5-13.5-13.5s-13.5,6-13.5,13.5v208.9\n\t\t\t\t\t\tC141.6,390.1,147.7,396.1,155.1,396.1z\"/>\n\t\t\t\t\t<path d=\"M331.3,396.1c7.5,0,13.5-6,13.5-13.5V173.7c0-7.5-6-13.5-13.5-13.5s-13.5,6-13.5,13.5v208.9\n\t\t\t\t\t\tC317.8,390.1,323.8,396.1,331.3,396.1z\"/>\n\t\t\t\t</g>\n\t\t\t</g>\n\t\t</svg>\n\t`,\n}\n","export const parseDate = (isoDate) => {\n\tconst date = new Date(isoDate)\n\tconst day = date.getDate()\n\tconst month = date.getMonth() + 1\n\tconst year = date.getFullYear()\n\treturn {day, month, year}\n}\n\nexport const createDate = (day, month, year) => {\n\treturn new Date(year, month - 1, day)\n\treturn `${year}-${month}-${day}`\n}\n\nexport const createIso = (day, month, year) => {\n\tconst d = day.padStart(2, '0')\n\tconst m = month.padStart(2, '0')\n\treturn `${year}-${m}-${d}`\n}\n\nexport const formatDMY = (isoDate) => {\n\tconst {day, month, year} = parseDate(isoDate)\n\treturn `${day}. ${month}. ${year}`\n}","// @flow\nimport {birthdayPicker} from '/components/birthday-picker.js'\nimport ICONS from '/components/icons.js'\nimport {formatDMY} from '/utils/date.js'\n\nconst renderPersons = (persons) => {\n\tconst el = document.createElement('div')\n\tel.classList.add('persons')\n\tel.setAttribute('data-cy', 'persons')\n\tpersons\n\t\t.map(renderPerson)\n\t\t.forEach(person => el.appendChild(person))\n\treturn el\n}\n\nconst renderEmpty = () => {\n\tconst el = document.createElement('div')\n\tel.classList.add('personsEmpty')\n\tel.setAttribute('data-cy', 'personsEmpty')\n\tel.innerText = 'No persons created yet.'\n\treturn el\n}\n\nconst renderPerson = (person) => {\n\tconst el = document.createElement('div')\n\tel.classList.add('person')\n\tel.setAttribute('data-cy', 'person')\n\tconst fields = [\n\t\trenderTitle(person.name),\n\t\trenderBirthday(person),\n\t\trenderSeen(person.seenBefore),\n\t\t...renderCustomTexts(person.customTexts),\n\t]\n\tfields\n\t\t.filter(Boolean)\n\t\t.forEach(field => el.appendChild(field))\n\tconst edit = document.createElement('div')\n\tconst remove = document.createElement('div')\n\tedit.classList.add('icon-edit', 'icon')\n\tremove.classList.add('icon-remove', 'icon')\n\tedit.addEventListener('click', person.handleEdit.bind(null, person.id))\n\t// edit.addEventListener('click', () => dispatch(edit(person.id)))\n\tremove.addEventListener('click', person.handleRemove.bind(null, person.id))\n\tremove.setAttribute('data-cy', 'remove')\n\tedit.innerHTML = ICONS.edit\n\tremove.innerHTML = ICONS.remove\n\tel.appendChild(remove)\n\tel.appendChild(edit)\n\treturn el\n}\n\nconst renderTitle = (value) => {\n\tconst el = renderText(value)\n\tel.classList.add('person-title')\n\treturn el\n}\n\nconst renderText = (value) => {\n\tconst el = document.createElement('div')\n\tel.innerHTML = value\n\treturn el\n}\n\nconst renderBirthday = ({birthday, age, daysToBirthday}) => {\n\tif (!birthday) return null\n\tconst el = document.createElement('div')\n\tconst birthdayDMY = formatDMY(birthday)\n\tel.innerHTML = `Age: ${age}<br />Birthday in ${daysToBirthday} days (${birthdayDMY})`\n\treturn el\n}\n\nconst renderSeen = (days) => {\n\tif (!days && days !== 0) return null\n\tconst el = document.createElement('div')\n\tconst button = document.createElement('button')\n\tel.innerHTML = `Seen before ${days} days`\n\treturn el\n}\n\nconst renderCustomTexts = (values) => {\n\tif (!values) return []\n\treturn values.map(renderText)\n}\n\nconst clearPersons = () => {\n\tconst el = document.querySelector('.persons')\n\tif (!el) return\n\tel.innerHTML = ''\n}\n\nexport default function render (props: Object) {\n\tclearPersons() // TODO: clean when necessary\n\tif (props.persons.length) {\n\t\treturn renderPersons(props.persons)\n\t} else {\n\t\treturn renderEmpty()\n\t}\n}\n","export const ROUTES = {\n\thome: '/',\n\tlogin: 'login',\n\tadd: 'add',\n\tedit: 'edit',\n}\n","import {ROUTES} from '/router/routes.js'\n\nexport const ACTIONS = {\n\thome: '',\n\tgo: 'router/go',\n}\n\nexport const goToAdd = () => ({type: ACTIONS.go, payload: ROUTES.add})\nexport const goToEdit = (id) => ({type: ACTIONS.go, payload: `${ROUTES.edit}/${id}`})\nexport const goToHome = () => ({type: ACTIONS.go, payload: ROUTES.home})\n","import {subscribe, dispatch, getState} from '/store/store.js'\nimport * as view from '/person/persons-view.js'\nimport {createIso} from '/utils/date.js'\nimport {ACTIONS as DATA_PROVIDER} from '/data-provider/actions.js'\nimport {ACTIONS as PERSON} from '/person/person-actions.js'\nimport {goToEdit} from '/router/router-actions.js'\n\nconst setup = () => {\n\tsubscribe(update)\n}\n\nconst update = () => {\n\tupdatePersons()\n}\n\n// const updatePersons = () => {\n// \tview.clearPersons()\n// \trenderPersons(getState().persons)\n// }\n\n// const renderPersons = (persons) => {\n// \tconst personsView = persons\n// \t\t.map(person => {\n// \t\t\treturn {\n// \t\t\t\t...person,\n// \t\t\t\tage: getAge(person.birthday),\n// \t\t\t\tdaysToBirthday: getDaysToBirthday(person.birthday),\n// \t\t\t\tseenBefore: getSeenBefore(person.seen),\n// \t\t\t\thandleEdit: edit,\n// \t\t\t\thandleRemove: remove,\n// \t\t\t}\n// \t\t})\n// \t\t.sort(sortByBirthday)\n// \tview.renderPersons(personsView, addPerson)\n// }\n\nconst getProps = () => {\n\tconst persons = Object.values(getState().persons)\n\t\t.map(person => {\n\t\t\treturn {\n\t\t\t\t...person,\n\t\t\t\tage: getAge(person.birthday),\n\t\t\t\tdaysToBirthday: getDaysToBirthday(person.birthday),\n\t\t\t\tseenBefore: getSeenBefore(person.seen),\n\t\t\t\t// handleEdit: edit,\n\t\t\t\thandleEdit: (id) => dispatch(goToEdit(id)),\n\t\t\t\thandleRemove: remove,\n\t\t\t}\n\t\t})\n\t\t.sort(sortByBirthday)\n\treturn {persons}\n}\n\nconst sortByBirthday = (personA, personB) => {\n\tif (!personA.birthday || !personB.birthday) return 0\n\treturn getDaysToBirthday(personA.birthday) - getDaysToBirthday(personB.birthday)\n}\n\nconst getAge = (isoDay) => {\n\tif (!isoDay) return null\n\tconst now = Date.now()\n\tconst date = new Date(isoDay).getTime()\n\tconst diff = new Date(now - date)\n\tconst age = Math.abs(diff.getUTCFullYear() - 1970)\n\treturn age\n}\n\nconst getSeenBefore = (isoDay) => {\n\tif (!isoDay) return null\n\tconst now = Date.now()\n\tconst date = new Date(isoDay).getTime()\n\tconst days = Math.round((now - date) / 1000 / 60 / 60/ 24)\n\treturn days\n}\n\nconst getDaysToBirthday = (isoDate) => {\n\tif (!isoDate) return null\n\tconst birthday = new Date(isoDate)\n\tconst nowYear = new Date().getUTCFullYear()\n\tconst diff = Date.now() - new Date(`${nowYear}-${birthday.getMonth() + 1}-${birthday.getDate()}`).getTime()\n\tlet days\n\tif (diff < 0) {\n\t\t// this year\n\t\tdays = Math.abs(Math.ceil(diff / 1000 / 60 / 60 / 24))\n\t} else {\n\t\t// next year\n\t\tconst diffNext = Date.now() - new Date(`${nowYear + 1}-${birthday.getMonth() + 1}-${birthday.getDate()}`).getTime()\n\t\tdays = Math.abs(Math.ceil(diffNext / 1000 / 60 / 60 / 24))\n\t}\n\treturn days\n}\n\n// const addPerson = (name, day, month, year) => {\n// \tconst birthday = createIso(day, month, year)\n// \tconst error = getValidationError(name, birthday)\n// \tif (error) {\n// \t\talert(error)\n// \t\treturn\n// \t}\n// \tconst payload = {name, birthday}\n// \tdispatch({type: PERSON.ADD, payload})\n// \tdispatch({type: PERSON.SYNC})\n// }\n\n// const editPerson = (id, name, day, month, year) => {\n// \tconst birthday = createIso(day, month, year)\n// \tconst error = getValidationError(name, birthday)\n// \tif (error) {\n// \t\talert(error)\n// \t\treturn\n// \t}\n// \tdispatch({type: PERSON.EDIT, payload: {id, name, birthday}})\n// \tdispatch({type: PERSON.SYNC})\n// }\n\nconst getValidationError = (name, birthday) => {\n\tif (!name) {\n\t\treturn 'Empty name'\n\t}\n\tif (!birthday.match(/^\\d{4}-\\d{2}-\\d{2}$/)) {\n\t\treturn 'Wrong birthday format. Use YYYY-MM-DD.'\n\t}\n\treturn null\n}\n\nconst resetSeen = (id) => {\n\tconst persons = getState().persons.map((person) => {\n\t\tif (id !== person.id) return person\n\t\tconst now = new Date()\n\t\tconst year = now.getUTCFullYear()\n\t\tconst month = (now.getMonth() + 1 + '').padStart(2, '0')\n\t\tconst day = (now.getDate() + '').padStart(2, '0')\n\t\treturn {\n\t\t\t...person,\n\t\t\tseen: `${year}-${month}-${day}`,\n\t\t}\n\t})\n\tdispatch({type: PERSON.SYNC})\n}\n\nconst edit = (id) => {\n\t// setState({view: 'edit', editingPerson: id})\n}\nconst remove = (id) => {\n\tif (!confirm('Delete person?')) return\n\tdispatch({type: PERSON.REMOVE, payload: id})\n\tdispatch({type: PERSON.SYNC})\n}\n\n// export {getProps, editPerson, resetSeen, setup}\nexport {getProps}\n","import {subscribe} from '/store/store.js'\nimport {setState} from '/store/store.js'\nimport {editPerson, resetSeen} from '/person/persons-model.js'\nimport {parseDate} from '/utils/date.js'\nimport {birthdayPicker} from '/components/birthday-picker.js'\n\nconst ELEMENTS = {\n\toverlay: {\n\t\tselector: 'div[data-prs=\"overlay\"]',\n\t\tshow: 'flex',\n\t},\n\tloader: {\n\t\tselector: 'div[data-prs=\"loader\"]',\n\t\tshow: 'block',\n\t},\n\tsingIn: {\n\t\tselector: 'button[data-prs=\"googleDriveButton\"]',\n\t\tshow: 'block',\n\t},\n\tedit: {\n\t\tselector: 'div[data-prs=\"edit\"]',\n\t\tshow: 'block',\n\t},\n}\n\nconst update = () => {\n\tshowElement(ELEMENTS.loader, state.view === 'loading')\n\tshowElement(ELEMENTS.singIn, state.view === 'signIn')\n\tshowElement(ELEMENTS.edit, state.view === 'edit')\n\tshowElement(ELEMENTS.overlay, ['loading', 'edit', 'signIn'].includes(state.view))\n\tif (state.view === 'edit' && state.editingPerson) {\n\t\trenderEdit(state.persons.find(({id}) => id === state.editingPerson))\n\t}\n}\n\nconst renderEdit = (person) => {\n\tconst el = document.querySelector(ELEMENTS.edit.selector)\n\tel.innerHTML = ''\n\tconst name = document.createElement('input')\n\tconst [day, month, year] = birthdayPicker(parseDate(person.birthday))\n\tconst save = document.createElement('button')\n\tconst seen = document.createElement('button')\n\tconst cancel = document.createElement('button')\n\tseen.classList.add('seen-save')\n\tsave.classList.add('edit-save')\n\tsave.innerText = 'Save'\n\tseen.innerText = 'Seen today'\n\tcancel.innerText = 'Cancel'\n\tname.value = person.name\n\tsave.addEventListener('click', () => {\n\t\teditPerson(person.id, name.value, day.value, month.value, year.value)\n\t})\n\tseen.addEventListener('click', () => {\n\t\tresetSeen(person.id)\n\t})\n\tcancel.addEventListener('click', () => {\n\t\tsetState({view: 'persons', editingPerson: null})\n\t})\n\tel.appendChild(name)\n\tel.appendChild(day)\n\tel.appendChild(month)\n\tel.appendChild(year)\n\tel.appendChild(seen)\n\tel.appendChild(save)\n\tel.appendChild(cancel)\n}\n\nconst showElement = (element, show) => {\n\tconst el = document.querySelector(element.selector)\n\tel.style['display'] = show ? element.show : 'none'\n}\n\nexport const setup = () => {\n\t// subscribe(update)\n}\n","// @flow\nimport {dispatch, getState, subscribe} from '/store/store.js'\nimport {ACTIONS} from '/data-provider/actions.js'\nimport {ACTIONS as PERSON} from '/person/person-actions.js'\n\nconst GDRIVE = 'gdrive'\n\nconst getSelectedStorage = () => {\n\treturn GDRIVE\n}\n\nexport function setup(dataProviderFactory) {\n\tconst dataProvider = dataProviderFactory({\n\t\tonReady: () => dispatch(ACTIONS.FETCH),\n\t})\n\tsubscribe(async action => {\n\t\tswitch (action.type) {\n\t\t\tcase PERSON.SYNC: {\n\t\t\t\tconst persons = dataProvider.save(getState().persons)\n\t\t\t\tconsole.info('👉', 'persons synced', persons)\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase PERSON.FETCH: {\n\t\t\t\tconst persons = await dataProvider.fetch()\n\t\t\t\tdispatch({type: PERSON.SET, payload: persons})\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ACTIONS.LIB_LOADED: {\n\t\t\t\tdataProvider.onLibLoaded()\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ACTIONS.LOGIN: {\n\t\t\t\tdataProvider.login()\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t})\n}\n\nexport async function fetchLib() {\n\tconst storageType = getSelectedStorage()\n\tif (storageType === GDRIVE) {\n\t\tconst response = await fetch('https://apis.google.com/js/api.js')\n\t\teval(await response.text())\n\t\tdispatch({type: ACTIONS.LIB_LOADED})\n\t}\n}\n","// @flow\nexport default function render (props) {\n\tconst login = document.createElement('button')\n\tlogin.innerText = 'Login'\n\tlogin.addEventListener('click', () => {\n\t\tprops.handleLoginClick()\n\t})\n\tconst wrap = document.createElement('div')\n\twrap.appendChild(login)\n\treturn wrap\n}\n","import {dispatch, getState} from '/store/store.js'\nimport {goToAdd} from '/router/router-actions.js'\n\nexport default function render () {\n\tconst el = document.createElement('div')\n\tel.setAttribute('data-cy', 'header')\n\tconst content = [\n\t\trenderTitle(),\n\t\trenderSync(),\n\t\trenderAdd(),\n\t]\n\tcontent.map((c) => el.appendChild(c))\n\treturn el\n}\n\nconst renderTitle = () => {\n\tconst el = document.createElement('div')\n\tel.innerHTML = 'Persons'\n\treturn el\n}\n\nconst renderSync = () => {\n\tconst el = document.createElement('div')\n\tel.classList.add('header-button--sync')\n\tel.setAttribute('data-cy', 'header-button--sync')\n\tel.innerHTML = 'Sync'\n\treturn el\n}\n\nconst renderAdd = () => {\n\tconst el = document.createElement('div')\n\tel.classList.add('header-button--add')\n\tel.setAttribute('data-cy', 'header-button--add')\n\tel.addEventListener('click', () => dispatch(goToAdd()))\n\tel.innerHTML = 'Add'\n\treturn el\n}\n","import {dispatch, getState} from '/store/store.js'\nimport {birthdayPicker} from '/components/birthday-picker.js'\nimport {save} from '/person/person-actions.js'\nimport {edit} from '/person/person-actions.js'\nimport {storeActiveElement} from '/app/app-action.js'\nimport {goToHome} from '/router/router-actions.js'\nimport {createIso} from '/utils/date.js'\n\nexport default function render () {const el = document.createElement('div')\n\tconst {personEdit} = getState()\n\tconst content = [\n\t\trenderName(personEdit.name),\n\t\trenderPicker(personEdit.day, personEdit.month, personEdit.year),\n\t\trenderSave(personEdit),\n\t]\n\tcontent.map((c) => el.appendChild(c))\n\treturn el\n}\n\nconst renderName = (name) => {\n\tconst el = document.createElement('input')\n\tel.placeholder = 'Name'\n\tel.classList.add('add-input--name')\n\tel.setAttribute('data-cy', 'add-input--name')\n\tel.setAttribute('data-prsKey', 'add-input--name')\n\tel.value = name\n\tel.addEventListener('input', (e) => {\n\t\tdispatch(storeActiveElement())\n\t\tdispatch(edit('name', el.value))\n\t})\n\t// TODO: storeActiveElement na unfocus\n\treturn el\n}\n\nconst renderPicker = (day, month, year) => {\n\tconst el = document.createElement('div')\n\tel.setAttribute('data-cy', 'add-input--birthday')\n\tconst [dayEl, monthEl, yearEl] = birthdayPicker({day, month, year}, (field, value) => {\n\t\tdispatch(edit(field, value))\n\t})\n\tel.appendChild(dayEl)\n\tel.appendChild(monthEl)\n\tel.appendChild(yearEl)\n\treturn el\n}\n\nconst renderSave = (personEdit) => {\n\tconst el = document.createElement('button')\n\tel.innerText = 'Save'\n\tel.addEventListener('click', () => {\n\t\tconst {day, month, year, ...personRest} = personEdit\n\t\tconst person = {\n\t\t\tid: Math.random().toString(36).substring(10),\n\t\t\t...personRest,\n\t\t\tbirthday: createIso(day, month, year),\n\t\t}\n\t\tdispatch(save(person))\n\t\tdispatch(goToHome())\n\t})\n\tel.classList.add('add-button--save')\n\tel.setAttribute('data-cy', 'add-button--save')\n\treturn el\n}\n","// @flow\nimport {subscribe, dispatch, getState} from '/store/store.js'\nimport {ACTIONS as DATA_PROVIDER} from '/data-provider/actions.js'\nimport Login from '/login/login-view.js'\nimport Header from '/header/header.js'\nimport Persons from '/person/persons-view.js'\nimport Add from '/person/person-add.js'\nimport {ROUTES} from '/router/routes.js'\nimport {ACTIONS} from '/router/router-actions.js'\nimport {getProps as getPersons} from '/person/persons-model.js'\nimport {getActiveElement} from '/app/app-action.js'\n\nconst getRoute = () => {\n\treturn window.location.pathname.substring(1).split('/')[0]\n}\n\nconst go = path => {\n\tif (path === getRoute()) return\n\thistory.pushState({}, '', path)\n}\n\nconst route = action => {\n\tif (action.type === ACTIONS.go) {\n\t\tgo(action.payload)\n\t}\n\tconst route = getRoute()\n\tlet body = []\n\tswitch (route) {\n\t\tcase ROUTES.login: {\n\t\t\tbody.push(\n\t\t\t\tLogin({\n\t\t\t\t\thandleLoginClick: () => dispatch({type: DATA_PROVIDER.LOGIN}),\n\t\t\t\t})\n\t\t\t)\n\t\t\tbreak;\n\t\t}\n\t\tcase ROUTES.add: {\n\t\t\tbody.push(\n\t\t\t\tHeader(),\n\t\t\t\tAdd(),\n\t\t\t)\n\t\t\tbreak;\n\t\t}\n\t\tcase ROUTES.edit: {\n\t\t\tbody.push(\n\t\t\t\tHeader(),\n\t\t\t\tAdd(),\n\t\t\t)\n\t\t\tbreak;\n\t\t}\n\t\tdefault: {\n\t\t\tbody = [\n\t\t\t\tHeader(),\n\t\t\t\tPersons(getPersons()),\n\t\t\t]\n\t\t}\n\t}\n\tconst app = document.getElementById('app')\n\tapp.innerHTML = ''\n\tbody.map((el) => app.appendChild(el))\n\tconst activeElement = getActiveElement()\n\tif (activeElement) {\n\t\tactiveElement.focus()\n\t}\n}\n\nexport const setup = () => {\n\twindow.onpopstate = route\n\tsubscribe(route)\n}\n","// @flow\n// import dataProvider from '/data-provider/filesystem/filesystem.js'\nimport dataProvider from '/data-provider/google-drive/google-drive-model.js'\n// import dataProvider from '/data-provider/google-drive/google-drive-model.js'\nimport {setup as setupOverlay} from '/overlay.js'\nimport {setup as setupDataProvider, fetchLib} from '/data-provider/data-provider.js'\nimport {ACTIONS} from '/data-provider/actions.js'\nimport * as store from '/store/store.js'\nimport {setup as setupRouter} from '/router/router.js'\n\nconst setup = () => {\n\tfetchLib()\n\t// setupDataProvider(dataProvider)\n\t// setupOverlay()\n\tsetupRouter()\n}\n\nwindow.getState = store.getState // TODO: for debug only\nif (window.Cypress) {\n\t// For Cypress testing library\n\twindow.store = store\n}\n\nexport {\n\tsetup,\n}\n"]}