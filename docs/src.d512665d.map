{"version":3,"sources":["src/google-drive-api.js","src/state.js","src/google-drive-model.js","src/persons-view.js","src/persons-model.js","src/overlay.js","src/index.js"],"names":["APP_FOLDER","FILE_NAME","onSignInChangeHandler","Function","onUpdateHandler","onErrorHandler","fileId","Object","folderId","defaultContent","init","options","setupOptions","Promise","resolve","reject","gapi","load","initClient","then","defaultContentOption","onError","onSignInChange","onUpdate","client","auth2","getAuthInstance","isSignedIn","listen","updateSignInStatus","get","isInitiated","isLogged","connect","fetchData","signIn","getFolder","getFile","getFileContent","drive","files","list","q","execute","response","length","createFolder","id","metadata","name","mimeType","create","resource","createFile","boundary","delimiter","parents","multipartRequestBody","JSON","stringify","request","alt","error","message","result","updateContent","content","path","method","body","fileContent","listeners","state","googleSyncEnabled","persons","isLoading","view","editingPerson","getState","setState","newState","dispatchUpdate","forEach","listener","addListener","push","setup","update","getGoogleSyncButton","addEventListener","window","libLoaded","updatePersons","updateGoogleButton","Array","isArray","map","person","unescape","Math","random","toString","substring","alert","isEnabled","removeAttribute","document","querySelector","renderPersons","handleAdd","el","renderPerson","appendChild","renderAdd","createElement","classList","add","renderTitle","renderBirthday","birthday","age","daysToBirthday","renderSeen","seenBefore","renderCustomTexts","customTexts","filter","Boolean","field","actions","edit","remove","innerText","handleEdit","bind","handleRemove","value","renderText","innerHTML","days","values","clearPersons","save","placeholder","personsView","getAge","getDaysToBirthday","getSeenBefore","seen","sort","sortByBirthday","addPerson","personA","personB","isoDay","now","Date","date","getTime","diff","abs","getUTCFullYear","round","isoDate","nowYear","getMonth","getDate","ceil","diffNext","getValidationError","concat","editPerson","match","resetSeen","year","month","padStart","day","ELEMENTS","overlay","selector","show","loader","singIn","showElement","includes","renderEdit","find","cancel","element","style"],"mappings":"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","file":"src.d512665d.map","sourceRoot":"..","sourcesContent":["const APP_FOLDER = 'App-Personas'\nconst FILE_NAME = 'persons.json'\nlet onSignInChangeHandler = Function\nlet onUpdateHandler = Function\nlet onErrorHandler = Function\nlet fileId = Object\nlet folderId = Object\nlet defaultContent = null\n\nconst init = (options = {}) => {\n\tsetupOptions(options)\n\treturn new Promise ((resolve, reject) => {\n\t\tgapi.load('client:auth2', () => {\n\t\t\tinitClient().then(resolve)\n\t\t})\n\t})\n}\n\nconst setupOptions = ({defaultContent: defaultContentOption, onError, onSignInChange, onUpdate}) => {\n\tif (onSignInChange) onSignInChangeHandler = onSignInChange\n\tif (onUpdate) onUpdateHandler = onUpdate\n\tif (onError) onErrorHandler = onError\n\tif (defaultContentOption) defaultContent = defaultContentOption\n}\n\nconst initClient = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tgapi.client.init({\n\t\t\t'apiKey': 'AIzaSyBYItpNT8k2Y2AEHz2E2kI2EqMULh5C4m0',\n\t\t\t'discoveryDocs': ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],\n\t\t\t'clientId': '614338309616-st9nui22tf3sa1cm9m1l3nd439n50frg.apps.googleusercontent.com',\n\t\t\t'scope': 'https://www.googleapis.com/auth/drive.file'\n\t\t})\n\t\t.then(() => {\n\t\t\tgapi.auth2.getAuthInstance().isSignedIn.listen(updateSignInStatus)\n\t\t\tupdateSignInStatus(gapi.auth2.getAuthInstance().isSignedIn.get())\n\t\t\tresolve({isInitiated: true})\n\t\t})\n\t})\n}\n\nconst updateSignInStatus = (isLogged) => {\n\tonSignInChangeHandler(isLogged)\n}\n\nconst connect = () => {\n\tif (gapi.auth2.getAuthInstance().isSignedIn.get()) {\n\t\tfetchData()\n\t} else {\n\t\tgapi.auth2.getAuthInstance().signIn()\n\t}\n}\n\nconst fetchData = () => {\n\treturn getFolder()\n\t.then(getFile)\n\t.then(getFileContent)\n}\n\nconst getFolder = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst request = gapi.client.drive.files.list({\n\t\t\tq: `name='${APP_FOLDER}' and trashed=false`,\n\t\t})\n\n\t\trequest.execute((response) => {\n\t\t\tif (response.files.length === 0) {\n\t\t\t\tcreateFolder().then(resolve)\n\t\t\t} else {\n\t\t\t\tfolderId = response.files[0].id\n\t\t\t\tresolve()\n\t\t\t}\n\t\t})\n\t})\n}\n\nconst createFolder = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst metadata = {\n\t\t\tname: APP_FOLDER,\n\t\t\tmimeType: 'application/vnd.google-apps.folder'\n\t\t}\n\t\tconst request = gapi.client.drive.files.create({resource: metadata})\n\t\trequest.execute((response) => {\n\t\t\tfolderId = response.id\n\t\t\tresolve()\n\t\t})\n\t})\n}\n\nconst getFile = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst request = gapi.client.drive.files.list({\n\t\t\tq: `name=\"${FILE_NAME}\" and '${folderId}' in parents and trashed=false`,\n\t\t})\n\t\trequest.execute((response) => {\n\t\t\tif (response.files.length === 0) {\n\t\t\t\tcreateFile().then(resolve)\n\t\t\t} else {\n\t\t\t\tfileId = response.files[0].id\n\t\t\t\tresolve()\n\t\t\t}\n\t\t})\n\t})\n}\nconst createFile = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst boundary = '-------314159265358979323846'\n\t\tconst delimiter = \"\\r\\n--\" + boundary + \"\\r\\n\"\n\t\tconst close_delim = \"\\r\\n--\" + boundary + \"--\"\n\n\t\tconst contentType = 'application/json'\n\n\t\tconst metadata = {\n\t\t\tname: FILE_NAME,\n\t\t\tmimeType: contentType,\n\t\t\tparents: [folderId],\n\t\t}\n\n\t\tconst multipartRequestBody =\n\t\t\tdelimiter +\n\t\t\t'Content-Type: application/json\\r\\n\\r\\n' +\n\t\t\tJSON.stringify(metadata) +\n\t\t\tdelimiter +\n\t\t\t'Content-Type: ' + contentType + '\\r\\n\\r\\n' +\n\t\t\t(defaultContent ? JSON.stringify(defaultContent) : '') +\n\t\t\tclose_delim\n\n\t\tconst request = gapi.client.request({\n\t\t\t'path': '/upload/drive/v3/files',\n\t\t\t'method': 'POST',\n\t\t\t'params': {'uploadType': 'multipart'},\n\t\t\t'headers': {\n\t\t\t  'Content-Type': 'multipart/related; boundary=\"' + boundary + '\"'\n\t\t\t},\n\t\t\t'body': multipartRequestBody\n\t\t})\n\n\t\trequest.execute((response) => {\n\t\t\tfileId = response.id\n\t\t\tresolve()\n\t\t})\n\t})\n}\n\nconst getFileContent = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst request = gapi.client.drive.files.get({\n\t\t\tfileId: fileId,\n\t\t\talt: 'media',\n\t\t})\n\t\trequest.execute((response) => {\n\t\t\tif (response.error) {\n\t\t\t\tonErrorHandler(`Error during file download: ${response.error.message}`)\n\t\t\t\treturn\n\t\t\t}\n\t\t\tresolve(response.result)\n\t\t})\n\t})\n}\n\nconst updateContent = (content) => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst request = gapi.client.request({\n\t\t\tpath: '/upload/drive/v2/files/' + fileId,\n\t\t\tmethod: 'PUT',\n\t\t\talt: 'media',\n\t\t\tbody: content,\n\t\t})\n\t\trequest.execute((response) => {\n\t\t\tif (response.error) {\n\t\t\t\tonErrorHandler(`Error during sync: ${response.error.message}`)\n\t\t\t\treturn\n\t\t\t}\n\t\t\tgetFileContent().then((fileContent) => {\n\t\t\t\tonUpdateHandler(fileContent)\n\t\t\t\tresolve(fileContent)\n\t\t\t})\n\t\t})\n\t})\n}\n\nexport {\n\tconnect,\n\tfetchData,\n\tinit,\n\tupdateContent,\n}","const listeners = []\nlet state = {\n\tgoogleSyncEnabled: false,\n\tisSignedIn: false,\n\tpersons: [],\n\tisLoading: true,\n\tview: 'loading',\n\teditingPerson: null,\n}\n\nconst getState = () => {\n\treturn state\n}\n\nconst setState = (newState) => {\n\tstate = {\n\t\t...state,\n\t\t...newState,\n\t}\n\tdispatchUpdate()\n}\n\nconst dispatchUpdate = () => {\n\tlisteners.forEach(listener => {\n\t\tlistener(getState())\n\t})\n}\n\nconst addListener = (listener) => {\n\tlisteners.push(listener)\n}\n\nexport {addListener, getState, dispatchUpdate, setState}\n","import {connect, fetchData, init} from './google-drive-api.js'\nimport {addListener, getState, setState} from './state.js'\n\nconst setup = () => {\n\taddListener(update)\n\tgetGoogleSyncButton().addEventListener('click', connect)\n\twindow.getState = getState\n}\n\nconst libLoaded = () => {\n\tconst options = {\n\t\tonSignInChange: onSignInChange,\n\t\tonUpdate: updatePersons,\n\t\tonError: onError,\n\t\tdefaultContent: [],\n\t\t// TODO: apiKey, etc\n\t}\n\tinit(options).then((result) => {\n\t\tconst {isInitiated} = result\n\t\tsetState({'googleSyncEnabled': isInitiated})\n\t})\n}\n\nconst update = (state) => {\n\tupdateGoogleButton(state.googleSyncEnabled)\n}\n\nconst updatePersons = (persons) => {\n\tif (!Array.isArray(persons)) {\n\t\tonError('Unknown reposonse from server')\n\t}\n\tpersons = persons.map(person => {\n\t\treturn {\n\t\t\t...person,\n\t\t\tname: unescape(person.name),\n\t\t\tid: Math.random().toString(36).substring(10),\n\t\t}\n\t})\n\tsetState({persons, view: 'persons'})\n}\n\nconst onSignInChange = (isSignedIn) => {\n\tif (isSignedIn) {\n\t\tsetState({isSignedIn, view: 'loading'})\n\t\tfetchData().then(updatePersons)\n\t} else {\n\t\tsetState({isSignedIn, view: 'signIn'})\n\t}\n}\n\nconst onError = (error) => {\n\tsetState({view: 'error'})\n\talert(error)\n}\n\nconst updateGoogleButton = (isEnabled) => {\n\tif (isEnabled) {\n\t\tgetGoogleSyncButton().removeAttribute('disabled')\n\t}\n}\n\nconst getGoogleSyncButton = () => {\n\treturn document.querySelector('button[data-prs=\"googleDriveButton\"]')\n}\n\nexport {libLoaded, setup}\n","const renderPersons = (persons, handleAdd) => {\n\tconst el = document.querySelector('.persons')\n\tpersons\n\t\t.map(renderPerson)\n\t\t.forEach(person => el.appendChild(person))\n\tel.appendChild(renderAdd(handleAdd))\n}\n\nconst renderPerson = (person) => {\n\tconst el = document.createElement('div')\n\tel.classList.add('person')\n\tconst fields = [\n\t\trenderTitle(person.name),\n\t\trenderBirthday(person.birthday, person.age, person.daysToBirthday),\n\t\trenderSeen(person.seenBefore),\n\t\t...renderCustomTexts(person.customTexts),\n\t]\n\tfields\n\t.filter(Boolean)\n\t.forEach(field => el.appendChild(field))\n\tconst actions = document.createElement('div')\n\tconst edit = document.createElement('button')\n\tconst remove = document.createElement('button')\n\tedit.innerText = 'Edit'\n\tremove.innerText = 'Remove'\n\tedit.addEventListener('click', person.handleEdit.bind(null, person.id))\n\tremove.addEventListener('click', person.handleRemove.bind(null, person.id))\n\tactions.appendChild(edit)\n\tactions.appendChild(remove)\n\tel.appendChild(actions)\n\treturn el\n}\n\nconst renderTitle = (value) => {\n\tconst el = renderText(value)\n\tel.classList.add('person-title')\n\treturn el\n}\n\nconst renderText = (value) => {\n\tconst el = document.createElement('div')\n\tel.innerHTML = value\n\treturn el\n}\n\nconst renderBirthday = (birthday, age, daysToBirthday) => {\n\tif (!birthday) return null\n\tconst el = document.createElement('div')\n\tel.innerHTML = `Age: ${age}<br />Birthday in ${daysToBirthday} days (${birthday})`\n\treturn el\n}\n\nconst renderSeen = (days) => {\n\tif (!days && days !== 0) return null\n\tconst el = document.createElement('div')\n\tconst button = document.createElement('button')\n\tel.innerHTML = `Seen before ${days} days`\n\treturn el\n}\n\nconst renderCustomTexts = (values) => {\n\tif (!values) return []\n\treturn values.map(renderText)\n}\n\nconst clearPersons = () => {\n\tconst el = document.querySelector('.persons')\n\tel.innerHTML = ''\n}\n\nconst renderAdd = (handleAdd) => {\n\tconst el = document.createElement('div')\n\tconst name = document.createElement('input')\n\tconst birthday = document.createElement('input')\n\tconst save = document.createElement('button')\n\tname.placeholder = 'Name'\n\tbirthday.placeholder = 'Birthday (YYYY-MM-DD)'\n\tsave.innerText = 'Save'\n\tsave.addEventListener('click', () => {\n\t\thandleAdd(name.value, birthday.value)\n\t})\n\tel.appendChild(name)\n\tel.appendChild(birthday)\n\tel.appendChild(save)\n\treturn el\n}\n\nexport {clearPersons, renderPersons}\n","import {addListener, getState, setState} from './state.js'\nimport {updateContent} from './google-drive-api.js'\nimport * as view from './persons-view.js'\n\nconst setup = () => {\n\taddListener(update)\n}\n\nconst update = () => {\n\tupdatePersons()\n}\n\nconst updatePersons = () => {\n\tview.clearPersons()\n\trenderPersons(getState().persons)\n}\n\nconst renderPersons = (persons) => {\n\tconst personsView = persons\n\t\t.map(person => {\n\t\t\treturn {\n\t\t\t\t...person,\n\t\t\t\tage: getAge(person.birthday),\n\t\t\t\tdaysToBirthday: getDaysToBirthday(person.birthday),\n\t\t\t\tseenBefore: getSeenBefore(person.seen),\n\t\t\t\thandleEdit: edit,\n\t\t\t\thandleRemove: remove,\n\t\t\t}\n\t\t})\n\t\t.sort(sortByBirthday)\n\tview.renderPersons(personsView, addPerson)\n}\n\nconst sortByBirthday = (personA, personB) => {\n\tif (!personA.birthday || !personB.birthday) return 0\n\treturn getDaysToBirthday(personA.birthday) - getDaysToBirthday(personB.birthday)\n}\n\nconst getAge = (isoDay) => {\n\tif (!isoDay) return null\n\tconst now = Date.now()\n\tconst date = new Date(isoDay).getTime()\n\tconst diff = new Date(now - date)\n\tconst age = Math.abs(diff.getUTCFullYear() - 1970)\n\treturn age\n}\n\nconst getSeenBefore = (isoDay) => {\n\tif (!isoDay) return null\n\tconst now = Date.now()\n\tconst date = new Date(isoDay).getTime()\n\tconst days = Math.round((now - date) / 1000 / 60 / 60/ 24)\n\treturn days\n}\n\nconst getDaysToBirthday = (isoDate) => {\n\tif (!isoDate) return null\n\tconst birthday = new Date(isoDate)\n\tconst nowYear = new Date().getUTCFullYear()\n\tconst diff = Date.now() - new Date(`${nowYear}-${birthday.getMonth() + 1}-${birthday.getDate()}`).getTime()\n\tlet days\n\tif (diff < 0) {\n\t\t// this year\n\t\tdays = Math.abs(Math.ceil(diff / 1000 / 60 / 60 / 24))\n\t} else {\n\t\t// next year\n\t\tconst diffNext = Date.now() - new Date(`${nowYear + 1}-${birthday.getMonth() + 1}-${birthday.getDate()}`).getTime()\n\t\tdays = Math.abs(Math.ceil(diffNext / 1000 / 60 / 60 / 24))\n\t}\n\treturn days\n}\n\nconst addPerson = (name, birthday) => {\n\tconst error = getValidationError(name, birthday)\n\tif (error) {\n\t\talert(error)\n\t\treturn\n\t}\n\tsetState({view: 'loading'})\n\tupdateContent(getState().persons.concat({name, birthday}))\n}\n\nconst editPerson = (id, name, birthday) => {\n\tconst error = getValidationError(name, birthday)\n\tif (error) {\n\t\talert(error)\n\t\treturn\n\t}\n\tconst persons = getState().persons.map(person => {\n\t\tif (person.id !== id) return person\n\t\treturn {\n\t\t\t...person,\n\t\t\tname,\n\t\t\tbirthday\n\t\t}\n\t})\n\tsetState({view: 'loading'})\n\tupdateContent(persons)\n}\n\nconst getValidationError = (name, birthday) => {\n\tif (!name) {\n\t\treturn 'Empty name'\n\t}\n\tif (!birthday.match(/^\\d{4}-\\d{2}-\\d{2}$/)) {\n\t\treturn 'Wrong birthday format. Use YYYY-MM-DD.'\n\t}\n\treturn null\n}\n\nconst resetSeen = (id) => {\n\tconst persons = getState().persons.map((person) => {\n\t\tif (id !== person.id) return person\n\t\tconst now = new Date()\n\t\tconst year = now.getUTCFullYear()\n\t\tconst month = (now.getMonth() + 1 + '').padStart(2, '0')\n\t\tconst day = (now.getDate() + '').padStart(2, '0')\n\t\treturn {\n\t\t\t...person,\n\t\t\tseen: `${year}-${month}-${day}`,\n\t\t}\n\t})\n\tsetState({view: 'loading'})\n\tupdateContent(persons)\n}\n\nconst edit = (id) => {\n\tsetState({view: 'edit', editingPerson: id})\n}\nconst remove = (id) => {\n\t// TODO\n}\n\nexport {editPerson, resetSeen, setup}\n","import {addListener} from './state.js'\nimport {setState} from './state.js'\nimport {editPerson, resetSeen} from './persons-model.js'\n\nconst ELEMENTS = {\n\toverlay: {\n\t\tselector: 'div[data-prs=\"overlay\"]',\n\t\tshow: 'flex',\n\t},\n\tloader: {\n\t\tselector: 'div[data-prs=\"loader\"]',\n\t\tshow: 'block',\n\t},\n\tsingIn: {\n\t\tselector: 'button[data-prs=\"googleDriveButton\"]',\n\t\tshow: 'block',\n\t},\n\tedit: {\n\t\tselector: 'div[data-prs=\"edit\"]',\n\t\tshow: 'block',\n\t},\n}\n\nconst update = (state) => {\n\tshowElement(ELEMENTS.loader, state.view === 'loading')\n\tshowElement(ELEMENTS.singIn, state.view === 'signIn')\n\tshowElement(ELEMENTS.edit, state.view === 'edit')\n\tshowElement(ELEMENTS.overlay, ['loading', 'edit', 'signIn'].includes(state.view))\n\tif (state.view === 'edit' && state.editingPerson) {\n\t\trenderEdit(state.persons.find(({id}) => id === state.editingPerson))\n\t}\n}\n\nconst renderEdit = (person) => {\n\tconst el = document.querySelector(ELEMENTS.edit.selector)\n\tel.innerHTML = ''\n\tconst name = document.createElement('input')\n\tconst birthday = document.createElement('input')\n\tconst save = document.createElement('button')\n\tconst seen = document.createElement('button')\n\tconst cancel = document.createElement('button')\n\tsave.innerText = 'Save'\n\tseen.innerText = 'Seen today'\n\tcancel.innerText = 'Cancel'\n\tname.value = person.name\n\tbirthday.value = person.birthday\n\tsave.addEventListener('click', () => {\n\t\teditPerson(person.id, name.value, birthday.value)\n\t})\n\tseen.addEventListener('click', () => {\n\t\tresetSeen(person.id)\n\t})\n\tcancel.addEventListener('click', () => {\n\t\tsetState({view: 'persons', editingPerson: null})\n\t})\n\tel.appendChild(name)\n\tel.appendChild(birthday)\n\tel.appendChild(save)\n\tel.appendChild(seen)\n\tel.appendChild(cancel)\n}\n\nconst showElement = (element, show) => {\n\tconst el = document.querySelector(element.selector)\n\tel.style['display'] = show ? element.show : 'none'\n}\n\nexport const setup = () => {\n\taddListener(update)\n}\n","import {libLoaded as googleLibLoaded, setup as setupGoogleDrive} from './google-drive-model.js'\nimport {setup as setupPersonModel} from './persons-model.js'\nimport {setup as setupOverlay} from './overlay.js'\n\nconst setup = () => {\n\tsetupGoogleDrive()\n\tsetupOverlay()\n\tsetupPersonModel()\n}\n\nexport {\n\tgoogleLibLoaded,\n\tsetup,\n}\n\n"]}