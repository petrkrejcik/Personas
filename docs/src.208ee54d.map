{"version":3,"sources":["src/google-drive-api.js","src/state.js","src/google-drive-model.js","src/components/birthday-picker.js","src/components/icons.js","src/utils/date.js","src/persons-view.js","src/persons-model.js","src/overlay.js","src/index.js"],"names":["APP_FOLDER","FILE_NAME","onSignInChangeHandler","Function","onUpdateHandler","onErrorHandler","fileId","Object","folderId","defaultContent","init","options","setupOptions","Promise","resolve","reject","gapi","load","initClient","then","defaultContentOption","onError","onSignInChange","onUpdate","client","auth2","getAuthInstance","isSignedIn","listen","updateSignInStatus","get","isInitiated","isLogged","connect","fetchData","signIn","getFolder","getFile","getFileContent","drive","files","list","q","execute","response","length","createFolder","id","metadata","name","mimeType","create","resource","createFile","boundary","delimiter","parents","multipartRequestBody","JSON","stringify","request","alt","error","message","result","updateContent","content","path","method","body","fileContent","listeners","state","googleSyncEnabled","persons","isLoading","view","editingPerson","getState","setState","newState","dispatchUpdate","forEach","listener","addListener","push","setup","update","getGoogleSyncButton","addEventListener","window","libLoaded","updatePersons","updateGoogleButton","Array","isArray","map","person","unescape","Math","random","toString","substring","alert","isEnabled","removeAttribute","document","querySelector","birthdayPicker","day","month","year","createOptions","start","end","selected","keys","slice","i","option","createElement","innerText","value","dayEl","monthEl","yearEl","appendChild","edit","remove","parseDate","isoDate","date","Date","getDate","getMonth","getFullYear","createDate","createIso","d","padStart","formatDMY","renderPersons","handleAdd","el","renderPerson","renderAdd","classList","add","renderTitle","renderBirthday","birthday","age","daysToBirthday","renderSeen","seenBefore","renderCustomTexts","customTexts","filter","Boolean","field","handleEdit","bind","handleRemove","innerHTML","ICONS","renderText","birthdayDMY","days","values","clearPersons","save","placeholder","personsView","getAge","getDaysToBirthday","getSeenBefore","seen","sort","sortByBirthday","addPerson","personA","personB","isoDay","now","getTime","diff","abs","getUTCFullYear","round","nowYear","ceil","diffNext","getValidationError","concat","editPerson","match","resetSeen","confirm","ELEMENTS","overlay","selector","show","loader","singIn","showElement","includes","renderEdit","find","cancel","element","style"],"mappings":"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","file":"src.208ee54d.map","sourceRoot":"..","sourcesContent":["const APP_FOLDER = 'App-Personas'\nconst FILE_NAME = 'persons.json'\nlet onSignInChangeHandler = Function\nlet onUpdateHandler = Function\nlet onErrorHandler = Function\nlet fileId = Object\nlet folderId = Object\nlet defaultContent = null\n\nconst init = (options = {}) => {\n\tsetupOptions(options)\n\treturn new Promise ((resolve, reject) => {\n\t\tgapi.load('client:auth2', () => {\n\t\t\tinitClient().then(resolve)\n\t\t})\n\t})\n}\n\nconst setupOptions = ({defaultContent: defaultContentOption, onError, onSignInChange, onUpdate}) => {\n\tif (onSignInChange) onSignInChangeHandler = onSignInChange\n\tif (onUpdate) onUpdateHandler = onUpdate\n\tif (onError) onErrorHandler = onError\n\tif (defaultContentOption) defaultContent = defaultContentOption\n}\n\nconst initClient = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tgapi.client.init({\n\t\t\t'apiKey': 'AIzaSyBYItpNT8k2Y2AEHz2E2kI2EqMULh5C4m0',\n\t\t\t'discoveryDocs': ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],\n\t\t\t'clientId': '614338309616-st9nui22tf3sa1cm9m1l3nd439n50frg.apps.googleusercontent.com',\n\t\t\t'scope': 'https://www.googleapis.com/auth/drive.file'\n\t\t})\n\t\t.then(() => {\n\t\t\tgapi.auth2.getAuthInstance().isSignedIn.listen(updateSignInStatus)\n\t\t\tupdateSignInStatus(gapi.auth2.getAuthInstance().isSignedIn.get())\n\t\t\tresolve({isInitiated: true})\n\t\t})\n\t})\n}\n\nconst updateSignInStatus = (isLogged) => {\n\tonSignInChangeHandler(isLogged)\n}\n\nconst connect = () => {\n\tif (gapi.auth2.getAuthInstance().isSignedIn.get()) {\n\t\tfetchData()\n\t} else {\n\t\tgapi.auth2.getAuthInstance().signIn()\n\t}\n}\n\nconst fetchData = () => {\n\treturn getFolder()\n\t.then(getFile)\n\t.then(getFileContent)\n}\n\nconst getFolder = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst request = gapi.client.drive.files.list({\n\t\t\tq: `name='${APP_FOLDER}' and trashed=false`,\n\t\t})\n\n\t\trequest.execute((response) => {\n\t\t\tif (response.files.length === 0) {\n\t\t\t\tcreateFolder().then(resolve)\n\t\t\t} else {\n\t\t\t\tfolderId = response.files[0].id\n\t\t\t\tresolve()\n\t\t\t}\n\t\t})\n\t})\n}\n\nconst createFolder = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst metadata = {\n\t\t\tname: APP_FOLDER,\n\t\t\tmimeType: 'application/vnd.google-apps.folder'\n\t\t}\n\t\tconst request = gapi.client.drive.files.create({resource: metadata})\n\t\trequest.execute((response) => {\n\t\t\tfolderId = response.id\n\t\t\tresolve()\n\t\t})\n\t})\n}\n\nconst getFile = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst request = gapi.client.drive.files.list({\n\t\t\tq: `name=\"${FILE_NAME}\" and '${folderId}' in parents and trashed=false`,\n\t\t})\n\t\trequest.execute((response) => {\n\t\t\tif (response.files.length === 0) {\n\t\t\t\tcreateFile().then(resolve)\n\t\t\t} else {\n\t\t\t\tfileId = response.files[0].id\n\t\t\t\tresolve()\n\t\t\t}\n\t\t})\n\t})\n}\nconst createFile = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst boundary = '-------314159265358979323846'\n\t\tconst delimiter = \"\\r\\n--\" + boundary + \"\\r\\n\"\n\t\tconst close_delim = \"\\r\\n--\" + boundary + \"--\"\n\n\t\tconst contentType = 'application/json'\n\n\t\tconst metadata = {\n\t\t\tname: FILE_NAME,\n\t\t\tmimeType: contentType,\n\t\t\tparents: [folderId],\n\t\t}\n\n\t\tconst multipartRequestBody =\n\t\t\tdelimiter +\n\t\t\t'Content-Type: application/json\\r\\n\\r\\n' +\n\t\t\tJSON.stringify(metadata) +\n\t\t\tdelimiter +\n\t\t\t'Content-Type: ' + contentType + '\\r\\n\\r\\n' +\n\t\t\t(defaultContent ? JSON.stringify(defaultContent) : '') +\n\t\t\tclose_delim\n\n\t\tconst request = gapi.client.request({\n\t\t\t'path': '/upload/drive/v3/files',\n\t\t\t'method': 'POST',\n\t\t\t'params': {'uploadType': 'multipart'},\n\t\t\t'headers': {\n\t\t\t  'Content-Type': 'multipart/related; boundary=\"' + boundary + '\"'\n\t\t\t},\n\t\t\t'body': multipartRequestBody\n\t\t})\n\n\t\trequest.execute((response) => {\n\t\t\tfileId = response.id\n\t\t\tresolve()\n\t\t})\n\t})\n}\n\nconst getFileContent = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst request = gapi.client.drive.files.get({\n\t\t\tfileId: fileId,\n\t\t\talt: 'media',\n\t\t})\n\t\trequest.execute((response) => {\n\t\t\tif (response.error) {\n\t\t\t\tonErrorHandler(`Error during file download: ${response.error.message}`)\n\t\t\t\treturn\n\t\t\t}\n\t\t\tresolve(response.result)\n\t\t})\n\t})\n}\n\nconst updateContent = (content) => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst request = gapi.client.request({\n\t\t\tpath: '/upload/drive/v2/files/' + fileId,\n\t\t\tmethod: 'PUT',\n\t\t\talt: 'media',\n\t\t\tbody: content,\n\t\t})\n\t\trequest.execute((response) => {\n\t\t\tif (response.error) {\n\t\t\t\tonErrorHandler(`Error during sync: ${response.error.message}`)\n\t\t\t\treturn\n\t\t\t}\n\t\t\tgetFileContent().then((fileContent) => {\n\t\t\t\tonUpdateHandler(fileContent)\n\t\t\t\tresolve(fileContent)\n\t\t\t})\n\t\t})\n\t})\n}\n\nexport {\n\tconnect,\n\tfetchData,\n\tinit,\n\tupdateContent,\n}","const listeners = []\nlet state = {\n\tgoogleSyncEnabled: false,\n\tisSignedIn: false,\n\tpersons: [],\n\tisLoading: true,\n\tview: 'loading',\n\teditingPerson: null,\n}\n\nconst getState = () => {\n\treturn state\n}\n\nconst setState = (newState) => {\n\tstate = {\n\t\t...state,\n\t\t...newState,\n\t}\n\tdispatchUpdate()\n}\n\nconst dispatchUpdate = () => {\n\tlisteners.forEach(listener => {\n\t\tlistener(getState())\n\t})\n}\n\nconst addListener = (listener) => {\n\tlisteners.push(listener)\n}\n\nexport {addListener, getState, dispatchUpdate, setState}\n","import {connect, fetchData, init} from './google-drive-api.js'\nimport {addListener, getState, setState} from './state.js'\n\nconst setup = () => {\n\taddListener(update)\n\tgetGoogleSyncButton().addEventListener('click', connect)\n\twindow.getState = getState\n}\n\nconst libLoaded = () => {\n\tconst options = {\n\t\tonSignInChange: onSignInChange,\n\t\tonUpdate: updatePersons,\n\t\tonError: onError,\n\t\tdefaultContent: [],\n\t\t// TODO: apiKey, etc\n\t}\n\tinit(options).then((result) => {\n\t\tconst {isInitiated} = result\n\t\tsetState({'googleSyncEnabled': isInitiated})\n\t})\n}\n\nconst update = (state) => {\n\tupdateGoogleButton(state.googleSyncEnabled)\n}\n\nconst updatePersons = (persons) => {\n\tif (!Array.isArray(persons)) {\n\t\tonError('Unknown reposonse from server')\n\t}\n\tpersons = persons.map(person => {\n\t\treturn {\n\t\t\t...person,\n\t\t\tname: unescape(person.name),\n\t\t\tid: Math.random().toString(36).substring(10),\n\t\t}\n\t})\n\tsetState({persons, view: 'persons'})\n}\n\nconst onSignInChange = (isSignedIn) => {\n\tif (isSignedIn) {\n\t\tsetState({isSignedIn, view: 'loading'})\n\t\tfetchData().then(updatePersons)\n\t} else {\n\t\tsetState({isSignedIn, view: 'signIn'})\n\t}\n}\n\nconst onError = (error) => {\n\tsetState({view: 'error'})\n\talert(error)\n}\n\nconst updateGoogleButton = (isEnabled) => {\n\tif (isEnabled) {\n\t\tgetGoogleSyncButton().removeAttribute('disabled')\n\t}\n}\n\nconst getGoogleSyncButton = () => {\n\treturn document.querySelector('button[data-prs=\"googleDriveButton\"]')\n}\n\nexport {libLoaded, setup}\n","export const birthdayPicker = ({day, month, year}) => {\n\tconst createOptions = (start, end, selected) => {\n\t\treturn [...Array(end + 1).keys()].slice(start).map(i => {\n\t\t\tconst option = document.createElement('option')\n\t\t\toption.innerText = i\n\t\t\toption.value = i\n\t\t\tif (selected && i === selected) option.selected = true\n\t\t\treturn option\n\t\t})\n\t}\n\tconst dayEl = document.createElement('select')\n\tconst monthEl = document.createElement('select')\n\tconst yearEl = document.createElement('select')\n\tconst dayOptions = createOptions(1, 31, day).forEach(option => dayEl.appendChild(option))\n\tconst monthOptions = createOptions(1, 12, month).forEach(option => monthEl.appendChild(option))\n\tconst yearOptions = createOptions(1900, 2019, year).forEach(option => yearEl.appendChild(option))\n\treturn [dayEl, monthEl, yearEl]\n}\n","export default {\n\tedit: `\n\t\t<svg version=\"1.1\" id=\"Capa_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\"\n\t\t\t viewBox=\"0 0 469.331 469.331\" style=\"enable-background:new 0 0 469.331 469.331;\" xml:space=\"preserve\">\n\t\t\t<g>\n\t\t\t\t<path d=\"M438.931,30.403c-40.4-40.5-106.1-40.5-146.5,0l-268.6,268.5c-2.1,2.1-3.4,4.8-3.8,7.7l-19.9,147.4\n\t\t\t\t\tc-0.6,4.2,0.9,8.4,3.8,11.3c2.5,2.5,6,4,9.5,4c0.6,0,1.2,0,1.8-0.1l88.8-12c7.4-1,12.6-7.8,11.6-15.2c-1-7.4-7.8-12.6-15.2-11.6\n\t\t\t\t\tl-71.2,9.6l13.9-102.8l108.2,108.2c2.5,2.5,6,4,9.5,4s7-1.4,9.5-4l268.6-268.5c19.6-19.6,30.4-45.6,30.4-73.3\n\t\t\t\t\tS458.531,49.903,438.931,30.403z M297.631,63.403l45.1,45.1l-245.1,245.1l-45.1-45.1L297.631,63.403z M160.931,416.803l-44.1-44.1\n\t\t\t\t\tl245.1-245.1l44.1,44.1L160.931,416.803z M424.831,152.403l-107.9-107.9c13.7-11.3,30.8-17.5,48.8-17.5c20.5,0,39.7,8,54.2,22.4\n\t\t\t\t\ts22.4,33.7,22.4,54.2C442.331,121.703,436.131,138.703,424.831,152.403z\"/>\n\t\t\t</g>\n\t\t</svg>\n\t`,\n\tremove: `\n\t\t<svg version=\"1.1\" id=\"Capa_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\"\n\t\t\t viewBox=\"0 0 486.4 486.4\" style=\"enable-background:new 0 0 486.4 486.4;\" xml:space=\"preserve\">\n\t\t\t<g>\n\t\t\t\t<g>\n\t\t\t\t\t<path d=\"M446,70H344.8V53.5c0-29.5-24-53.5-53.5-53.5h-96.2c-29.5,0-53.5,24-53.5,53.5V70H40.4c-7.5,0-13.5,6-13.5,13.5\n\t\t\t\t\t\tS32.9,97,40.4,97h24.4v317.2c0,39.8,32.4,72.2,72.2,72.2h212.4c39.8,0,72.2-32.4,72.2-72.2V97H446c7.5,0,13.5-6,13.5-13.5\n\t\t\t\t\t\tS453.5,70,446,70z M168.6,53.5c0-14.6,11.9-26.5,26.5-26.5h96.2c14.6,0,26.5,11.9,26.5,26.5V70H168.6V53.5z M394.6,414.2\n\t\t\t\t\t\tc0,24.9-20.3,45.2-45.2,45.2H137c-24.9,0-45.2-20.3-45.2-45.2V97h302.9v317.2H394.6z\"/>\n\t\t\t\t\t<path d=\"M243.2,411c7.5,0,13.5-6,13.5-13.5V158.9c0-7.5-6-13.5-13.5-13.5s-13.5,6-13.5,13.5v238.5\n\t\t\t\t\t\tC229.7,404.9,235.7,411,243.2,411z\"/>\n\t\t\t\t\t<path d=\"M155.1,396.1c7.5,0,13.5-6,13.5-13.5V173.7c0-7.5-6-13.5-13.5-13.5s-13.5,6-13.5,13.5v208.9\n\t\t\t\t\t\tC141.6,390.1,147.7,396.1,155.1,396.1z\"/>\n\t\t\t\t\t<path d=\"M331.3,396.1c7.5,0,13.5-6,13.5-13.5V173.7c0-7.5-6-13.5-13.5-13.5s-13.5,6-13.5,13.5v208.9\n\t\t\t\t\t\tC317.8,390.1,323.8,396.1,331.3,396.1z\"/>\n\t\t\t\t</g>\n\t\t\t</g>\n\t\t</svg>\n\t`,\n}\n","export const parseDate = (isoDate) => {\n\tconst date = new Date(isoDate)\n\tconst day = date.getDate()\n\tconst month = date.getMonth() + 1\n\tconst year = date.getFullYear()\n\treturn {day, month, year}\n}\n\nexport const createDate = (day, month, year) => {\n\treturn new Date(year, month - 1, day)\n\treturn `${year}-${month}-${day}`\n}\n\nexport const createIso = (day, month, year) => {\n\tconst d = day.padStart(2, '0')\n\tconst m = month.padStart(2, '0')\n\treturn `${year}-${m}-${d}`\n}\n\nexport const formatDMY = (isoDate) => {\n\tconst {day, month, year} = parseDate(isoDate)\n\treturn `${day}. ${month}. ${year}`\n}","import {birthdayPicker} from './components/birthday-picker.js'\nimport ICONS from './components/icons.js'\nimport {formatDMY} from './utils/date.js'\n\nconst renderPersons = (persons, handleAdd) => {\n\tconst el = document.querySelector('.persons')\n\tpersons\n\t\t.map(renderPerson)\n\t\t.forEach(person => el.appendChild(person))\n\tel.appendChild(renderAdd(handleAdd))\n}\n\nconst renderPerson = (person) => {\n\tconst el = document.createElement('div')\n\tel.classList.add('person')\n\tconst fields = [\n\t\trenderTitle(person.name),\n\t\trenderBirthday(person.birthday, person.age, person.daysToBirthday),\n\t\trenderSeen(person.seenBefore),\n\t\t...renderCustomTexts(person.customTexts),\n\t]\n\tfields\n\t.filter(Boolean)\n\t.forEach(field => el.appendChild(field))\n\tconst edit = document.createElement('div')\n\tconst remove = document.createElement('div')\n\tedit.classList.add('icon-edit', 'icon')\n\tremove.classList.add('icon-remove', 'icon')\n\tedit.addEventListener('click', person.handleEdit.bind(null, person.id))\n\tremove.addEventListener('click', person.handleRemove.bind(null, person.id))\n\tedit.innerHTML = ICONS.edit\n\tremove.innerHTML = ICONS.remove\n\tel.appendChild(remove)\n\tel.appendChild(edit)\n\treturn el\n}\n\nconst renderTitle = (value) => {\n\tconst el = renderText(value)\n\tel.classList.add('person-title')\n\treturn el\n}\n\nconst renderText = (value) => {\n\tconst el = document.createElement('div')\n\tel.innerHTML = value\n\treturn el\n}\n\nconst renderBirthday = (birthday, age, daysToBirthday) => {\n\tif (!birthday) return null\n\tconst el = document.createElement('div')\n\tconst birthdayDMY = formatDMY(birthday)\n\tel.innerHTML = `Age: ${age}<br />Birthday in ${daysToBirthday} days (${birthdayDMY})`\n\treturn el\n}\n\nconst renderSeen = (days) => {\n\tif (!days && days !== 0) return null\n\tconst el = document.createElement('div')\n\tconst button = document.createElement('button')\n\tel.innerHTML = `Seen before ${days} days`\n\treturn el\n}\n\nconst renderCustomTexts = (values) => {\n\tif (!values) return []\n\treturn values.map(renderText)\n}\n\nconst clearPersons = () => {\n\tconst el = document.querySelector('.persons')\n\tel.innerHTML = ''\n}\n\nconst renderAdd = (handleAdd) => {\n\tconst el = document.createElement('div')\n\tconst name = document.createElement('input')\n\tconst [day, month, year] = birthdayPicker({day: 1, month: 1, year: 1980})\n\tconst save = document.createElement('button')\n\tname.placeholder = 'Name'\n\tsave.innerText = 'Save'\n\tsave.addEventListener('click', () => {\n\t\thandleAdd(name.value, day.value, month.value, year.value)\n\t})\n\tel.appendChild(name)\n\tel.appendChild(day)\n\tel.appendChild(month)\n\tel.appendChild(year)\n\tel.appendChild(save)\n\treturn el\n}\n\nexport {clearPersons, renderPersons}\n","import {addListener, getState, setState} from './state.js'\nimport {updateContent} from './google-drive-api.js'\nimport * as view from './persons-view.js'\nimport {createIso} from './utils/date.js'\n\nconst setup = () => {\n\taddListener(update)\n}\n\nconst update = () => {\n\tupdatePersons()\n}\n\nconst updatePersons = () => {\n\tview.clearPersons()\n\trenderPersons(getState().persons)\n}\n\nconst renderPersons = (persons) => {\n\tconst personsView = persons\n\t\t.map(person => {\n\t\t\treturn {\n\t\t\t\t...person,\n\t\t\t\tage: getAge(person.birthday),\n\t\t\t\tdaysToBirthday: getDaysToBirthday(person.birthday),\n\t\t\t\tseenBefore: getSeenBefore(person.seen),\n\t\t\t\thandleEdit: edit,\n\t\t\t\thandleRemove: remove,\n\t\t\t}\n\t\t})\n\t\t.sort(sortByBirthday)\n\tview.renderPersons(personsView, addPerson)\n}\n\nconst sortByBirthday = (personA, personB) => {\n\tif (!personA.birthday || !personB.birthday) return 0\n\treturn getDaysToBirthday(personA.birthday) - getDaysToBirthday(personB.birthday)\n}\n\nconst getAge = (isoDay) => {\n\tif (!isoDay) return null\n\tconst now = Date.now()\n\tconst date = new Date(isoDay).getTime()\n\tconst diff = new Date(now - date)\n\tconst age = Math.abs(diff.getUTCFullYear() - 1970)\n\treturn age\n}\n\nconst getSeenBefore = (isoDay) => {\n\tif (!isoDay) return null\n\tconst now = Date.now()\n\tconst date = new Date(isoDay).getTime()\n\tconst days = Math.round((now - date) / 1000 / 60 / 60/ 24)\n\treturn days\n}\n\nconst getDaysToBirthday = (isoDate) => {\n\tif (!isoDate) return null\n\tconst birthday = new Date(isoDate)\n\tconst nowYear = new Date().getUTCFullYear()\n\tconst diff = Date.now() - new Date(`${nowYear}-${birthday.getMonth() + 1}-${birthday.getDate()}`).getTime()\n\tlet days\n\tif (diff < 0) {\n\t\t// this year\n\t\tdays = Math.abs(Math.ceil(diff / 1000 / 60 / 60 / 24))\n\t} else {\n\t\t// next year\n\t\tconst diffNext = Date.now() - new Date(`${nowYear + 1}-${birthday.getMonth() + 1}-${birthday.getDate()}`).getTime()\n\t\tdays = Math.abs(Math.ceil(diffNext / 1000 / 60 / 60 / 24))\n\t}\n\treturn days\n}\n\nconst addPerson = (name, day, month, year) => {\n\tconst birthday = createIso(day, month, year)\n\tconst error = getValidationError(name, birthday)\n\tif (error) {\n\t\talert(error)\n\t\treturn\n\t}\n\tsetState({view: 'loading'})\n\tupdateContent(getState().persons.concat({name, birthday}))\n}\n\nconst editPerson = (id, name, day, month, year) => {\n\tconst birthday = createIso(day, month, year)\n\tconst error = getValidationError(name, birthday)\n\tif (error) {\n\t\talert(error)\n\t\treturn\n\t}\n\tconst persons = getState().persons.map(person => {\n\t\tif (person.id !== id) return person\n\t\treturn {\n\t\t\t...person,\n\t\t\tname,\n\t\t\tbirthday\n\t\t}\n\t})\n\tsetState({view: 'loading'})\n\tupdateContent(persons)\n}\n\nconst getValidationError = (name, birthday) => {\n\tif (!name) {\n\t\treturn 'Empty name'\n\t}\n\tif (!birthday.match(/^\\d{4}-\\d{2}-\\d{2}$/)) {\n\t\treturn 'Wrong birthday format. Use YYYY-MM-DD.'\n\t}\n\treturn null\n}\n\nconst resetSeen = (id) => {\n\tconst persons = getState().persons.map((person) => {\n\t\tif (id !== person.id) return person\n\t\tconst now = new Date()\n\t\tconst year = now.getUTCFullYear()\n\t\tconst month = (now.getMonth() + 1 + '').padStart(2, '0')\n\t\tconst day = (now.getDate() + '').padStart(2, '0')\n\t\treturn {\n\t\t\t...person,\n\t\t\tseen: `${year}-${month}-${day}`,\n\t\t}\n\t})\n\tsetState({view: 'loading'})\n\tupdateContent(persons)\n}\n\nconst edit = (id) => {\n\tsetState({view: 'edit', editingPerson: id})\n}\nconst remove = (id) => {\n\tif (!confirm('Delete person?')) return\n\tconst persons = getState().persons.filter((person) => person.id !== id)\n\tsetState({view: 'loading'})\n\tupdateContent(persons)\n}\n\nexport {editPerson, resetSeen, setup}\n","import {addListener} from './state.js'\nimport {setState} from './state.js'\nimport {editPerson, resetSeen} from './persons-model.js'\nimport {parseDate} from './utils/date.js'\nimport {birthdayPicker} from './components/birthday-picker.js'\n\nconst ELEMENTS = {\n\toverlay: {\n\t\tselector: 'div[data-prs=\"overlay\"]',\n\t\tshow: 'flex',\n\t},\n\tloader: {\n\t\tselector: 'div[data-prs=\"loader\"]',\n\t\tshow: 'block',\n\t},\n\tsingIn: {\n\t\tselector: 'button[data-prs=\"googleDriveButton\"]',\n\t\tshow: 'block',\n\t},\n\tedit: {\n\t\tselector: 'div[data-prs=\"edit\"]',\n\t\tshow: 'block',\n\t},\n}\n\nconst update = (state) => {\n\tshowElement(ELEMENTS.loader, state.view === 'loading')\n\tshowElement(ELEMENTS.singIn, state.view === 'signIn')\n\tshowElement(ELEMENTS.edit, state.view === 'edit')\n\tshowElement(ELEMENTS.overlay, ['loading', 'edit', 'signIn'].includes(state.view))\n\tif (state.view === 'edit' && state.editingPerson) {\n\t\trenderEdit(state.persons.find(({id}) => id === state.editingPerson))\n\t}\n}\n\nconst renderEdit = (person) => {\n\tconst el = document.querySelector(ELEMENTS.edit.selector)\n\tel.innerHTML = ''\n\tconst name = document.createElement('input')\n\tconst [day, month, year] = birthdayPicker(parseDate(person.birthday))\n\tconst save = document.createElement('button')\n\tconst seen = document.createElement('button')\n\tconst cancel = document.createElement('button')\n\tseen.classList.add('seen-save')\n\tsave.classList.add('edit-save')\n\tsave.innerText = 'Save'\n\tseen.innerText = 'Seen today'\n\tcancel.innerText = 'Cancel'\n\tname.value = person.name\n\tsave.addEventListener('click', () => {\n\t\teditPerson(person.id, name.value, day.value, month.value, year.value)\n\t})\n\tseen.addEventListener('click', () => {\n\t\tresetSeen(person.id)\n\t})\n\tcancel.addEventListener('click', () => {\n\t\tsetState({view: 'persons', editingPerson: null})\n\t})\n\tel.appendChild(name)\n\tel.appendChild(day)\n\tel.appendChild(month)\n\tel.appendChild(year)\n\tel.appendChild(seen)\n\tel.appendChild(save)\n\tel.appendChild(cancel)\n}\n\nconst showElement = (element, show) => {\n\tconst el = document.querySelector(element.selector)\n\tel.style['display'] = show ? element.show : 'none'\n}\n\nexport const setup = () => {\n\taddListener(update)\n}\n","import {libLoaded as googleLibLoaded, setup as setupGoogleDrive} from './google-drive-model.js'\nimport {setup as setupPersonModel} from './persons-model.js'\nimport {setup as setupOverlay} from './overlay.js'\n\nconst setup = () => {\n\tsetupGoogleDrive()\n\tsetupOverlay()\n\tsetupPersonModel()\n}\n\nexport {\n\tgoogleLibLoaded,\n\tsetup,\n}\n\n"]}