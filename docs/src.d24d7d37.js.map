{"version":3,"sources":["data-provider/actions.js","person/person-actions.js","store/reducer.js","store/store.js","app/app-action.js","data-provider/data-provider.js","router/routes.js","router/router-actions.js","utils/date.js","person/person-util.js","person/person-model.js","utils/dom.js","components/icons.js","header/header.js","components/birthday-picker.js","person/person-add-edit-view.js","person/person-view.js","router/router.js","app/use-local-storage.js","data-provider/google-drive/google-drive-api.js","data-provider/google-drive/google-drive-model.js","index.js"],"names":["ACTIONS","LIB_LOADED","SYNC_CLICK","SYNC_START","SYNC_END","LOGIN","SET","syncStart","type","syncEnd","setProviders","providers","payload","editField","editPerson","save","FETCH","ADD","REMOVE","TOGGLE_DELETE_OVERLAY","TOGGLE_ADD","field","value","person","remove","id","saveAll","persons","toggleAdd","isVisible","reducer","state","action","PERSON","_","personEdit","deleteOverlayId","isAddingPerson","APP","setActiveElement","activeElement","DATA_PROVIDER","isSyncing","dataProviders","listeners","listenersAfter","getState","setState","newState","dispatch","console","log","forEach","listener","fn","subscribe","callback","push","subscribeAfter","init","storeActiveElement","el","document","key","getAttribute","getActiveElement","querySelector","defaultResult","updated","run","register","provider","merge","newer","older","_newer","getProviders","filter","isEnabled","isLogged","cleanResult","result","sync","promisesGet","map","get","results","Promise","all","reduce","providersToSync","promisesSet","i","set","localToRemote","setData","promises","catch","err","error","syncClick","p","loginProvider","login","resolve","data","Date","getTime","dataWithUpdated","dataProvider","isSyncOk","allOk","isOk","APP_ACTIONS","ROUTES","home","add","edit","go","goToAdd","goToEdit","goToHome","goToLogin","parseDate","isoDate","date","day","getDate","month","getMonth","year","getFullYear","createDate","createIso","d","padStart","formatDMY","getNow","diffDays","fromDate","toDate","join","fromDay","fromMonth","toDay","toMonth","toYear","from","diff","Math","ceil","createId","name","trim","toLowerCase","split","Boolean","DEFAULTS","getProps","getPersons","isAdd","onSave","onCancel","Object","values","now","birthday","age","getAge","daysToBirthday","parseInt","seenBefore","getSeenBefore","seen","onEditClick","onRemoveClick","toggleRemoveOverlay","cancelRemove","sort","sortByBirthday","personRest","personA","personB","getBirthday","isoDay","abs","getUTCFullYear","days","round","getValidationError","match","addTestAttribute","element","window","Cypress","setAttribute","createDom","tag","attrs","children","createElement","attachAttributeToEl","attachAttribute","keys","Array","isArray","child","innerHTML","createTextNode","appendChild","addEventListener","className","classList","div","theArgs","warn","render","spaceEl","renderTitle","renderSync","renderAdd","c","classNames","testId","ICONS","onClick","DEFAULT_PERSON","birthdayPicker","onChange","createOptions","start","end","selected","options","length","v","k","option","innerText","dayEl","monthEl","yearEl","onChangeCb","ev","target","props","Error","renderName","renderPicker","renderSaveButton","renderRemoveButton","onRemove","renderCancelButton","placeholder","e","clearPersons","renderEmpty","renderPerson","renderRemoveOverlay","renderEditOverlay","bind","renderBirthday","renderSeen","renderCustomTexts","customTexts","onConfirmClick","onCancelClick","createPersonEl","renderText","text","getRoute","location","pathname","substring","path","history","pushState","route","body","personModel","app","getElementById","focus","setup","onpopstate","storage","localStorage","json","JSON","stringify","setItem","parse","getItem","APP_FOLDER","FILE_NAME","onSignInChangeHandler","Function","fileId","folderId","defaultContent","setupOptions","reject","gapi","load","initClient","then","defaultContentOption","onSignInChange","client","auth2","getAuthInstance","isSignedIn","listen","updateSignInStatus","isInitiated","signIn","fetchData","getFolder","getFile","getFileContent","drive","files","list","q","execute","response","createFolder","metadata","mimeType","create","resource","createFile","boundary","delimiter","parents","multipartRequestBody","request","alt","message","content","info","method","fileContent","_isEnabled","onLibLoaded","defaultOptions","onError","alert","unescape","store","googleDrive","navigator","serviceWorker"],"mappings":"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","file":"src.d24d7d37.js","sourceRoot":"../src","sourcesContent":["export const ACTIONS = {\n\tLIB_LOADED: 'data-provider/lib-loaded',\n\tSYNC_CLICK: 'data-provider/sync-click', // on click\n\tSYNC_START: 'data-provider/sync-start',\n\tSYNC_END: 'data-provider/sync-end',\n\tLOGIN: 'data-provider/login',\n\tSET: 'data-provider/set', // sets providers in store\n};\n\nexport const syncStart = () => ({type: ACTIONS.SYNC_START});\nexport const syncEnd = () => ({type: ACTIONS.SYNC_END});\nexport const setProviders = (providers) => ({type: ACTIONS.SET, payload: providers});\n","export const ACTIONS = {\n\teditField: 'person/editField', // when typing in add/edit fields\n\teditPerson: 'person/editPerson', // when setting all fields to edit\n\tsave: 'person/save', // when saving added/edited person\n\tFETCH: 'person/fetch',\n\tSET: 'person/set', // when setting from remote storage\n\tADD: 'person/add',\n\tREMOVE: 'person/remove',\n\tTOGGLE_DELETE_OVERLAY: 'person/toggleDeleteOverlay',\n\tTOGGLE_ADD: 'person/toggleAdd',\n};\n\n/**\n * Sets a value to a one field in `personEdit` value in state.\n * @param {string} field\n * @param {any} value\n */\nexport const editField = (field, value) => ({type: ACTIONS.editField, payload: {field, value}});\n\n/**\n * Sets person as `personEdit` into state.\n * @param {PersonEdit?} person\n */\nexport const editPerson = (person) => ({type: ACTIONS.editPerson, payload: person});\n\n/**\n * Saves one person into the state.\n * @param {Person} person\n */\nexport const save = (person) => ({type: ACTIONS.save, payload: person});\n\n/**\n * Removes person from state.\n * @param {string} id\n */\nexport const remove = (id) => ({type: ACTIONS.REMOVE, payload: id});\n\n/**\n * Saves all persons to the state and overwrites all existing.\n * @param {Person[]} persons\n */\nexport const saveAll = (persons) => ({type: ACTIONS.SET, payload: persons});\nexport const toggleAdd = (isVisible) => ({type: ACTIONS.TOGGLE_ADD, payload: isVisible});\n","import {ACTIONS as PERSON} from '../person/person-actions';\nimport {ACTIONS as DATA_PROVIDER} from '../data-provider/actions';\nimport {ACTIONS as APP} from '../app/app-action';\n\n/**\n * Creates a new state based on action.\n *\n * @param {State} state state\n * @param {Action} action action\n */\nexport const reducer = (state, action) => {\n\tswitch (action.type) {\n\t\tcase PERSON.save: {\n\t\t\tconst persons = {\n\t\t\t\t...state.persons,\n\t\t\t\t[action.payload.id]: action.payload,\n\t\t\t};\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tpersons,\n\t\t\t};\n\t\t}\n\t\tcase PERSON.SET: {\n\t\t\treturn {\n\t\t\t\tpersons: action.payload,\n\t\t\t};\n\t\t}\n\t\t// case PERSON.ADD: {\n\t\t// \tconst persons = state.persons.concat(action.payload)\n\t\t// \treturn {\n\t\t// \t\t...state,\n\t\t// \t\tpersons,\n\t\t// \t}\n\t\t// }\n\t\tcase PERSON.REMOVE: {\n\t\t\tconst {payload} = action;\n\t\t\tif (typeof payload !== 'string') return state;\n\t\t\t// @ts-ignore\n\t\t\tconst {[payload]: _, ...persons} = state.persons;\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tpersons,\n\t\t\t};\n\t\t}\n\t\tcase PERSON.editField: {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tpersonEdit: {\n\t\t\t\t\t...state.personEdit,\n\t\t\t\t\t[action.payload.field]: action.payload.value,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t\tcase PERSON.editPerson: {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tpersonEdit: action.payload,\n\t\t\t};\n\t\t}\n\t\tcase PERSON.TOGGLE_DELETE_OVERLAY: {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tdeleteOverlayId: action.payload,\n\t\t\t};\n\t\t}\n\t\tcase PERSON.TOGGLE_ADD: {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisAddingPerson: action.payload,\n\t\t\t};\n\t\t}\n\t\tcase APP.setActiveElement: {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tactiveElement: action.payload,\n\t\t\t};\n\t\t}\n\t\tcase DATA_PROVIDER.SYNC_START: {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisSyncing: true,\n\t\t\t};\n\t\t}\n\t\tcase DATA_PROVIDER.SYNC_END: {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisSyncing: false,\n\t\t\t};\n\t\t}\n\t\tcase DATA_PROVIDER.SET: {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tdataProviders: [...action.payload],\n\t\t\t};\n\t\t}\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n","import {reducer} from './reducer';\n\n/** @type {Array<Function>} */\nconst listeners = [];\n\n/** @type {Array<Function>} */\nconst listenersAfter = [];\n\n/** @type {State} */\nlet state = {\n\tpersons: {},\n};\n\n/**\n * Returns state\n * @returns {State}\n */\nconst getState = () => {\n\treturn state;\n};\n\n/**\n * Sets a new state\n * @param {State} newState\n */\nconst setState = (newState) => {\n\tstate = {\n\t\t...state,\n\t\t...newState,\n\t};\n};\n\n/**\n * Dispatches an action which goes to the reducer.\n * @param {Action} action\n */\nconst dispatch = (action) => {\n\tconst state = getState();\n\tconsole.log('🔊', action.type, action.payload || '');\n\tif (!action.type) return;\n\tconst newState = reducer(state, action);\n\tsetState(newState);\n\tlisteners.forEach(listener => {\n\t\tlistener(action);\n\t});\n\tlistenersAfter.forEach(fn => {\n\t\tfn(action);\n\t});\n};\n\n/**\n * Subscribes to a state update.\n *\n * @param {Function} callback Called after state is updated\n */\nconst subscribe = (callback) => {\n\tlisteners.push(callback);\n};\n\n/**\n * Adds listenersAfter to stack.\n * @param {Function} fn\n */\nconst subscribeAfter = (fn) => {\n\tlistenersAfter.push(fn);\n};\n\nexport {\n\tsubscribeAfter,\n\tsubscribe,\n\tdispatch,\n\tgetState,\n};\n","import {getState} from '../store/store';\n\nexport const ACTIONS = {\n\tsetActiveElement: 'utils/set-active-element',\n\tinit: 'app/init',\n};\n\nexport const storeActiveElement = () => {\n\tconst el = document.activeElement;\n\tif (!el) return {type: ''};\n\tconst key = el.getAttribute('data-prsKey');\n\tif (!key) return {type: ''};\n\treturn {\n\t\ttype: ACTIONS.setActiveElement,\n\t\tpayload: key,\n\t};\n};\n\nexport const getActiveElement = () => {\n\tconst key = getState().activeElement;\n\tif (!key) return null;\n\t/** @type {HTMLInputElement} */\n\tconst el = document.querySelector(`[data-prsKey=${key}]`);\n\treturn el;\n};\n","import {ACTIONS, setProviders, syncStart, syncEnd} from './actions';\nimport {ACTIONS as APP_ACTIONS} from '../app/app-action';\nimport {getState, dispatch, subscribeAfter} from '../store/store';\nimport {ACTIONS as PERSON, saveAll} from '../person/person-actions';\n\n/**\n * Default result of fetching a data provider.\n */\nconst defaultResult = {persons: {}, updated: 0};\n\n/**\n * Register data providers.\n * @param {DataProvider[]} providers\n */\nexport default (providers) => {\n\tsubscribeAfter(run);\n\tproviders.forEach(register);\n\tdispatch(setProviders(providers));\n};\n\n/**\n * Registers a single data provider.\n * @param {DataProvider} provider\n */\nconst register = (provider) => provider.init();\n\n/**\n * Merges results of data providers.\n * Merges only `persons` property. Property `updated` is\n * copied from the newest.\n * @param {{persons: Object, updated: number}} newer\n * @param {{persons: Object, updated: number}} older\n * @returns {{persons: Object, updated: number}}\n */\nconst merge = (newer, older) => {\n\tif (older.updated > newer.updated) {\n\t\tconst _newer = newer;\n\t\tnewer = older;\n\t\tolder = _newer;\n\t}\n\treturn {\n\t\tpersons: {...older.persons, ...newer.persons},\n\t\tupdated: newer.updated,\n\t};\n};\n\n/**\n * Returns enabled data providers.\n * @returns {DataProvider[]}\n */\nconst getProviders = () => {\n\tconst providers = getState().dataProviders || [];\n\treturn providers.filter(isEnabled);\n};\n\n/**\n * Return true if a user is logged in the provider.\n * @param {DataProvider} provider\n */\nconst isLogged = (provider) => provider.isLogged();\n\n/**\n * Return true if the provider is enabled.\n * @param {DataProvider} provider\n */\nconst isEnabled = (provider) => provider.isEnabled();\n\n/**\n * Adds default values to a result of data provider.\n * @param {{persons?: Object, updated?: number}} result\n */\nconst cleanResult = (result) => ({...defaultResult, ...result});\n\n/**\n * Loads data from all providers, merges them together (the newest wins)\n * and stores to local state and to all other providers.\n */\nconst sync = async () => {\n\tdispatch(syncStart());\n\tconst providers = getProviders().filter(isLogged);\n\tconst promisesGet = providers.map(get);\n\tconst resultsDirty = await Promise.all(promisesGet);\n\tconst results = resultsDirty.map(cleanResult);\n\tconst {persons, updated} = results.reduce(merge, defaultResult);\n\tdispatch(saveAll(persons)); // save to local state\n\n\tconst providersToSync = providers.filter((_, i) => results[i].updated !== updated);\n\tconst promisesSet = providersToSync.map(set({persons, updated}));\n\tawait Promise.all(promisesSet);\n\tdispatch(syncEnd());\n};\n\nconst localToRemote = async () => {\n\tdispatch(syncStart());\n\tconst setData = set({persons: getState().persons});\n\tconst providers = getProviders().filter(isLogged);\n\tconst promises = providers.map(setData);\n\tawait Promise\n\t\t.all(promises)\n\t\t.catch((err) => console.error('Error during saving', err));\n\tdispatch(syncEnd());\n};\n\nconst syncClick = async () => {\n\tconst promises = getProviders()\n\t\t.filter(p => !p.isLogged())\n\t\t.map(loginProvider);\n\tawait Promise\n\t\t.all(promises)\n\t\t.catch((err) => console.error('Error during logging in', err));\n\tsync();\n};\n\n/**\n * Login into the provider\n * @param {DataProvider} provider\n */\nconst loginProvider = (provider) => {\n\tif (!provider.isEnabled()) return Promise.resolve();\n\tif (!provider.login) return Promise.resolve();\n\treturn provider.login();\n};\n\n/**\n * Reads data from data provider.\n * @param {DataProvider} provider\n */\nconst get = (provider) => provider.get();\n\n/**\n * Stores data to the provider.\n * @param {Object} data\n */\nconst set = (data) => {\n\tconst updated = (new Date()).getTime();\n\tconst dataWithUpdated = {...data, updated: data.updated || updated};\n\treturn async (dataProvider) => {\n\t\tawait dataProvider.set(dataWithUpdated) || Promise.resolve();\n\t};\n};\n\n/**\n * Returns whether all data providers are functional.\n * @returns {boolean}\n */\nexport const isSyncOk = () => {\n\tconst providers = getState().dataProviders || [];\n\tconst allOk = providers.reduce((isOk, provider) => {\n\t\treturn isOk && provider.isEnabled() && provider.isLogged();\n\t}, true);\n\treturn allOk;\n};\n\n/**\n * Subscription function to state update.\n * @param {Action} action\n */\nconst run = (action) => {\n\tswitch (action.type) {\n\t\tcase APP_ACTIONS.init: {\n\t\t\tsync();\n\t\t\tbreak;\n\t\t}\n\t\tcase ACTIONS.SYNC_CLICK: {\n\t\t\tsyncClick();\n\t\t\tbreak;\n\t\t}\n\t\tcase PERSON.save:\n\t\tcase PERSON.REMOVE: {\n\t\t\tlocalToRemote();\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn;\n};\n","export const ROUTES = {\n\thome: '/',\n\tlogin: 'login',\n\tadd: 'add',\n\tedit: 'edit',\n};\n","import {ROUTES} from '../router/routes';\n\nexport const ACTIONS = {\n\thome: '',\n\tlogin: '/login',\n\tgo: 'router/go',\n};\n\nexport const goToAdd = () => ({type: ACTIONS.go, payload: ROUTES.add});\nexport const goToEdit = (id) => ({type: ACTIONS.go, payload: `${ROUTES.edit}/${id}`});\nexport const goToHome = () => ({type: ACTIONS.go, payload: ROUTES.home});\nexport const goToLogin = () => ({type: ACTIONS.go, payload: ROUTES.login});\n","/**\n * Parses `2001-12-31` to separate values\n * @param {string} isoDate\n * @returns {{day: string, month: string, year: string}} object with day, month, year\n */\nexport const parseDate = (isoDate) => {\n\tconst date = new Date(isoDate);\n\tconst day = date.getDate() + '';\n\tconst month = date.getMonth() + 1 + '';\n\tconst year = date.getFullYear() + '';\n\treturn {day, month, year};\n};\n\nexport const createDate = (day, month, year) => new Date(year, month - 1, day);\n\nexport const createIso = (day, month, year) => {\n\tconst d = day.padStart(2, '0');\n\tconst m = month.padStart(2, '0');\n\treturn `${year}-${m}-${d}`;\n};\n\nexport const formatDMY = (isoDate) => {\n\tconst {day, month, year} = parseDate(isoDate);\n\treturn `${day}. ${month}. ${year}`;\n};\n\nexport const getNow = () => {\n\tconst date = new Date();\n\treturn [date.getDate(), date.getMonth() + 1];\n};\n\n/**\n * Returns number of days before birthday\n * @param {Array<number>} fromDate [day, month]\n * @param {Array<number>} toDate [day, month]\n * @returns {number}\n */\nexport const diffDays = (fromDate, toDate) => {\n\tconst createDate = (year, day, month) => new Date([year, month, day].join('-'));\n\tif (!fromDate) return null;\n\tconst [fromDay, fromMonth] = fromDate;\n\tconst [toDay, toMonth] = toDate;\n\tconst isToAfter = fromMonth <= toMonth && fromDay <=toDay;\n\tconst fromYear = '2000'; // prestupny rok?\n\tconst toYear = isToAfter ? '2000' : '2001';\n\tconst from = createDate(fromYear, fromDay, fromMonth);\n\tconst to = createDate(toYear, toDay, toMonth);\n\tconst diff = to.getTime() - from.getTime();\n\treturn Math.ceil(diff / 1000 / 60 / 60 / 24);\n};\n","export const createId = (name) => {\n\treturn name\n\t\t.trim()\n\t\t.toLowerCase()\n\t\t.split(' ')\n\t\t.filter(Boolean)\n\t\t.join('-');\n};\n","import {dispatch, getState} from '../store/store';\nimport {parseDate, createIso, diffDays, getNow} from '../utils/date';\nimport {editPerson, ACTIONS as PERSON, toggleAdd, save as savePerson} from '../person/person-actions';\nimport {goToEdit, goToHome} from '../router/router-actions';\nimport { createId } from './person-util';\n\n\nexport const DEFAULTS = {\n\tname: '',\n\tday: '1',\n\tmonth: '1',\n\tyear: '1980',\n};\n\n/**\n * @returns {PersonModelProps}\n */\nexport const getProps = () => {\n\treturn {\n\t\tpersons: getPersons(),\n\t\tisAdd: getState().isAddingPerson,\n\t\tonSave: () => save(),\n\t\tonCancel: () => {\n\t\t\tdispatch(toggleAdd(false));\n\t\t\tdispatch(editPerson(null));\n\t\t},\n\t};\n};\n\n/**\n * @returns {Array<PersonProps>}\n */\nconst getPersons = () => {\n\tconst persons = Object.values(getState().persons)\n\t\t.map(person => {\n\t\t\tconst now = getNow();\n\t\t\tconst {day, month} = parseDate(person.birthday);\n\t\t\treturn {\n\t\t\t\t...person,\n\t\t\t\tage: getAge(person.birthday),\n\t\t\t\tdaysToBirthday: diffDays(now, [parseInt(day, 10), parseInt(month, 10)]),\n\t\t\t\tseenBefore: getSeenBefore(person.seen),\n\t\t\t\tonEditClick: id => {\n\t\t\t\t\t// TODO: Move to separate function\n\t\t\t\t\tconst person = getState().persons[id];\n\t\t\t\t\tif (!person) {\n\t\t\t\t\t\tconsole.error(`Person not found by id: '${id}'`);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst {day, month, year} = parseDate(person.birthday);\n\t\t\t\t\tdispatch(editPerson({...person, day, month, year}));\n\t\t\t\t\t// dispatch(goToEdit(id))\n\t\t\t\t},\n\t\t\t\tonRemoveClick: toggleRemoveOverlay,\n\t\t\t\tcancelRemove: toggleRemoveOverlay,\n\t\t\t\tremove: remove,\n\t\t\t\tsave: () => save(person.id),\n\t\t\t};\n\t\t})\n\t\t.sort(sortByBirthday);\n\treturn persons;\n};\n\n/**\n * @param {string=} id\n */\nconst save = (id) => {\n\tconst {personEdit} = getState();\n\tconst {day, month, year, ...personRest} = personEdit;\n\tif (!personRest.name.trim()) {\n\t\tconsole.error('Name cannot be empty');\n\t\treturn;\n\t}\n\tconst person = {\n\t\tid: id || createId(personRest.name),\n\t\t...personRest,\n\t\tbirthday: createIso(day, month, year),\n\t};\n\tdispatch(savePerson(person));\n\tdispatch(goToHome());\n\tdispatch(toggleAdd(false));\n\tdispatch(editPerson(null));\n};\n\nconst sortByBirthday = (personA, personB) => {\n\tif (!personA.birthday || !personB.birthday) return 0;\n\tconst now = getNow();\n\tconst getBirthday = (person) => {\n\t\tconst {day, month} = parseDate(person.birthday);\n\t\treturn [parseInt(day, 10), parseInt(month, 10)];\n\t};\n\treturn diffDays(now, getBirthday(personA)) - diffDays(now, getBirthday(personB));\n};\n\nconst getAge = (isoDay) => {\n\tif (!isoDay) return null;\n\tconst now = Date.now();\n\tconst date = new Date(isoDay).getTime();\n\tconst diff = new Date(now - date);\n\tconst age = Math.abs(diff.getUTCFullYear() - 1970);\n\treturn age;\n};\n\nconst getSeenBefore = (isoDay) => {\n\tif (!isoDay) return null;\n\tconst now = Date.now();\n\tconst date = new Date(isoDay).getTime();\n\tconst days = Math.round((now - date) / 1000 / 60 / 60/ 24);\n\treturn days;\n};\n\nconst getValidationError = (name, birthday) => {\n\tif (!name) {\n\t\treturn 'Empty name';\n\t}\n\tif (!birthday.match(/^\\d{4}-\\d{2}-\\d{2}$/)) {\n\t\treturn 'Wrong birthday format. Use YYYY-MM-DD.';\n\t}\n\treturn null;\n};\n\n// const resetSeen = (id) => {\n// \tconst persons = getState().persons.map((person) => {\n// \t\tif (id !== person.id) return person\n// \t\tconst now = new Date()\n// \t\tconst year = now.getUTCFullYear()\n// \t\tconst month = (now.getMonth() + 1 + '').padStart(2, '0')\n// \t\tconst day = (now.getDate() + '').padStart(2, '0')\n// \t\treturn {\n// \t\t\t...person,\n// \t\t\tseen: `${year}-${month}-${day}`,\n// \t\t}\n// \t})\n// \tdispatch({type: PERSON.SYNC})\n// }\n\n/**\n * Shows or hide remove overlay.\n * @param {string} id\n */\nconst toggleRemoveOverlay = id => {\n\tdispatch({type: PERSON.TOGGLE_DELETE_OVERLAY, payload: id});\n};\n\n/**\n * Removes a person.\n * @param {string} id\n */\nconst remove = id => {\n\tdispatch({type: PERSON.REMOVE, payload: id});\n};\n","/**\n *\n * @param {HTMLElement} element\n * @param {string} value\n */\nexport const addTestAttribute = (element, value) => {\n\t// @ts-ignore\n\tif (window && !window.Cypress) return;\n\telement.setAttribute('data-cy', value);\n};\n\n/**\n * Creates a DOM structure of elements.\n *\n * @param {string} tag Type of tag (div, img)\n * @param {Object?} attrs\n * @param {string|Array<HTMLElement|string|Text>?} children\n */\nexport const createDom = (tag, attrs = {}, children = []) => {\n\tconst element = document.createElement(tag);\n\tconst attachAttributeToEl = attachAttribute(element);\n\tObject.keys(attrs).map(key => attachAttributeToEl(key, attrs[key]));\n\tif (!Array.isArray(children)) children = [children];\n\tchildren.filter(Boolean).forEach(child => {\n\t\tif (typeof child === 'string') {\n\t\t\tif (child.trim()[0] === '<') {\n\t\t\t\telement.innerHTML = child; // Inject HTML into the element. Not ideal.\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tchild = document.createTextNode(child);\n\t\t}\n\t\telement.appendChild(child);\n\t});\n\treturn element;\n};\n\nconst attachAttribute = (element) => (key, value) => {\n\tswitch (key) {\n\t\tcase 'onClick': {\n\t\t\telement.addEventListener('click', value);\n\t\t\tbreak;\n\t\t}\n\t\tcase 'className': {\n\t\t\tif (!Array.isArray(value)) value = [value];\n\t\t\tvalue.forEach(className => element.classList.add(className));\n\t\t\tbreak;\n\t\t}\n\t\tcase 'testId': {\n\t\t\taddTestAttribute(element, value);\n\t\t\tbreak;\n\t\t}\n\t\tdefault: {\n\t\t\telement.setAttribute(key, value);\n\t\t}\n\t}\n};\n\nexport const div = (...theArgs) => createDom('div', ...theArgs);\n","export default {\n\tedit: `\n\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n\t\t\t<path d=\"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41\n\t\t\t\t0l-1.83 1.83 3.75 3.75 1.83-1.83z\"/>\n\t\t\t<path d=\"M0 0h24v24H0z\" fill=\"none\"/>\n\t\t</svg>\n\t`,\n\tremove: `\n\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n\t\t\t<path d=\"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z\"/>\n\t\t\t<path d=\"M0 0h24v24H0z\" fill=\"none\"/>\n\t\t</svg>\n\t`,\n\tadd: `\n\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n\t\t\t<path d=\"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z\"/><path d=\"M0 0h24v24H0z\" fill=\"none\"/>\n\t\t</svg>\n\t`,\n\tsync: `\n\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n\t\t\t<path d=\"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0\n\t\t\t14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z\"/><path d=\"M0 0h24v24H0z\" fill=\"none\"/>\n\t\t</svg>\n\t`,\n\twarn: `\n\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path d=\"M0 0h24v24H0z\" fill=\"none\"/>\n\t\t\t<path d=\"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z\"/>\n\t\t</svg>\n\t`,\n};\n","import {dispatch, getState} from '../store/store';\nimport {goToAdd} from '../router/router-actions';\nimport {DEFAULTS as DEFAULT_PERSON} from '../person/person-model';\nimport {editPerson, toggleAdd} from '../person/person-actions';\nimport {ACTIONS as DATA_PROVIDER} from '../data-provider/actions';\nimport {isSyncOk} from '../data-provider/data-provider';\nimport {addTestAttribute, div} from '../utils/dom';\nimport ICONS from '../components/icons';\nimport './header.css';\n\nexport default function render () {\n\tconst el = document.createElement('div');\n\tconst spaceEl = document.createElement('div');\n\tspaceEl.classList.add('spaceEl');\n\tel.classList.add('app-header');\n\taddTestAttribute(el, 'header');\n\tconst content = [\n\t\trenderTitle(),\n\t\tspaceEl,\n\t\trenderSync(),\n\t\trenderAdd(),\n\t];\n\tcontent.map((c) => el.appendChild(c));\n\treturn el;\n}\n\nconst renderTitle = () => {\n\tconst el = document.createElement('h1');\n\tel.classList.add('header__title');\n\tel.innerHTML = 'Persons';\n\treturn el;\n};\n\nconst renderSync = () => {\n\tconst classNames = ['header-button--sync'];\n\tlet warn = null;\n\tif (!isSyncOk()) {\n\t\tclassNames.push('header__sync-error');\n\t\twarn = div({className: 'header-button--warn', testId: `header-button--warn`}, ICONS.warn);\n\t}\n\tif (getState().isSyncing) {\n\t\tclassNames.push('header__sync-inProgress');\n\t}\n\tconst onClick = () => dispatch({type: DATA_PROVIDER.SYNC_CLICK});\n\treturn (\n\t\tdiv({className: 'header__syncWrap'}, [\n\t\t\tdiv({className: classNames, testId: `header-button--sync`, onClick}, ICONS.sync),\n\t\t\twarn,\n\t\t])\n\t);\n};\n\nconst renderAdd = () => {\n\tconst el = document.createElement('div');\n\tel.classList.add('header-button--add');\n\tel.setAttribute('data-cy', 'header-button--add');\n\tel.addEventListener('click', () => {\n\t\tdispatch(editPerson(DEFAULT_PERSON));\n\t\tdispatch(toggleAdd(true));\n\t});\n\tel.innerHTML = ICONS.add;\n\treturn el;\n};\n","export const birthdayPicker = ({day, month, year}, onChange) => {\n\tconst createOptions = (start, end, selected) => {\n\t\tconst options = Array.from({length: end + 1 - start}, (v, k) => start + k);\n\t\treturn options.map(i => {\n\t\t\tconst option = document.createElement('option');\n\t\t\tconst value = i + '';\n\t\t\toption.innerText = value;\n\t\t\toption.value = value;\n\t\t\tif (selected && value === selected) option.selected = true;\n\t\t\treturn option;\n\t\t});\n\t};\n\n\tconst dayEl = document.createElement('select');\n\tconst monthEl = document.createElement('select');\n\tconst yearEl = document.createElement('select');\n\tcreateOptions(1, 31, day).forEach(option => dayEl.appendChild(option));\n\tcreateOptions(1, 12, month).forEach(option => monthEl.appendChild(option));\n\tcreateOptions(1900, 2019, year).forEach(option => yearEl.appendChild(option));\n\n\t/**\n\t * @param {string} type\n\t * @returns {(HTMLInputElement) => void} type\n\t */\n\tconst onChangeCb = (type) => (ev) => onChange(type, (ev.target).value);\n\n\tdayEl.addEventListener('change', onChangeCb('day'));\n\tmonthEl.addEventListener('change', onChangeCb('month'));\n\tyearEl.addEventListener('change', onChangeCb('year'));\n\n\treturn [dayEl, monthEl, yearEl];\n};\n","import {dispatch, getState} from '../store/store';\nimport {birthdayPicker} from '../components/birthday-picker';\nimport {editField, remove} from './person-actions';\nimport {storeActiveElement} from '../app/app-action';\nimport {addTestAttribute, div, createDom} from '../utils/dom';\n\n/**\n * @param {{onSave: Function, onCancel: Function, onRemove: Function}} props\n */\nexport default function render (props) {\n\tconst el = document.createElement('div');\n\tel.classList.add('person');\n\tconst {personEdit} = getState();\n\tif (!personEdit) throw new Error('Empty `personEdit');\n\tconst content = [\n\t\tdiv({className: ['person__column', 'person__column-grow']}, [\n\t\t\trenderName(personEdit.name),\n\t\t\trenderPicker(personEdit.day, personEdit.month, personEdit.year),\n\t\t]),\n\t\tdiv({className: 'spaceEl'}, ''),\n\t\tdiv({className: 'person__column'}, [\n\t\t\trenderSaveButton(personEdit, props.onSave),\n\t\t\tdiv({className: 'person__secondaryButtons'}, [\n\t\t\t\trenderRemoveButton(props.onRemove),\n\t\t\t\trenderCancelButton(props.onCancel),\n\t\t\t]),\n\t\t]),\n\t];\n\tcontent.map((c) => el.appendChild(c));\n\treturn el;\n}\n\nconst renderName = (name) => {\n\tconst el = document.createElement('input');\n\tel.placeholder = 'Name';\n\tel.classList.add('person__input');\n\taddTestAttribute(el, 'add-input--name');\n\tel.setAttribute('data-prsKey', 'add-input--name');\n\tel.value = name;\n\tel.addEventListener('input', e => {\n\t\tdispatch(storeActiveElement());\n\t\tdispatch(editField('name', el.value));\n\t});\n\t// TODO: storeActiveElement na unfocus\n\treturn el;\n};\n\nconst renderPicker = (day, month, year) => {\n\tconst el = document.createElement('div');\n\tel.setAttribute('data-cy', 'add-input--birthday');\n\tel.classList.add('person__datepicker');\n\tconst [dayEl, monthEl, yearEl] = birthdayPicker({day, month, year}, (field, value) => {\n\t\tdispatch(editField(field, value));\n\t});\n\tel.appendChild(dayEl);\n\tel.appendChild(monthEl);\n\tel.appendChild(yearEl);\n\treturn el;\n};\n\nconst renderSaveButton = (personEdit, onSave) => {\n\treturn createDom('button', {\n\t\tclassName: ['person__button', 'person__button--primary'],\n\t\tonClick: onSave,\n\t\ttestId: 'add-button--save',\n\t}, 'OK');\n};\n\nconst renderCancelButton = (onCancel) => {\n\treturn createDom('button', {\n\t\tclassName: ['button', 'person__button--secondary'],\n\t\tonClick: onCancel,\n\t\ttestId: 'add-button--cancel',\n\t}, 'Cancel');\n};\n\nconst renderRemoveButton = (onRemove) => {\n\treturn createDom('button', {\n\t\tclassName: ['button', 'person__button--secondary', 'warning'],\n\t\tonClick: onRemove,\n\t}, 'Remove');\n};\n","import ICONS from '../components/icons';\nimport {formatDMY} from '../utils/date';\nimport {addTestAttribute, div, createDom} from '../utils/dom';\nimport { getState } from \"../store/store\";\nimport renderAddEdit from './person-add-edit-view';\nimport './person.css';\n\n/**\n * Render\n * @param {PersonModelProps} props Properties\n */\nexport default function render (props) {\n\tclearPersons(); // TODO: clean when necessary\n\tconst el = document.createElement('div');\n\tel.classList.add('persons');\n\taddTestAttribute(el, 'persons');\n\tif (props.isAdd) {\n\t\tel.appendChild(renderAddEdit({onSave: props.onSave, onCancel: props.onCancel}));\n\t} else if (props.persons.length === 0) {\n\t\tel.classList.add('empty');\n\t\tel.appendChild(renderEmpty());\n\t}\n\tprops.persons\n\t\t.map(renderPerson(props.onCancel))\n\t\t.forEach(person => el.appendChild(person));\n\treturn el;\n}\n\n/**\n * Renders element with person.\n * @param {Function} onCancel\n * @returns {(PersonProps) => HTMLElement}\n */\nconst renderPerson = onCancel => person => {\n\tconst {deleteOverlayId, personEdit} = getState();\n\tif (deleteOverlayId === person.id) return renderRemoveOverlay(person);\n\tif (personEdit && personEdit.id === person.id) return renderEditOverlay(person, onCancel);\n\n\tconst onEditClick = person.onEditClick.bind(null, person.id);\n\treturn (\n\t\tdiv({className: 'person', testId: `person-${person.id}`}, [\n\t\t\tdiv({className: ['person__column', 'person__column-grow']}, [\n\t\t\t\trenderTitle(person.name),\n\t\t\t\trenderBirthday(person),\n\t\t\t\trenderSeen(person.seenBefore),\n\t\t\t\t...renderCustomTexts(person.customTexts),\n\t\t\t]),\n\t\t\tdiv({className: 'person__column'}, [\n\t\t\t\tdiv({className: ['icon-edit', 'icon'], testId: 'edit', onClick: onEditClick}, ICONS.edit),\n\t\t\t]),\n\t\t])\n\t);\n};\n\nconst renderEmpty = () => {\n\treturn div({className: 'personsEmpty', testId: 'personsEmpty'}, ['No persons created yet.']);\n};\n\nconst renderRemoveOverlay = person => {\n\tconst onConfirmClick = ev => person.remove(person.id);\n\tconst onCancelClick = person.cancelRemove.bind(null, null);\n\treturn (\n\t\tdiv({className: ['person', 'person__remove'], testId: `person-${person.id}`}, [\n\t\t\tdiv({className: 'person__removeWrap', testId: 'remove-overlay'}, [\n\t\t\t\tcreateDom('button', {\n\t\t\t\t\tclassName: ['person__button--grow', 'person__button--warning'],\n\t\t\t\t\tonClick: onConfirmClick,\n\t\t\t\t}, 'Remove'),\n\t\t\t\tcreateDom('button', {\n\t\t\t\t\tclassName: ['person__button--grow', 'person__button--secondary'],\n\t\t\t\t\tonClick: onCancelClick,\n\t\t\t\t}, 'Cancel'),\n\t\t\t]),\n\t\t])\n\t);\n};\n\nconst renderEditOverlay = (person, onCancel) => {\n\tconst onRemove = person.onRemoveClick.bind(null, person.id);\n\treturn renderAddEdit({onSave: person.save, onCancel, onRemove});\n};\n\nconst createPersonEl = person => {\n\treturn div({className: 'person', testId: `person-${person.id}`});\n};\n\nconst renderTitle = (value) => {\n\tconst el = renderText(value);\n\tel.classList.add('person-title');\n\taddTestAttribute(el, 'title');\n\treturn el;\n};\n\nconst renderText = (value) => {\n\tconst el = document.createElement('div');\n\tel.innerHTML = value;\n\treturn el;\n};\n\nconst renderBirthday = ({birthday, age, daysToBirthday}) => {\n\tif (!birthday) return null;\n\tconst el = document.createElement('div');\n\taddTestAttribute(el, 'birthday');\n\tconst birthdayDMY = formatDMY(birthday);\n\tlet text = `Age: ${age}<br />Birthday in ${daysToBirthday} days (${birthdayDMY})`;\n\tif (daysToBirthday === 1) {\n\t\ttext = `Tomorrow is the ${age + 1}'s birthday`;\n\t}\n\tif (daysToBirthday === 0) {\n\t\ttext = `🎉 Today is celebrating ${age} years 🎊`;\n\t}\n\tel.innerHTML = text;\n\treturn el;\n};\n\nconst renderSeen = (days) => {\n\tif (!days && days !== 0) return null;\n\tconst el = document.createElement('div');\n\tconst button = document.createElement('button');\n\tel.innerHTML = `Seen before ${days} days`;\n\treturn el;\n};\n\nconst renderCustomTexts = (values) => {\n\tif (!values) return [];\n\treturn values.map(renderText);\n};\n\nconst clearPersons = () => {\n\tconst el = document.querySelector('.persons');\n\tif (!el) return;\n\tel.innerHTML = '';\n};\n","import {subscribe, dispatch} from '../store/store';\nimport Header from '../header/header';\nimport Persons from '../person/person-view';\nimport {ACTIONS} from '../router/router-actions';\nimport * as personModel from '../person/person-model';\nimport {getActiveElement} from '../app/app-action';\n\nconst getRoute = () => {\n\treturn window.location.pathname.substring(1).split('/')[0];\n};\n\nconst go = path => {\n\tif (path === getRoute()) return;\n\thistory.pushState({}, '', path);\n};\n\nconst route = action => {\n\tif (action.type === ACTIONS.go) {\n\t\tgo(action.payload);\n\t}\n\tconst route = getRoute();\n\tlet body = [];\n\tswitch (route) {\n\t\tdefault: {\n\t\t\tbody = [\n\t\t\t\tHeader(),\n\t\t\t\tPersons(personModel.getProps()),\n\t\t\t];\n\t\t}\n\t}\n\tconst app = document.getElementById('app');\n\tapp.innerHTML = '';\n\tbody.map((el) => app.appendChild(el));\n\tconst activeElement = getActiveElement();\n\tif (activeElement) {\n\t\tactiveElement.focus();\n\t}\n};\n\nexport const setup = () => {\n\twindow.onpopstate = route;\n\tsubscribe(route);\n};\n","const storage = window.localStorage;\n\n/**\n * Saves state to local storage.\n * @param {Object} persons\n */\nconst set = (persons) => {\n\tconsole.log('🔊', 'storing to localStorage');\n\tconst json = JSON.stringify(persons);\n\tstorage.setItem('persons', json);\n};\n\n/**\n * Get persons from local storage.\n */\nconst get = () => {\n\tconst persons = JSON.parse(storage.getItem('persons'));\n\treturn persons || {};\n};\n\nconst isEnabled = () => true;\nconst isLogged = () => true;\n\n/**\n * Initialization\n */\nconst init = () => {};\n\nexport default {\n\tinit,\n\tget,\n\tset,\n\tisLogged,\n\tisEnabled,\n};\n","const APP_FOLDER = 'App-Personas';\nconst FILE_NAME = 'persons.json';\nlet onSignInChangeHandler = Function;\nlet fileId = '';\nlet folderId = '';\nlet defaultContent = null;\n\nconst init = async (options = {}) => {\n\tsetupOptions(options);\n\treturn new Promise ((resolve, reject) => {\n\t\tgapi.load('client:auth2', () => {\n\t\t\tinitClient().then(resolve).catch(reject);\n\t\t});\n\t});\n};\n\nconst setupOptions = ({defaultContentOption = null, onSignInChange = null}) => {\n\tif (onSignInChange) onSignInChangeHandler = onSignInChange;\n\tif (defaultContentOption) defaultContent = defaultContentOption;\n};\n\nconst initClient = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tgapi.client.init({\n\t\t\t'apiKey': 'AIzaSyBYItpNT8k2Y2AEHz2E2kI2EqMULh5C4m0',\n\t\t\t'discoveryDocs': ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],\n\t\t\t'clientId': '614338309616-st9nui22tf3sa1cm9m1l3nd439n50frg.apps.googleusercontent.com',\n\t\t\t'scope': 'https://www.googleapis.com/auth/drive.file',\n\t\t})\n\t\t.then(() => {\n\t\t\tgapi.auth2.getAuthInstance().isSignedIn.listen(updateSignInStatus);\n\t\t\tupdateSignInStatus(gapi.auth2.getAuthInstance().isSignedIn.get());\n\t\t\tresolve({isInitiated: true});\n\t\t})\n\t\t.catch(reject);\n\t});\n};\n\nconst updateSignInStatus = (isLogged) => {\n\t// TODO: Pass logged user instead of `isLogged`\n\tonSignInChangeHandler(isLogged);\n};\n\nconst isLogged = () => {\n\treturn gapi.auth2.getAuthInstance().isSignedIn.get();\n};\n\nconst login = async () => {\n\tconst {signIn, isSignedIn} = gapi.auth2.getAuthInstance();\n\tif (isSignedIn.get()) {\n\t\treturn Promise.resolve(true);\n\t}\n\treturn await signIn();\n};\n\nconst fetchData = () => {\n\tconsole.log('🔊', 'fetchingData from API');\n\treturn getFolder()\n\t.then(getFile)\n\t.then(getFileContent);\n};\n\nconst getFolder = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst request = gapi.client.drive.files.list({\n\t\t\tq: `name='${APP_FOLDER}' and trashed=false`,\n\t\t});\n\n\t\trequest.execute((response) => {\n\t\t\tif (typeof response !== 'object' || !response.files) return;\n\t\t\tif (response.files.length === 0) {\n\t\t\t\tcreateFolder().then(resolve);\n\t\t\t} else {\n\t\t\t\tfolderId = response.files[0].id;\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t});\n};\n\nconst createFolder = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst metadata = {\n\t\t\tname: APP_FOLDER,\n\t\t\tmimeType: 'application/vnd.google-apps.folder',\n\t\t};\n\t\tconst request = gapi.client.drive.files.create({resource: metadata});\n\t\trequest.execute((response) => {\n\t\t\tfolderId = response.id;\n\t\t\tresolve();\n\t\t});\n\t});\n};\n\nconst getFile = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst request = gapi.client.drive.files.list({\n\t\t\tq: `name=\"${FILE_NAME}\" and '${folderId}' in parents and trashed=false`,\n\t\t});\n\t\trequest.execute((response) => {\n\t\t\tconsole.log('🔊', 'response', response);\n\t\t\tif (response.files.length === 0) {\n\t\t\t\tcreateFile().then(resolve);\n\t\t\t} else {\n\t\t\t\tfileId = response.files[0].id;\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t});\n};\nconst createFile = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst boundary = '-------314159265358979323846';\n\t\tconst delimiter = \"\\r\\n--\" + boundary + \"\\r\\n\";\n\t\tconst closeDelim = \"\\r\\n--\" + boundary + \"--\";\n\n\t\tconst contentType = 'application/json';\n\n\t\tconst metadata = {\n\t\t\tname: FILE_NAME,\n\t\t\tmimeType: contentType,\n\t\t\tparents: [folderId],\n\t\t};\n\n\t\tconst multipartRequestBody =\n\t\t\tdelimiter +\n\t\t\t'Content-Type: application/json\\r\\n\\r\\n' +\n\t\t\tJSON.stringify(metadata) +\n\t\t\tdelimiter +\n\t\t\t'Content-Type: ' + contentType + '\\r\\n\\r\\n' +\n\t\t\t(defaultContent ? JSON.stringify(defaultContent) : '') +\n\t\t\tcloseDelim;\n\n\t\tconst request = gapi.client.request({\n\t\t\t'path': '/upload/drive/v3/files',\n\t\t\t'method': 'POST',\n\t\t\t'params': {'uploadType': 'multipart'},\n\t\t\t'headers': {\n\t\t\t  'Content-Type': 'multipart/related; boundary=\"' + boundary + '\"',\n\t\t\t},\n\t\t\t'body': multipartRequestBody,\n\t\t});\n\n\t\trequest.execute((response) => {\n\t\t\tfileId = response.id;\n\t\t\tresolve();\n\t\t});\n\t});\n};\n\nconst getFileContent = () => {\n\tconsole.log('🔊', 'getFileContent');\n\treturn new Promise ((resolve, reject) => {\n\t\tconsole.log('🔊', 'fileId', fileId);\n\t\tconst request = gapi.client.drive.files.get({\n\t\t\tfileId: fileId,\n\t\t\talt: 'media',\n\t\t});\n\t\trequest.execute((response) => {\n\t\t\tif (response.error) {\n\t\t\t\treject(`Error during file download: ${response.error.message}`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconsole.log('response.result', response.result);\n\t\t\tresolve(response.result);\n\t\t});\n\t});\n};\n\nconst save = (content) => {\n\tconsole.info('👉', 'API save');\n\treturn new Promise ((resolve, reject) => {\n\t\tconst request = gapi.client.request({\n\t\t\tpath: '/upload/drive/v2/files/' + fileId,\n\t\t\tmethod: 'PUT',\n\t\t\talt: 'media',\n\t\t\tbody: content,\n\t\t});\n\t\trequest.execute((response) => {\n\t\t\tif (response.error) {\n\t\t\t\treject(`Error during sync: ${response.error.message}`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tgetFileContent().then((fileContent) => {\n\t\t\t\tresolve(fileContent);\n\t\t\t});\n\t\t});\n\t});\n};\n\nexport {\n\tlogin,\n\tfetchData,\n\tinit,\n\tsave,\n\tisLogged,\n};\n","import {\n\tlogin,\n\tfetchData,\n\tinit as initApi,\n\tsave as set,\n\tisLogged,\n} from '../../data-provider/google-drive/google-drive-api';\n\nlet _isEnabled = false;\n\nconst onLibLoaded = async (options) => {\n\tconst defaultOptions = {\n\t\tonSignInChange: () => {},\n\t\tonError: onError,\n\t\tdefaultContent: [],\n\t\t// TODO: apiKey, etc\n\t};\n\tawait initApi({...defaultOptions, ...options}).catch(console.error);\n};\n\nconst onError = (error) => {\n\talert(error);\n};\n\n// * @returns {{persons?: Object, updated?: number}}\n/**\n * Get persons from local storage.\n */\nconst get = async () => {\n\tconsole.log('🔊', 'getting from grive');\n\tconst response = await fetchData();\n\tif (typeof response !== 'object') {\n\t\tonError('Unknown reposonse from server');\n\t\treturn null;\n\t}\n\tlet persons = {};\n\tif (Array.isArray(response)) {\n\t\t// temporal\n\t\tresponse.forEach(person => {\n\t\t\tpersons[person.id] = person;\n\t\t});\n\t} else {\n\t\tpersons = response.persons;\n\t}\n\tconst result = Object.keys(persons).reduce((all, id) => {\n\t\tall[id] = {\n\t\t\t...persons[id],\n\t\t\tname: unescape(persons[id].name),\n\t\t};\n\t\treturn all;\n\t}, {});\n\treturn {persons: result, updated: response.updated || 0};\n};\n\nconst init = async () => {\n\t// const response = await fetch('https://apis.google.com/js/api.js');\n\t// eval(await response.text());\n\tawait onLibLoaded();\n\t_isEnabled = true;\n};\n\nconst isEnabled = () => _isEnabled;\n\nexport default {\n\tinit,\n\tget,\n\tset,\n\tlogin,\n\tisLogged,\n\tisEnabled,\n};\n","import useDataProviders from './data-provider/data-provider';\nimport * as store from './store/store';\nimport {setup} from './router/router';\nimport localStorage from './app/use-local-storage';\nimport googleDrive from './data-provider/google-drive/google-drive-model';\nimport {ACTIONS} from './app/app-action';\nimport './app/app.css';\n\n// import {createId} from './person/person-util'\n// const names = [\n// \t'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k',\n// ].forEach(name => {\n// \tstore.dispatch({type: 'person/save', payload: {\n// \t\tid: createId(name),\n// \t\tname: name,\n// \t\tbirthday: '2000-01-01',\n// \t}})\n// })\n\nwindow.store = store; // TODO: for debug only\nif (window.Cypress) {\n\t// For Cypress testing library\n\twindow.store = store;\n}\n\n// useDataProviders([localStorage]);\nuseDataProviders([localStorage, googleDrive]);\n\nsetup();\nstore.dispatch({type: ACTIONS.init});\n\nif ('serviceWorker' in navigator) {\n\tnavigator.serviceWorker.register('sw.js');\n}\n"]}