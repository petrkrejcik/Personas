parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r},p.cache={};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({"QH5V":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.updateContent=exports.init=exports.fetchData=exports.connect=void 0;const e="App-Personas",t="persons.json";let n=Function,i=Function,s=Function,o=Object,r=Object,a=null;const p=(e={})=>(l(e),new Promise((e,t)=>{gapi.load("client:auth2",()=>{c().then(e)})}));exports.init=p;const l=({defaultContent:e,onError:t,onSignInChange:o,onUpdate:r})=>{o&&(n=o),r&&(i=r),t&&(s=t),e&&(a=e)},c=()=>new Promise((e,t)=>{gapi.client.init({apiKey:"AIzaSyBYItpNT8k2Y2AEHz2E2kI2EqMULh5C4m0",discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],clientId:"614338309616-st9nui22tf3sa1cm9m1l3nd439n50frg.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/drive.file"}).then(()=>{gapi.auth2.getAuthInstance().isSignedIn.listen(d),d(gapi.auth2.getAuthInstance().isSignedIn.get()),e({isInitiated:!0})})}),d=e=>{n(e)},g=()=>{gapi.auth2.getAuthInstance().isSignedIn.get()?u():gapi.auth2.getAuthInstance().signIn()};exports.connect=g;const u=()=>h().then(f).then(y);exports.fetchData=u;const h=()=>new Promise((e,t)=>{gapi.client.drive.files.list({q:"name='App-Personas' and trashed=false"}).execute(t=>{0===t.files.length?m().then(e):(r=t.files[0].id,e())})}),m=()=>new Promise((t,n)=>{const i={name:e,mimeType:"application/vnd.google-apps.folder"};gapi.client.drive.files.create({resource:i}).execute(e=>{r=e.id,t()})}),f=()=>new Promise((e,t)=>{gapi.client.drive.files.list({q:`name="persons.json" and '${r}' in parents and trashed=false`}).execute(t=>{0===t.files.length?v().then(e):(o=t.files[0].id,e())})}),v=()=>new Promise((e,n)=>{const i="-------314159265358979323846",s="\r\n--"+i+"\r\n",p={name:t,mimeType:"application/json",parents:[r]},l=s+"Content-Type: application/json\r\n\r\n"+JSON.stringify(p)+s+"Content-Type: application/json\r\n\r\n"+(a?JSON.stringify(a):"")+"\r\n---------314159265358979323846--";gapi.client.request({path:"/upload/drive/v3/files",method:"POST",params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/related; boundary="'+i+'"'},body:l}).execute(t=>{o=t.id,e()})}),y=()=>new Promise((e,t)=>{gapi.client.drive.files.get({fileId:o,alt:"media"}).execute(t=>{t.error?s(`Error during file download: ${t.error.message}`):e(t.result)})}),w=e=>new Promise((t,n)=>{gapi.client.request({path:"/upload/drive/v2/files/"+o,method:"PUT",alt:"media",body:e}).execute(e=>{e.error?s(`Error during sync: ${e.error.message}`):y().then(e=>{i(e),t(e)})})});exports.updateContent=w;
},{}],"Iw//":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.setState=exports.dispatchUpdate=exports.getState=exports.addListener=void 0;const e=[];let t={googleSyncEnabled:!1,isSignedIn:!1,persons:[],isLoading:!0,view:"loading",editingPerson:null};const s=()=>t;exports.getState=s;const o=e=>{t={...t,...e},n()};exports.setState=o;const n=()=>{e.forEach(e=>{e(s())})};exports.dispatchUpdate=n;const r=t=>{e.push(t)};exports.addListener=r;
},{}],"thyU":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.setup=exports.libLoaded=void 0;var e=require("./google-drive-api.js"),t=require("./state.js");const n=()=>{(0,t.addListener)(r),g().addEventListener("click",e.connect),window.getState=t.getState};exports.setup=n;const o=()=>{const n={onSignInChange:a,onUpdate:s,onError:i,defaultContent:[]};(0,e.init)(n).then(e=>{const{isInitiated:n}=e;(0,t.setState)({googleSyncEnabled:n})})};exports.libLoaded=o;const r=e=>{d(e.googleSyncEnabled)},s=e=>{Array.isArray(e)||i("Unknown reposonse from server"),e=e.map(e=>({...e,name:unescape(e.name),id:Math.random().toString(36).substring(10)})),(0,t.setState)({persons:e,view:"persons"})},a=n=>{n?((0,t.setState)({isSignedIn:n,view:"loading"}),(0,e.fetchData)().then(s)):(0,t.setState)({isSignedIn:n,view:"signIn"})},i=e=>{(0,t.setState)({view:"error"}),alert(e)},d=e=>{e&&g().removeAttribute("disabled")},g=()=>document.querySelector('button[data-prs="googleDriveButton"]');
},{"./google-drive-api.js":"QH5V","./state.js":"Iw//"}],"xLSG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.renderPersons=exports.clearPersons=void 0;const e=(e,t)=>{const r=document.querySelector(".persons");e.map(n).forEach(e=>r.appendChild(e)),r.appendChild(l(t))};exports.renderPersons=e;const n=e=>{const n=document.createElement("div");n.classList.add("person"),[t(e.name),d(e.birthday,e.age,e.daysToBirthday),o(e.seenBefore),...c(e.customTexts)].filter(Boolean).forEach(e=>n.appendChild(e));const r=document.createElement("div"),a=document.createElement("button"),l=document.createElement("button");return a.innerText="Edit",l.innerText="Remove",a.addEventListener("click",e.handleEdit.bind(null,e.id)),l.addEventListener("click",e.handleRemove.bind(null,e.id)),r.appendChild(a),r.appendChild(l),n.appendChild(r),n},t=e=>{const n=r(e);return n.classList.add("person-title"),n},r=e=>{const n=document.createElement("div");return n.innerHTML=e,n},d=(e,n,t)=>{if(!e)return null;const r=document.createElement("div");return r.innerHTML=`Age: ${n}<br />Birthday in ${t} days (${e})`,r},o=e=>{if(!e&&0!==e)return null;const n=document.createElement("div");document.createElement("button");return n.innerHTML=`Seen before ${e} days`,n},c=e=>e?e.map(r):[],a=()=>{document.querySelector(".persons").innerHTML=""};exports.clearPersons=a;const l=e=>{const n=document.createElement("div"),t=document.createElement("input"),r=document.createElement("input"),d=document.createElement("button");return t.placeholder="Name",r.placeholder="Birthday (YYYY-MM-DD)",d.innerText="Save",d.addEventListener("click",()=>{e(t.value,r.value)}),n.appendChild(t),n.appendChild(r),n.appendChild(d),n};
},{}],"pIMj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.setup=exports.resetSeen=exports.editPerson=void 0;var e=require("./state.js"),t=require("./google-drive-api.js"),r=n(require("./persons-view.js"));function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}const a=()=>{(0,e.addListener)(o)};exports.setup=a;const o=()=>{s()},s=()=>{r.clearPersons(),i((0,e.getState)().persons)},i=e=>{const t=e.map(e=>({...e,age:l(e.birthday),daysToBirthday:u(e.birthday),seenBefore:p(e.seen),handleEdit:y,handleRemove:D})).sort(d);r.renderPersons(t,c)},d=(e,t)=>e.birthday&&t.birthday?u(e.birthday)-u(t.birthday):0,l=e=>{if(!e)return null;const t=Date.now(),r=new Date(e).getTime(),n=new Date(t-r);return Math.abs(n.getUTCFullYear()-1970)},p=e=>{if(!e)return null;const t=Date.now(),r=new Date(e).getTime();return Math.round((t-r)/1e3/60/60/24)},u=e=>{if(!e)return null;const t=new Date(e),r=(new Date).getUTCFullYear(),n=Date.now()-new Date(`${r}-${t.getMonth()+1}-${t.getDate()}`).getTime();let a;if(n<0)a=Math.abs(Math.ceil(n/1e3/60/60/24));else{const e=Date.now()-new Date(`${r+1}-${t.getMonth()+1}-${t.getDate()}`).getTime();a=Math.abs(Math.ceil(e/1e3/60/60/24))}return a},c=(r,n)=>{const a=h(r,n);a?alert(a):((0,e.setState)({view:"loading"}),(0,t.updateContent)((0,e.getState)().persons.concat({name:r,birthday:n})))},g=(r,n,a)=>{const o=h(n,a);if(o)return void alert(o);const s=(0,e.getState)().persons.map(e=>e.id!==r?e:{...e,name:n,birthday:a});(0,e.setState)({view:"loading"}),(0,t.updateContent)(s)};exports.editPerson=g;const h=(e,t)=>e?t.match(/^\d{4}-\d{2}-\d{2}$/)?null:"Wrong birthday format. Use YYYY-MM-DD.":"Empty name",w=r=>{const n=(0,e.getState)().persons.map(e=>{if(r!==e.id)return e;const t=new Date,n=t.getUTCFullYear(),a=(t.getMonth()+1+"").padStart(2,"0"),o=(t.getDate()+"").padStart(2,"0");return{...e,seen:`${n}-${a}-${o}`}});(0,e.setState)({view:"loading"}),(0,t.updateContent)(n)};exports.resetSeen=w;const y=t=>{(0,e.setState)({view:"edit",editingPerson:t})},D=e=>{};
},{"./state.js":"Iw//","./google-drive-api.js":"QH5V","./persons-view.js":"xLSG"}],"xFxm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.setup=void 0;var e=require("./state.js"),t=require("./persons-model.js");const n={overlay:{selector:'div[data-prs="overlay"]',show:"flex"},loader:{selector:'div[data-prs="loader"]',show:"block"},singIn:{selector:'button[data-prs="googleDriveButton"]',show:"block"},edit:{selector:'div[data-prs="edit"]',show:"block"}},d=e=>{o(n.loader,"loading"===e.view),o(n.singIn,"signIn"===e.view),o(n.edit,"edit"===e.view),o(n.overlay,["loading","edit","signIn"].includes(e.view)),"edit"===e.view&&e.editingPerson&&i(e.persons.find(({id:t})=>t===e.editingPerson))},i=d=>{const i=document.querySelector(n.edit.selector);i.innerHTML="";const o=document.createElement("input"),r=document.createElement("input"),s=document.createElement("button"),l=document.createElement("button"),a=document.createElement("button");s.innerText="Save",l.innerText="Seen today",a.innerText="Cancel",o.value=d.name,r.value=d.birthday,s.addEventListener("click",()=>{(0,t.editPerson)(d.id,o.value,r.value)}),l.addEventListener("click",()=>{(0,t.resetSeen)(d.id)}),a.addEventListener("click",()=>{(0,e.setState)({view:"persons",editingPerson:null})}),i.appendChild(o),i.appendChild(r),i.appendChild(s),i.appendChild(l),i.appendChild(a)},o=(e,t)=>{document.querySelector(e.selector).style.display=t?e.show:"none"},r=()=>{(0,e.addListener)(d)};exports.setup=r;
},{"./state.js":"Iw//","./persons-model.js":"pIMj"}],"H99C":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"googleLibLoaded",{enumerable:!0,get:function(){return e.libLoaded}}),exports.setup=void 0;var e=require("./google-drive-model.js"),r=require("./persons-model.js"),o=require("./overlay.js");const t=()=>{(0,e.setup)(),(0,o.setup)(),(0,r.setup)()};exports.setup=t;
},{"./google-drive-model.js":"thyU","./persons-model.js":"pIMj","./overlay.js":"xFxm"}]},{},["H99C"], "prs")
//# sourceMappingURL=/personas/src.d512665d.map