{"version":3,"sources":["data-provider/actions.js","person/person-actions.js","store/reducer.js","store/store.js","app/app-action.js","router/routes.js","router/router-actions.js","data-provider/data-provider-middleware.js","utils/dom.js","login/login-view.js","utils/date.js","person/person-util.js","person/persons-model.js","components/icons.js","header/header.js","components/birthday-picker.js","person/person-add-edit-view.js","person/persons-view.js","router/router.js","app/use-local-storage.js","data-provider/google-drive/google-drive-api.js","data-provider/google-drive/google-drive-model.js","index.js"],"names":["ACTIONS","LIB_LOADED","SYNC_CLICK","SYNC_START","SYNC_END","LOGIN","SET","syncStart","type","syncEnd","setProviders","providers","payload","editField","editPerson","save","FETCH","ADD","REMOVE","TOGGLE_DELETE_OVERLAY","TOGGLE_ADD","field","value","person","remove","id","saveAll","persons","toggleAdd","isVisible","reducer","state","action","PERSON","_","personEdit","deleteOverlayId","isAddingPerson","APP","setActiveElement","activeElement","DATA_PROVIDER","isSyncing","dataProviders","listeners","listenersAfter","getState","setState","newState","dispatch","console","log","forEach","listener","fn","subscribe","callback","push","subscribeAfter","init","storeActiveElement","el","document","key","getAttribute","getActiveElement","querySelector","ROUTES","home","login","add","edit","go","goToAdd","goToEdit","goToHome","goToLogin","defaultResult","updated","run","register","provider","merge","newer","older","_newer","getProviders","filter","isEnabled","isLogged","cleanResult","result","sync","promisesGet","map","get","results","Promise","all","reduce","providersToSync","promisesSet","i","set","localToRemote","setData","promises","catch","err","error","syncClick","p","loginProvider","resolve","data","Date","getTime","dataWithUpdated","dataProvider","isSyncOk","allOk","isOk","APP_ACTIONS","addTestAttribute","element","window","Cypress","setAttribute","createDom","tag","attrs","children","createElement","attachAttributeToEl","attachAttribute","Object","keys","Array","isArray","Boolean","child","trim","innerHTML","createTextNode","appendChild","addEventListener","className","classList","div","theArgs","render","onClick","innerText","parseDate","isoDate","date","day","getDate","month","getMonth","year","getFullYear","createDate","createIso","d","padStart","formatDMY","getNow","diffDays","fromDate","toDate","join","fromDay","fromMonth","toDay","toMonth","toYear","from","diff","Math","ceil","createId","name","toLowerCase","split","DEFAULTS","getProps","getPersons","isAdd","onSave","onCancel","values","now","birthday","age","getAge","daysToBirthday","parseInt","seenBefore","getSeenBefore","seen","onEditClick","onRemoveClick","toggleRemoveOverlay","cancelRemove","sort","sortByBirthday","personRest","personA","personB","getBirthday","isoDay","abs","getUTCFullYear","days","round","getValidationError","match","warn","spaceEl","renderTitle","renderSync","renderAdd","c","classNames","testId","ICONS","DEFAULT_PERSON","birthdayPicker","onChange","createOptions","start","end","selected","options","length","v","k","option","dayEl","monthEl","yearEl","onChangeCb","ev","target","props","Error","renderName","renderPicker","renderSaveButton","renderRemoveButton","onRemove","renderCancelButton","placeholder","e","clearPersons","renderEmpty","renderPerson","renderRemoveOverlay","renderEditOverlay","bind","renderBirthday","renderSeen","renderCustomTexts","customTexts","onConfirmClick","onCancelClick","createPersonEl","renderText","text","getRoute","location","pathname","substring","path","history","pushState","route","body","handleLoginClick","personModel","app","getElementById","focus","setup","onpopstate","storage","localStorage","json","JSON","stringify","setItem","parse","getItem","APP_FOLDER","FILE_NAME","onSignInChangeHandler","Function","fileId","folderId","defaultContent","setupOptions","reject","gapi","load","initClient","then","defaultContentOption","onSignInChange","client","auth2","getAuthInstance","isSignedIn","listen","updateSignInStatus","isInitiated","signIn","fetchData","getFolder","getFile","getFileContent","drive","files","list","q","execute","response","createFolder","metadata","mimeType","create","resource","createFile","boundary","delimiter","parents","multipartRequestBody","request","alt","message","content","info","method","fileContent","_isEnabled","onLibLoaded","defaultOptions","onError","alert","unescape","fetch","eval","store","googleDrive"],"mappings":"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","file":"src.a99f7acd.js","sourceRoot":"../src","sourcesContent":["export const ACTIONS = {\n\tLIB_LOADED: 'data-provider/lib-loaded',\n\tSYNC_CLICK: 'data-provider/sync-click', // on click\n\tSYNC_START: 'data-provider/sync-start',\n\tSYNC_END: 'data-provider/sync-end',\n\tLOGIN: 'data-provider/login',\n\tSET: 'data-provider/set', // sets providers in store\n}\n\nexport const syncStart = () => ({type: ACTIONS.SYNC_START});\nexport const syncEnd = () => ({type: ACTIONS.SYNC_END});\nexport const setProviders = (providers) => ({type: ACTIONS.SET, payload: providers});\n","// @ts-check\nexport const ACTIONS = {\n\teditField: 'person/editField', // when typing in add/edit fields\n\teditPerson: 'person/editPerson', // when setting all fields to edit\n\tsave: 'person/save', // when saving added/edited person\n\tFETCH: 'person/fetch',\n\tSET: 'person/set', // when setting from remote storage\n\tADD: 'person/add',\n\tREMOVE: 'person/remove',\n\tTOGGLE_DELETE_OVERLAY: 'person/toggleDeleteOverlay',\n\tTOGGLE_ADD: 'person/toggleAdd',\n}\n\n/**\n * Sets a value to a one field in `personEdit` value in state.\n * @param {string} field\n * @param {any} value\n */\nexport const editField = (field, value) => ({type: ACTIONS.editField, payload: {field, value}})\n\n/**\n * Sets person as `personEdit` into state.\n * @param {PersonEdit?} person\n */\nexport const editPerson = (person) => ({type: ACTIONS.editPerson, payload: person})\n\n/**\n * Saves one person into the state.\n * @param {Person} person\n */\nexport const save = (person) => ({type: ACTIONS.save, payload: person})\n\n/**\n * Removes person from state.\n * @param {string} id\n */\nexport const remove = (id) => ({type: ACTIONS.REMOVE, payload: id})\n\n/**\n * Saves all persons to the state and overwrites all existing.\n * @param {Person[]} persons\n */\nexport const saveAll = (persons) => ({type: ACTIONS.SET, payload: persons})\nexport const toggleAdd = (isVisible) => ({type: ACTIONS.TOGGLE_ADD, payload: isVisible})\n","// @ts-check\nimport {ACTIONS as PERSON} from '../person/person-actions'\nimport {ACTIONS as DATA_PROVIDER} from '../data-provider/actions'\nimport {ACTIONS as APP} from '../app/app-action'\n\n/**\n * Creates a new state based on action.\n *\n * @param {State} state state\n * @param {Action} action action\n */\nexport const reducer = (state, action) => {\n\tswitch (action.type) {\n\t\tcase PERSON.save: {\n\t\t\tconst persons = {\n\t\t\t\t...state.persons,\n\t\t\t\t[action.payload.id]: action.payload,\n\t\t\t}\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tpersons,\n\t\t\t}\n\t\t}\n\t\tcase PERSON.SET: {\n\t\t\treturn {\n\t\t\t\tpersons: action.payload,\n\t\t\t}\n\t\t}\n\t\t// case PERSON.ADD: {\n\t\t// \tconst persons = state.persons.concat(action.payload)\n\t\t// \treturn {\n\t\t// \t\t...state,\n\t\t// \t\tpersons,\n\t\t// \t}\n\t\t// }\n\t\tcase PERSON.REMOVE: {\n\t\t\tconst {payload} = action\n\t\t\tif (typeof payload !== 'string') return state\n\t\t\t// @ts-ignore\n\t\t\tconst {[payload]: _, ...persons} = state.persons\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tpersons,\n\t\t\t}\n\t\t}\n\t\tcase PERSON.editField: {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tpersonEdit: {\n\t\t\t\t\t...state.personEdit,\n\t\t\t\t\t[action.payload.field]: action.payload.value,\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t\tcase PERSON.editPerson: {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tpersonEdit: action.payload,\n\t\t\t}\n\t\t}\n\t\tcase PERSON.TOGGLE_DELETE_OVERLAY: {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tdeleteOverlayId: action.payload,\n\t\t\t}\n\t\t}\n\t\tcase PERSON.TOGGLE_ADD: {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisAddingPerson: action.payload,\n\t\t\t}\n\t\t}\n\t\tcase APP.setActiveElement: {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tactiveElement: action.payload,\n\t\t\t}\n\t\t}\n\t\tcase DATA_PROVIDER.SYNC_START: {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisSyncing: true,\n\t\t\t}\n\t\t}\n\t\tcase DATA_PROVIDER.SYNC_END: {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisSyncing: false,\n\t\t\t}\n\t\t}\n\t\tcase DATA_PROVIDER.SET: {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tdataProviders: [...action.payload],\n\t\t\t}\n\t\t}\n\t\tdefault:\n\t\t\treturn state\n\t}\n}\n","// @ts-check\nimport {reducer} from './reducer'\n\n/** @type {Array<Function>} */\nconst listeners = []\n\n/** @type {Array<Function>} */\nconst listenersAfter = []\n\n/** @type {State} */\nlet state = {\n\tpersons: {},\n}\n\n/**\n * Returns state\n * @returns {State}\n */\nconst getState = () => {\n\treturn state\n}\n\n/**\n * Sets a new state\n * @param {State} newState\n */\nconst setState = (newState) => {\n\tstate = {\n\t\t...state,\n\t\t...newState,\n\t}\n}\n\n/**\n * Dispatches an action which goes to the reducer.\n * @param {Action} action Action\n */\nconst dispatch = (action) => {\n\tconst state = getState()\n\tconsole.log('🔊', action.type, action.payload || '')\n\tif (!action.type) return\n\tconst newState = reducer(state, action)\n\tsetState(newState)\n\tlisteners.forEach(listener => {\n\t\tlistener(action)\n\t})\n\tlistenersAfter.forEach(fn => {\n\t\tfn(action)\n\t})\n}\n\n/**\n * Subscribes to a state update.\n *\n * @param {Function} callback Called after state is updated\n */\nconst subscribe = (callback) => {\n\tlisteners.push(callback)\n}\n\n/**\n * Adds listenersAfter to stack.\n * @param {Function} fn\n */\nconst subscribeAfter = (fn) => {\n\tlistenersAfter.push(fn)\n}\n\nexport {\n\tsubscribeAfter,\n\tsubscribe,\n\tdispatch,\n\tgetState,\n}\n","import {getState} from '../store/store'\n\nexport const ACTIONS = {\n\tsetActiveElement: 'utils/set-active-element',\n\tinit: 'app/init',\n}\n\nexport const storeActiveElement = () => {\n\tconst el = document.activeElement\n\tif (!el) return {type: ''}\n\tconst key = el.getAttribute('data-prsKey')\n\tif (!key) return {type: ''}\n\treturn {\n\t\ttype: ACTIONS.setActiveElement,\n\t\tpayload: key,\n\t}\n}\n\nexport const getActiveElement = () => {\n\tconst key = getState().activeElement\n\tif (!key) return null\n\tconst el = document.querySelector(`[data-prsKey=${key}]`)\n\treturn el\n}\n","export const ROUTES = {\n\thome: '/',\n\tlogin: 'login',\n\tadd: 'add',\n\tedit: 'edit',\n}\n","import {ROUTES} from '../router/routes'\n\nexport const ACTIONS = {\n\thome: '',\n\tlogin: '/login',\n\tgo: 'router/go',\n}\n\nexport const goToAdd = () => ({type: ACTIONS.go, payload: ROUTES.add})\nexport const goToEdit = (id) => ({type: ACTIONS.go, payload: `${ROUTES.edit}/${id}`})\nexport const goToHome = () => ({type: ACTIONS.go, payload: ROUTES.home})\nexport const goToLogin = () => ({type: ACTIONS.go, payload: ROUTES.login})\n","// @ts-check\nimport {ACTIONS, setProviders, syncStart, syncEnd} from './actions'\nimport {ACTIONS as APP_ACTIONS} from '../app/app-action'\nimport {getState, dispatch, subscribeAfter} from '../store/store'\nimport {goToLogin} from '../router/router-actions';\nimport {ACTIONS as PERSON, saveAll} from '../person/person-actions'\n\n/**\n * @typedef {Object} DataProvider\n * @property {() => void} init\n * @property {() => {persons?: Object, updated?: number}} get\n * @property {(data: Object) => void} set\n * @property {() => void} login?\n * @property {() => boolean} isLogged\n * @property {() => boolean} isEnabled\n */\n\n/**\n * Default result of fetching a data provider.\n */\nconst defaultResult = {persons: {}, updated: 0};\n\n/**\n * Register data providers.\n * @param {DataProvider[]} providers\n */\nexport default (providers) => {\n\tsubscribeAfter(run);\n\tproviders.forEach(register);\n\tdispatch(setProviders(providers));\n}\n\n/**\n * Registers a single data provider.\n * @param {DataProvider} provider\n */\nconst register = (provider) => provider.init();\n\n/**\n * Merges results of data providers.\n * Merges only `persons` property. Property `updated` is\n * copied from the newest.\n * @param {{persons: Object, updated: number}} newer\n * @param {{persons: Object, updated: number}} older\n * @returns {{persons: Object, updated: number}}\n */\nconst merge = (newer, older) => {\n\tif (older.updated > newer.updated) {\n\t\tconst _newer = newer;\n\t\tnewer = older;\n\t\tolder = _newer;\n\t}\n\treturn {\n\t\tpersons: {...older.persons, ...newer.persons},\n\t\tupdated: newer.updated,\n\t};\n}\n\n/**\n * Returns enabled data providers.\n * @returns {DataProvider[]}\n */\nconst getProviders = () => {\n\tconst providers = getState().dataProviders || [];\n\treturn providers.filter(isEnabled);\n};\n\n/**\n * Return true if a user is logged in the provider.\n * @param {DataProvider} provider\n */\nconst isLogged = (provider) => provider.isLogged();\n\n/**\n * Return true if the provider is enabled.\n * @param {DataProvider} provider\n */\nconst isEnabled = (provider) => provider.isEnabled();\n\n/**\n * Adds default values to a result of data provider.\n * @param {{persons?: Object, updated?: number}} result\n */\nconst cleanResult = (result) => ({...defaultResult, ...result});\n\n/**\n * Loads data from all providers, merges them together (the newest wins)\n * and stores to local state and to all other providers.\n */\nconst sync = async () => {\n\tdispatch(syncStart());\n\tconst providers = getProviders().filter(isLogged)\n\tconst promisesGet = providers.map(get);\n\tconst resultsDirty = await Promise.all(promisesGet);\n\tconst results = resultsDirty.map(cleanResult);\n\tconst {persons, updated} = results.reduce(merge, defaultResult);\n\tdispatch(saveAll(persons)); // save to local state\n\n\tconst providersToSync = providers.filter((_, i) => results[i].updated !== updated)\n\tconst promisesSet = providersToSync.map(set({persons, updated}));\n\tawait Promise.all(promisesSet);\n\tdispatch(syncEnd());\n}\n\nconst localToRemote = async () => {\n\tdispatch(syncStart());\n\tconst setData = set({persons: getState().persons});\n\tconst providers = getProviders().filter(isLogged)\n\tconst promises = providers.map(setData);\n\tawait Promise\n\t\t.all(promises)\n\t\t.catch((err) => console.error('Error during saving', err));\n\tdispatch(syncEnd());\n}\n\nconst syncClick = async () => {\n\tconst promises = getProviders()\n\t\t.filter(p => !p.isLogged())\n\t\t.map(loginProvider);\n\tawait Promise\n\t\t.all(promises)\n\t\t.catch((err) => console.error('Error during logging in', err));\n\tsync();\n}\n\n/**\n * Login into the provider\n * @param {DataProvider} provider\n */\nconst loginProvider = (provider) => {\n\tif (!provider.isEnabled()) return Promise.resolve();\n\tif (!provider.login) return Promise.resolve();\n\treturn provider.login();\n}\n\n/**\n * Reads data from data provider.\n * @param {DataProvider} provider\n */\nconst get = (provider) => provider.get();\n\n/**\n * Stores data to the provider.\n * @param {Object} data\n */\nconst set = (data) => {\n\tconst updated = (new Date()).getTime();\n\tconst dataWithUpdated = {...data, updated: data.updated || updated};\n\treturn async (dataProvider) => {\n\t\tawait dataProvider.set(dataWithUpdated) || Promise.resolve();\n\t};\n};\n\n/**\n * Returns whether all data providers are functional.\n * @returns {boolean}\n */\nexport const isSyncOk = () => {\n\tconst providers = getState().dataProviders || [];\n\tconst allOk = providers.reduce((isOk, provider) => {\n\t\treturn isOk && provider.isEnabled() && provider.isLogged();\n\t}, true);\n\treturn allOk;\n}\n\n/**\n * Subscription function to state update.\n * @param {Action} action\n */\nconst run = (action) => {\n\tswitch (action.type) {\n\t\tcase APP_ACTIONS.init: {\n\t\t\tsync();\n\t\t\tbreak;\n\t\t}\n\t\tcase ACTIONS.SYNC_CLICK: {\n\t\t\tsyncClick();\n\t\t\tbreak;\n\t\t}\n\t\tcase PERSON.save:\n\t\tcase PERSON.REMOVE: {\n\t\t\tlocalToRemote();\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn;\n};\n","// @ts-check\n/**\n *\n * @param {HTMLElement} element\n * @param {string} value\n */\nexport const addTestAttribute = (element, value) => {\n\t// @ts-ignore\n\tif (window && !window.Cypress) return\n\telement.setAttribute('data-cy', value)\n}\n\n/**\n * Creates a DOM structure of elements.\n *\n * @param {string} tag Type of trag (div, img)\n * @param {Object?} attrs\n * @param {string|Array<HTMLElement>?} children\n */\nexport const createDom = (tag, attrs = {}, children = []) => {\n\tconst element = document.createElement(tag);\n\tconst attachAttributeToEl = attachAttribute(element);\n\tObject.keys(attrs).map(key => attachAttributeToEl(key, attrs[key]));\n\tif (!Array.isArray(children)) children = [children];\n\tchildren.filter(Boolean).forEach(child => {\n\t\tif (typeof child === 'string') {\n\t\t\tif (child.trim()[0] === '<') {\n\t\t\t\telement.innerHTML = child; // Inject HTML into the element. Not ideal.\n\t\t\t\treturn\n\t\t\t}\n\t\t\tchild = document.createTextNode(child);\n\t\t}\n\t\telement.appendChild(child)\n\t});\n\treturn element;\n}\n\nconst attachAttribute = (element) => (key, value) => {\n\tswitch (key) {\n\t\tcase 'onClick': {\n\t\t\telement.addEventListener('click', value);\n\t\t\tbreak;\n\t\t}\n\t\tcase 'className': {\n\t\t\tif (!Array.isArray(value)) value = [value];\n\t\t\tvalue.forEach(className => element.classList.add(className));\n\t\t\tbreak;\n\t\t}\n\t\tcase 'testId': {\n\t\t\taddTestAttribute(element, value);\n\t\t\tbreak;\n\t\t}\n\t\tdefault: {\n\t\t\telement.setAttribute(key, value);\n\t\t}\n\t}\n};\n\nexport const div = (...theArgs) => createDom('div', ...theArgs);\n","import {createDom, div} from '../utils/dom';\nimport {ACTIONS as DATA_PROVIDER} from '../data-provider/actions';\nimport {dispatch} from '../store/store';\n\nexport default function render () {\n\tconst onClick = () => dispatch({type: DATA_PROVIDER.LOGIN});\n\tconst login = createDom('button', {onClick});\n\tlogin.innerText = 'Login'\n\treturn (\n\t\tdiv({}, login)\n\t);\n}\n","// @ts-check\n\n/**\n * Parses `2001-12-31` to separate values\n * @param {string} isoDate\n * @returns {{day: string, month: string, year: string}} object with day, month, year\n */\nexport const parseDate = (isoDate) => {\n\tconst date = new Date(isoDate)\n\tconst day = date.getDate() + ''\n\tconst month = date.getMonth() + 1 + ''\n\tconst year = date.getFullYear() + ''\n\treturn {day, month, year}\n}\n\nexport const createDate = (day, month, year) => new Date(year, month - 1, day)\n\nexport const createIso = (day, month, year) => {\n\tconst d = day.padStart(2, '0')\n\tconst m = month.padStart(2, '0')\n\treturn `${year}-${m}-${d}`\n}\n\nexport const formatDMY = (isoDate) => {\n\tconst {day, month, year} = parseDate(isoDate)\n\treturn `${day}. ${month}. ${year}`\n}\n\nexport const getNow = () => {\n\tconst date = new Date();\n\treturn [date.getDate(), date.getMonth() + 1];\n};\n\n/**\n * Returns number of days before birthday\n * @param {Array<number>} fromDate [day, month]\n * @param {Array<number>} toDate [day, month]\n * @returns {number}\n */\nexport const diffDays = (fromDate, toDate) => {\n\tconst createDate = (year, day, month) => new Date([year, month, day].join('-'));\n\tif (!fromDate) return null\n\tconst [fromDay, fromMonth] = fromDate;\n\tconst [toDay, toMonth] = toDate;\n\tconst isToAfter = fromMonth <= toMonth && fromDay <=toDay;\n\tconst fromYear = '2000'; // prestupny rok?\n\tconst toYear = isToAfter ? '2000' : '2001';\n\tconst from = createDate(fromYear, fromDay, fromMonth);\n\tconst to = createDate(toYear, toDay, toMonth);\n\tconst diff = to.getTime() - from.getTime();\n\treturn Math.ceil(diff / 1000 / 60 / 60 / 24);\n}\n","export const createId = (name) => {\n\treturn name\n\t\t.trim()\n\t\t.toLowerCase()\n\t\t.split(' ')\n\t\t.filter(Boolean)\n\t\t.join('-')\n}\n","// @ts-check\n/// <reference path=\"./person-types.d.ts\" />\n\nimport {dispatch, getState} from '../store/store'\nimport {parseDate, createIso, diffDays, getNow} from '../utils/date'\nimport {editPerson, ACTIONS as PERSON, toggleAdd, save as savePerson} from '../person/person-actions'\nimport {goToEdit, goToHome} from '../router/router-actions'\nimport { createId } from './person-util'\n\n\nexport const DEFAULTS = {\n\tname: '',\n\tday: '1',\n\tmonth: '1',\n\tyear: '1980',\n}\n\n/**\n * @returns {PersonModelProps}\n */\nexport const getProps = () => {\n\treturn {\n\t\tpersons: getPersons(),\n\t\tisAdd: getState().isAddingPerson,\n\t\tonSave: () => save(),\n\t\tonCancel: () => {\n\t\t\tdispatch(toggleAdd(false))\n\t\t\tdispatch(editPerson(null))\n\t\t},\n\t}\n}\n\n/**\n * @returns {Array<PersonProps>}\n */\nconst getPersons = () => {\n\tconst persons = Object.values(getState().persons)\n\t\t.map(person => {\n\t\t\tconst now = getNow();\n\t\t\tconst {day, month} = parseDate(person.birthday);\n\t\t\treturn {\n\t\t\t\t...person,\n\t\t\t\tage: getAge(person.birthday),\n\t\t\t\tdaysToBirthday: diffDays(now, [parseInt(day, 10), parseInt(month, 10)]),\n\t\t\t\tseenBefore: getSeenBefore(person.seen),\n\t\t\t\tonEditClick: id => {\n\t\t\t\t\t// TODO: Move to separate function\n\t\t\t\t\tconst person = getState().persons[id]\n\t\t\t\t\tif (!person) {\n\t\t\t\t\t\tconsole.error(`Person not found by id: '${id}'`);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst {day, month, year} = parseDate(person.birthday)\n\t\t\t\t\tdispatch(editPerson({...person, day, month, year}))\n\t\t\t\t\t// dispatch(goToEdit(id))\n\t\t\t\t},\n\t\t\t\tonRemoveClick: toggleRemoveOverlay,\n\t\t\t\tcancelRemove: toggleRemoveOverlay,\n\t\t\t\tremove: remove,\n\t\t\t\tsave: () => save(person.id),\n\t\t\t}\n\t\t})\n\t\t.sort(sortByBirthday)\n\treturn persons\n}\n\n/**\n * @param {string=} id\n */\nconst save = (id) => {\n\tconst {personEdit} = getState()\n\tconst {day, month, year, ...personRest} = personEdit\n\tif (!personRest.name.trim()) {\n\t\tconsole.error('Name cannot be empty');\n\t\treturn;\n\t}\n\tconst person = {\n\t\tid: id || createId(personRest.name),\n\t\t...personRest,\n\t\tbirthday: createIso(day, month, year),\n\t}\n\tdispatch(savePerson(person))\n\tdispatch(goToHome())\n\tdispatch(toggleAdd(false))\n\tdispatch(editPerson(null))\n}\n\nconst sortByBirthday = (personA, personB) => {\n\tif (!personA.birthday || !personB.birthday) return 0\n\tconst now = getNow();\n\tconst getBirthday = (person) => {\n\t\tconst {day, month} = parseDate(person.birthday);\n\t\treturn [parseInt(day, 10), parseInt(month, 10)];\n\t}\n\treturn diffDays(getBirthday(personA), now) - diffDays(getBirthday(personB), now)\n}\n\nconst getAge = (isoDay) => {\n\tif (!isoDay) return null\n\tconst now = Date.now()\n\tconst date = new Date(isoDay).getTime()\n\tconst diff = new Date(now - date)\n\tconst age = Math.abs(diff.getUTCFullYear() - 1970)\n\treturn age\n}\n\nconst getSeenBefore = (isoDay) => {\n\tif (!isoDay) return null\n\tconst now = Date.now()\n\tconst date = new Date(isoDay).getTime()\n\tconst days = Math.round((now - date) / 1000 / 60 / 60/ 24)\n\treturn days\n}\n\nconst getValidationError = (name, birthday) => {\n\tif (!name) {\n\t\treturn 'Empty name'\n\t}\n\tif (!birthday.match(/^\\d{4}-\\d{2}-\\d{2}$/)) {\n\t\treturn 'Wrong birthday format. Use YYYY-MM-DD.'\n\t}\n\treturn null\n}\n\n// const resetSeen = (id) => {\n// \tconst persons = getState().persons.map((person) => {\n// \t\tif (id !== person.id) return person\n// \t\tconst now = new Date()\n// \t\tconst year = now.getUTCFullYear()\n// \t\tconst month = (now.getMonth() + 1 + '').padStart(2, '0')\n// \t\tconst day = (now.getDate() + '').padStart(2, '0')\n// \t\treturn {\n// \t\t\t...person,\n// \t\t\tseen: `${year}-${month}-${day}`,\n// \t\t}\n// \t})\n// \tdispatch({type: PERSON.SYNC})\n// }\n\n/**\n * Shows or hide remove overlay.\n * @param {string} id\n */\nconst toggleRemoveOverlay = id => {\n\tdispatch({type: PERSON.TOGGLE_DELETE_OVERLAY, payload: id})\n}\n\n/**\n * Removes a person.\n * @param {string} id\n */\nconst remove = id => {\n\tdispatch({type: PERSON.REMOVE, payload: id})\n}\n","export default {\n\tedit: `\n\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n\t\t\t<path d=\"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41\n\t\t\t\t0l-1.83 1.83 3.75 3.75 1.83-1.83z\"/>\n\t\t\t<path d=\"M0 0h24v24H0z\" fill=\"none\"/>\n\t\t</svg>\n\t`,\n\tremove: `\n\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n\t\t\t<path d=\"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z\"/>\n\t\t\t<path d=\"M0 0h24v24H0z\" fill=\"none\"/>\n\t\t</svg>\n\t`,\n\tadd: `\n\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n\t\t\t<path d=\"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z\"/><path d=\"M0 0h24v24H0z\" fill=\"none\"/>\n\t\t</svg>\n\t`,\n\tsync: `\n\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\n\t\t\t<path d=\"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0\n\t\t\t14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z\"/><path d=\"M0 0h24v24H0z\" fill=\"none\"/>\n\t\t</svg>\n\t`,\n\twarn: `\n\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path d=\"M0 0h24v24H0z\" fill=\"none\"/>\n\t\t\t<path d=\"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z\"/>\n\t\t</svg>\n\t`,\n}\n","import {dispatch, getState} from '../store/store'\nimport {goToAdd} from '../router/router-actions'\nimport {DEFAULTS as DEFAULT_PERSON} from '../person/persons-model'\nimport {editPerson, toggleAdd} from '../person/person-actions'\nimport {ACTIONS as DATA_PROVIDER} from '../data-provider/actions';\nimport {isSyncOk} from '../data-provider/data-provider-middleware';\nimport {addTestAttribute, div} from '../utils/dom';\nimport ICONS from '../components/icons'\nimport './header.css'\n\nexport default function render () {\n\tconst el = document.createElement('div')\n\tconst spaceEl = document.createElement('div')\n\tspaceEl.classList.add('spaceEl')\n\tel.classList.add('app-header')\n\taddTestAttribute(el, 'header')\n\tconst content = [\n\t\trenderTitle(),\n\t\tspaceEl,\n\t\trenderSync(),\n\t\trenderAdd(),\n\t]\n\tcontent.map((c) => el.appendChild(c))\n\treturn el\n}\n\nconst renderTitle = () => {\n\tconst el = document.createElement('h1')\n\tel.classList.add('header__title')\n\tel.innerHTML = 'Persons'\n\treturn el\n}\n\nconst renderSync = () => {\n\tconst classNames = ['header-button--sync'];\n\tlet warn = null;\n\tif (!isSyncOk()) {\n\t\tclassNames.push('header__sync-error');\n\t\twarn = div({className: 'header-button--warn', testId: `header-button--warn`}, ICONS.warn);\n\t}\n\tif (getState().isSyncing) {\n\t\tclassNames.push('header__sync-inProgress');\n\t}\n\tconst onClick = () => dispatch({type: DATA_PROVIDER.SYNC_CLICK});\n\treturn (\n\t\tdiv({className: 'header__syncWrap'}, [\n\t\t\tdiv({className: classNames, testId: `header-button--sync`, onClick}, ICONS.sync),\n\t\t\twarn,\n\t\t])\n\t);\n}\n\nconst renderAdd = () => {\n\tconst el = document.createElement('div')\n\tel.classList.add('header-button--add')\n\tel.setAttribute('data-cy', 'header-button--add')\n\tel.addEventListener('click', () => {\n\t\tdispatch(editPerson(DEFAULT_PERSON))\n\t\tdispatch(toggleAdd(true))\n\t})\n\tel.innerHTML = ICONS.add\n\treturn el\n}\n","export const birthdayPicker = ({day, month, year}, onChange) => {\n\tconst createOptions = (start, end, selected) => {\n\t\tconst options = Array.from({length: end + 1 - start}, (v, k) => start + k) \n\t\treturn options.map(i => {\n\t\t\tconst option = document.createElement('option')\n\t\t\tconst value = i + ''\n\t\t\toption.innerText = value\n\t\t\toption.value = value\n\t\t\tif (selected && value === selected) option.selected = true\n\t\t\treturn option\n\t\t})\n\t}\n\n\tconst dayEl = document.createElement('select')\n\tconst monthEl = document.createElement('select')\n\tconst yearEl = document.createElement('select')\n\tcreateOptions(1, 31, day).forEach(option => dayEl.appendChild(option))\n\tcreateOptions(1, 12, month).forEach(option => monthEl.appendChild(option))\n\tcreateOptions(1900, 2019, year).forEach(option => yearEl.appendChild(option))\n\t\n\t/**\n\t * @param {HTMLInputElement} type \n\t */\n\tconst onChangeCb = (type) => (ev) => onChange(type, (ev.target).value)\n\t\n\tdayEl.addEventListener('change', onChangeCb('day'))\n\tmonthEl.addEventListener('change', onChangeCb('month'))\n\tyearEl.addEventListener('change', onChangeCb('year'))\n\n\treturn [dayEl, monthEl, yearEl]\n}\n","// @ts-check\nimport {dispatch, getState} from '../store/store'\nimport {birthdayPicker} from '../components/birthday-picker'\nimport {editField, remove} from './person-actions'\nimport {storeActiveElement} from '../app/app-action'\nimport {addTestAttribute, div, createDom} from '../utils/dom';\n\n/**\n * @param {{onSave: Function, onCancel: Function, onRemove: Function}} props\n */\nexport default function render (props) {\n\tconst el = document.createElement('div')\n\tel.classList.add('person')\n\tconst {personEdit} = getState()\n\tif (!personEdit) throw new Error('Empty `personEdit')\n\tconst content = [\n\t\tdiv({className: ['person__column', 'person__column-grow']}, [\n\t\t\trenderName(personEdit.name),\n\t\t\trenderPicker(personEdit.day, personEdit.month, personEdit.year),\n\t\t]),\n\t\tdiv({className: 'person__column'}, [\n\t\t\trenderSaveButton(personEdit, props.onSave),\n\t\t\tdiv({className: 'person__secondaryButtons'}, [\n\t\t\t\trenderRemoveButton(props.onRemove),\n\t\t\t\trenderCancelButton(props.onCancel),\n\t\t\t]),\n\t\t]),\n\t]\n\tcontent.map((c) => el.appendChild(c))\n\treturn el\n}\n\nconst renderName = (name) => {\n\tconst el = document.createElement('input')\n\tel.placeholder = 'Name'\n\tel.classList.add('person__input')\n\taddTestAttribute(el, 'add-input--name')\n\tel.setAttribute('data-prsKey', 'add-input--name')\n\tel.value = name\n\tel.addEventListener('input', e => {\n\t\tdispatch(storeActiveElement())\n\t\tdispatch(editField('name', el.value))\n\t})\n\t// TODO: storeActiveElement na unfocus\n\treturn el\n}\n\nconst renderPicker = (day, month, year) => {\n\tconst el = document.createElement('div')\n\tel.setAttribute('data-cy', 'add-input--birthday')\n\tel.classList.add('person__input')\n\tconst [dayEl, monthEl, yearEl] = birthdayPicker({day, month, year}, (field, value) => {\n\t\tdispatch(editField(field, value))\n\t})\n\tel.appendChild(dayEl)\n\tel.appendChild(monthEl)\n\tel.appendChild(yearEl)\n\treturn el\n}\n\nconst renderSaveButton = (personEdit, onSave) => {\n\treturn createDom('button', {\n\t\tclassName: ['person__button', 'person__button--primary'],\n\t\tonClick: onSave,\n\t\ttestId: 'add-button--save',\n\t}, 'OK');\n}\n\nconst renderCancelButton = (onCancel) => {\n\treturn createDom('span', {\n\t\tclassName: ['button', 'person__button--secondary'],\n\t\tonClick: onCancel,\n\t\ttestId: 'add-button--cancel',\n\t}, 'Cancel');\n}\n\nconst renderRemoveButton = (onRemove) => {\n\treturn createDom('span', {\n\t\tclassName: ['button', 'person__button--secondary', 'warning'],\n\t\tonClick: onRemove,\n\t}, 'Remove');\n};\n","// @ts-check\n/// <reference path=\"./person-types.d.ts\" />\n\nimport ICONS from '../components/icons'\nimport {formatDMY} from '../utils/date'\nimport {addTestAttribute, div, createDom} from '../utils/dom'\nimport { getState } from \"../store/store\"\nimport renderAddEdit from './person-add-edit-view'\nimport './person.css'\n\n/**\n * Render\n * @param {PersonModelProps} props Properties\n */\nexport default function render (props) {\n\tclearPersons() // TODO: clean when necessary\n\tconst el = document.createElement('div')\n\tel.classList.add('persons')\n\taddTestAttribute(el, 'persons')\n\tif (props.isAdd) {\n\t\tel.appendChild(renderAddEdit({onSave: props.onSave, onCancel: props.onCancel}))\n\t} else if (props.persons.length === 0) {\n\t\tel.classList.add('empty');\n\t\tel.appendChild(renderEmpty())\n\t}\n\tprops.persons\n\t\t.map(renderPerson(props.onCancel))\n\t\t.forEach(person => el.appendChild(person))\n\treturn el\n}\n\n/**\n * Renders element with person.\n * @param {Function} onCancel\n * @returns {(PersonProps) => HTMLElement}\n */\nconst renderPerson = onCancel => person => {\n\tconst {deleteOverlayId, personEdit} = getState()\n\tif (deleteOverlayId === person.id) return renderRemoveOverlay(person)\n\tif (personEdit && personEdit.id === person.id) return renderEditOverlay(person, onCancel)\n\n\tconst onEditClick = person.onEditClick.bind(null, person.id);\n\tconst onRemoveClick = person.onRemoveClick.bind(null, person.id);\n\treturn (\n\t\tdiv({className: 'person', testId: `person-${person.id}`}, [\n\t\t\tdiv({className: ['person__column', 'person__column-grow']}, [\n\t\t\t\trenderTitle(person.name),\n\t\t\t\trenderBirthday(person),\n\t\t\t\trenderSeen(person.seenBefore),\n\t\t\t\t...renderCustomTexts(person.customTexts),\n\t\t\t]),\n\t\t\tdiv({className: 'person__column'}, [\n\t\t\t\tdiv({className: ['icon-edit', 'icon'], testId: 'edit', onClick: onEditClick}, ICONS.edit),\n\t\t\t]),\n\t\t])\n\t);\n}\n\nconst renderEmpty = () => {\n\treturn div({className: 'personsEmpty', testId: 'personsEmpty'}, ['No persons created yet.'])\n}\n\nconst renderRemoveOverlay = person => {\n\tconsole.log('🔊', 'renderRemoveOverlay')\n\tconst onConfirmClick = ev => person.remove(person.id);\n\tconst onCancelClick = person.cancelRemove.bind(null, null);\n\treturn (\n\t\tdiv({className: 'person', testId: `person-${person.id}`}, [\n\t\t\tdiv({className: 'person__removeOverlay', testId: 'remove-overlay'}, [\n\t\t\t\tcreateDom('button', {\n\t\t\t\t\tclassName: ['person__button', 'person__button--warning'],\n\t\t\t\t\tonClick: onConfirmClick,\n\t\t\t\t}, 'Remove'),\n\t\t\t\tcreateDom('button', {\n\t\t\t\t\tclassName: ['person__button'],\n\t\t\t\t\tonClick: onCancelClick,\n\t\t\t\t}, 'Cancel'),\n\t\t\t]),\n\t\t])\n\t);\n}\n\nconst renderEditOverlay = (person, onCancel) => {\n\tconst onRemove = person.onRemoveClick.bind(null, person.id);\n\treturn renderAddEdit({onSave: person.save, onCancel, onRemove})\n}\n\nconst createPersonEl = person => {\n\treturn div({className: 'person', testId: `person-${person.id}`});\n}\n\nconst renderTitle = (value) => {\n\tconst el = renderText(value)\n\tel.classList.add('person-title')\n\taddTestAttribute(el, 'title')\n\treturn el\n}\n\nconst renderText = (value) => {\n\tconst el = document.createElement('div')\n\tel.innerHTML = value\n\treturn el\n}\n\nconst renderBirthday = ({birthday, age, daysToBirthday}) => {\n\tif (!birthday) return null\n\tconst el = document.createElement('div')\n\taddTestAttribute(el, 'birthday')\n\tconst birthdayDMY = formatDMY(birthday)\n\tlet text = `Age: ${age}<br />Birthday in ${daysToBirthday} days (${birthdayDMY})`;\n\tif (daysToBirthday === 1) {\n\t\ttext = `Tomorrow is the ${age + 1}'s birthday`;\n\t}\n\tif (daysToBirthday === 0) {\n\t\ttext = `🎉 Today is celebrating ${age} years 🎊`;\n\t}\n\tel.innerHTML = text;\n\treturn el\n}\n\nconst renderSeen = (days) => {\n\tif (!days && days !== 0) return null\n\tconst el = document.createElement('div')\n\tconst button = document.createElement('button')\n\tel.innerHTML = `Seen before ${days} days`\n\treturn el\n}\n\nconst renderCustomTexts = (values) => {\n\tif (!values) return []\n\treturn values.map(renderText)\n}\n\nconst clearPersons = () => {\n\tconst el = document.querySelector('.persons')\n\tif (!el) return\n\tel.innerHTML = ''\n}\n","import {subscribe, dispatch} from '../store/store'\nimport {ACTIONS as DATA_PROVIDER} from '../data-provider/actions'\nimport Login from '../login/login-view'\nimport Header from '../header/header'\nimport Persons from '../person/persons-view'\nimport {ROUTES} from '../router/routes'\nimport {ACTIONS} from '../router/router-actions'\nimport * as personModel from '../person/persons-model'\nimport {getActiveElement} from '../app/app-action'\n\nconst getRoute = () => {\n\treturn window.location.pathname.substring(1).split('/')[0]\n}\n\nconst go = path => {\n\tif (path === getRoute()) return\n\thistory.pushState({}, '', path)\n}\n\nconst route = action => {\n\tif (action.type === ACTIONS.go) {\n\t\tgo(action.payload)\n\t}\n\tconst route = getRoute()\n\tlet body = []\n\tswitch (route) {\n\t\tcase ROUTES.login: {\n\t\t\tbody.push(\n\t\t\t\tHeader(),\n\t\t\t\tLogin({\n\t\t\t\t\thandleLoginClick: () => dispatch({type: DATA_PROVIDER.LOGIN}),\n\t\t\t\t})\n\t\t\t)\n\t\t\tbreak;\n\t\t}\n\t\tdefault: {\n\t\t\tbody = [\n\t\t\t\tHeader(),\n\t\t\t\tPersons(personModel.getProps()),\n\t\t\t]\n\t\t}\n\t}\n\tconst app = document.getElementById('app')\n\tapp.innerHTML = ''\n\tbody.map((el) => app.appendChild(el))\n\tconst activeElement = getActiveElement()\n\tif (activeElement) {\n\t\tactiveElement.focus()\n\t}\n}\n\nexport const setup = () => {\n\twindow.onpopstate = route\n\tsubscribe(route);\n}\n","// @ts-check\nconst storage = window.localStorage;\n\n/**\n * Saves state to local storage.\n * @param {Object} persons\n */\nconst set = (persons) => {\n\tconsole.log('🔊', 'storing to localStorage')\n\tconst json = JSON.stringify(persons)\n\tstorage.setItem('persons', json)\n}\n\n/**\n * Get persons from local storage.\n */\nconst get = () => {\n\tconst persons = JSON.parse(storage.getItem('persons'))\n\treturn persons || {};\n}\n\nconst isEnabled = () => true;\nconst isLogged = () => true;\n\n/**\n * Initialization\n */\nconst init = () => {};\n\nexport default {\n\tinit,\n\tget,\n\tset,\n\tisLogged,\n\tisEnabled,\n}\n","// @ts-check\nconst APP_FOLDER = 'App-Personas'\nconst FILE_NAME = 'persons.json'\nlet onSignInChangeHandler = Function\nlet fileId = ''\nlet folderId = ''\nlet defaultContent = null\n\nconst init = async (options = {}) => {\n\tsetupOptions(options)\n\treturn new Promise ((resolve, reject) => {\n\t\tgapi.load('client:auth2', () => {\n\t\t\tinitClient().then(resolve).catch(reject);\n\t\t})\n\t})\n}\n\nconst setupOptions = ({defaultContentOption = null, onSignInChange = null}) => {\n\tif (onSignInChange) onSignInChangeHandler = onSignInChange\n\tif (defaultContentOption) defaultContent = defaultContentOption\n}\n\nconst initClient = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tgapi.client.init({\n\t\t\t'apiKey': 'AIzaSyBYItpNT8k2Y2AEHz2E2kI2EqMULh5C4m0',\n\t\t\t'discoveryDocs': ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],\n\t\t\t'clientId': '614338309616-st9nui22tf3sa1cm9m1l3nd439n50frg.apps.googleusercontent.com',\n\t\t\t'scope': 'https://www.googleapis.com/auth/drive.file',\n\t\t})\n\t\t.then(() => {\n\t\t\tgapi.auth2.getAuthInstance().isSignedIn.listen(updateSignInStatus)\n\t\t\tupdateSignInStatus(gapi.auth2.getAuthInstance().isSignedIn.get())\n\t\t\tresolve({isInitiated: true})\n\t\t})\n\t\t.catch(reject)\n\t})\n}\n\nconst updateSignInStatus = (isLogged) => {\n\t// TODO: Pass logged user instead of `isLogged`\n\tonSignInChangeHandler(isLogged)\n}\n\nconst isLogged = () => {\n\treturn gapi.auth2.getAuthInstance().isSignedIn.get();\n}\n\nconst login = async () => {\n\tconst {signIn, isSignedIn} = gapi.auth2.getAuthInstance();\n\tif (isSignedIn.get()) {\n\t\treturn Promise.resolve(true);\n\t}\n\treturn await signIn();\n}\n\nconst fetchData = () => {\n\tconsole.log('🔊', 'fetchingData from API')\n\treturn getFolder()\n\t.then(getFile)\n\t.then(getFileContent)\n}\n\nconst getFolder = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst request = gapi.client.drive.files.list({\n\t\t\tq: `name='${APP_FOLDER}' and trashed=false`,\n\t\t})\n\n\t\trequest.execute((response) => {\n\t\t\tif (typeof response !== 'object' || !response.files) return\n\t\t\tif (response.files.length === 0) {\n\t\t\t\tcreateFolder().then(resolve)\n\t\t\t} else {\n\t\t\t\tfolderId = response.files[0].id\n\t\t\t\tresolve()\n\t\t\t}\n\t\t})\n\t})\n}\n\nconst createFolder = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst metadata = {\n\t\t\tname: APP_FOLDER,\n\t\t\tmimeType: 'application/vnd.google-apps.folder',\n\t\t}\n\t\tconst request = gapi.client.drive.files.create({resource: metadata})\n\t\trequest.execute((response) => {\n\t\t\tfolderId = response.id\n\t\t\tresolve()\n\t\t})\n\t})\n}\n\nconst getFile = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst request = gapi.client.drive.files.list({\n\t\t\tq: `name=\"${FILE_NAME}\" and '${folderId}' in parents and trashed=false`,\n\t\t})\n\t\trequest.execute((response) => {\n\t\t\tconsole.log('🔊', 'response', response)\n\t\t\tif (response.files.length === 0) {\n\t\t\t\tcreateFile().then(resolve)\n\t\t\t} else {\n\t\t\t\tfileId = response.files[0].id\n\t\t\t\tresolve()\n\t\t\t}\n\t\t})\n\t})\n}\nconst createFile = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst boundary = '-------314159265358979323846'\n\t\tconst delimiter = \"\\r\\n--\" + boundary + \"\\r\\n\"\n\t\tconst closeDelim = \"\\r\\n--\" + boundary + \"--\"\n\n\t\tconst contentType = 'application/json'\n\n\t\tconst metadata = {\n\t\t\tname: FILE_NAME,\n\t\t\tmimeType: contentType,\n\t\t\tparents: [folderId],\n\t\t}\n\n\t\tconst multipartRequestBody =\n\t\t\tdelimiter +\n\t\t\t'Content-Type: application/json\\r\\n\\r\\n' +\n\t\t\tJSON.stringify(metadata) +\n\t\t\tdelimiter +\n\t\t\t'Content-Type: ' + contentType + '\\r\\n\\r\\n' +\n\t\t\t(defaultContent ? JSON.stringify(defaultContent) : '') +\n\t\t\tcloseDelim\n\n\t\tconst request = gapi.client.request({\n\t\t\t'path': '/upload/drive/v3/files',\n\t\t\t'method': 'POST',\n\t\t\t'params': {'uploadType': 'multipart'},\n\t\t\t'headers': {\n\t\t\t  'Content-Type': 'multipart/related; boundary=\"' + boundary + '\"',\n\t\t\t},\n\t\t\t'body': multipartRequestBody,\n\t\t})\n\n\t\trequest.execute((response) => {\n\t\t\tfileId = response.id\n\t\t\tresolve()\n\t\t})\n\t})\n}\n\nconst getFileContent = () => {\n\tconsole.log('🔊', 'getFileContent')\n\treturn new Promise ((resolve, reject) => {\n\t\tconsole.log('🔊', 'fileId', fileId)\n\t\tconst request = gapi.client.drive.files.get({\n\t\t\tfileId: fileId,\n\t\t\talt: 'media',\n\t\t})\n\t\trequest.execute((response) => {\n\t\t\tif (response.error) {\n\t\t\t\treject(`Error during file download: ${response.error.message}`)\n\t\t\t\treturn\n\t\t\t}\n\t\t\tconsole.log('response.result', response.result);\n\t\t\tresolve(response.result)\n\t\t})\n\t})\n}\n\nconst save = (content) => {\n\tconsole.info('👉', 'API save')\n\treturn new Promise ((resolve, reject) => {\n\t\tconst request = gapi.client.request({\n\t\t\tpath: '/upload/drive/v2/files/' + fileId,\n\t\t\tmethod: 'PUT',\n\t\t\talt: 'media',\n\t\t\tbody: content,\n\t\t})\n\t\trequest.execute((response) => {\n\t\t\tif (response.error) {\n\t\t\t\treject(`Error during sync: ${response.error.message}`)\n\t\t\t\treturn\n\t\t\t}\n\t\t\tgetFileContent().then((fileContent) => {\n\t\t\t\tresolve(fileContent)\n\t\t\t})\n\t\t})\n\t})\n}\n\nexport {\n\tlogin,\n\tfetchData,\n\tinit,\n\tsave,\n\tisLogged,\n}\n","// @ts-check\nimport {\n\tlogin,\n\tfetchData,\n\tinit as initApi,\n\tsave as set,\n\tisLogged,\n} from '../../data-provider/google-drive/google-drive-api'\n\nlet _isEnabled = false;\n\nconst onLibLoaded = async (options) => {\n\tconst defaultOptions = {\n\t\tonSignInChange: () => {},\n\t\tonError: onError,\n\t\tdefaultContent: [],\n\t\t// TODO: apiKey, etc\n\t}\n\tawait initApi({...defaultOptions, ...options}).catch(console.error);\n}\n\nconst onError = (error) => {\n\talert(error)\n}\n\n/**\n * Get persons from local storage.\n */\nconst get = async () => {\n\tconsole.log('🔊', 'getting from grive')\n\tconst response = await fetchData();\n\tif (typeof response !== 'object') {\n\t\tonError('Unknown reposonse from server')\n\t\treturn null;\n\t}\n\tlet persons = {};\n\tif (Array.isArray(response)) {\n\t\t// temporal\n\t\tresponse.forEach(person => {\n\t\t\tpersons[person.id] = person;\n\t\t});\n\t} else {\n\t\tpersons = response.persons;\n\t}\n\tconst result = Object.keys(persons).reduce((all, id) => {\n\t\tall[id] = {\n\t\t\t...persons[id],\n\t\t\tname: unescape(persons[id].name),\n\t\t};\n\t\treturn all;\n\t}, {})\n\treturn {persons: result, updated: response.updated || 0};\n}\n\nconst init = async () => {\n\tconst response = await fetch('https://apis.google.com/js/api.js');\n\teval(await response.text());\n\tawait onLibLoaded();\n\t_isEnabled = true;\n}\n\nconst isEnabled = () => _isEnabled;\n\nexport default {\n\tinit,\n\tget,\n\tset,\n\tlogin,\n\tisLogged,\n\tisEnabled,\n}\n","// @ts-check\nimport useDataProviders from './data-provider/data-provider-middleware';\nimport * as store from './store/store'\nimport {setup as setupRouter} from './router/router'\nimport localStorage from './app/use-local-storage'\nimport {ACTIONS} from './app/app-action'\nimport googleDrive from './data-provider/google-drive/google-drive-model';\nimport './app/app.css'\n\n// import {createId} from './person/person-util'\n// const names = [\n// \t'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k',\n// ].forEach(name => {\n// \tstore.dispatch({type: 'person/save', payload: {\n// \t\tid: createId(name),\n// \t\tname: name,\n// \t\tbirthday: '2000-01-01',\n// \t}})\n// })\n\nwindow.store = store; // TODO: for debug only\nif (window.Cypress) {\n\t// For Cypress testing library\n\twindow.store = store\n}\n\n// useDataProviders([localStorage]);\nuseDataProviders([localStorage, googleDrive]);\n\nsetupRouter();\nstore.dispatch({type: ACTIONS.init});\n"]}