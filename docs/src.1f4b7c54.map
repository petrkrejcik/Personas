{"version":3,"sources":["src/google-drive-api.js","src/state.js","src/google-drive-model.js","src/persons-view.js","src/persons-model.js","src/overlay.js","src/index.js"],"names":["APP_FOLDER","onSignInChangeHandler","Function","onUpdateHandler","onErrorHandler","file","Object","init","options","setupOptions","Promise","resolve","reject","gapi","load","initClient","then","onError","onSignInChange","onUpdate","client","auth2","getAuthInstance","isSignedIn","listen","updateSignInStatus","get","isInitiated","isLogged","connect","fetchData","signIn","getFolder","findFile","foundFile","readFile","drive","files","list","q","execute","response","length","createFolder","id","metadata","name","mimeType","create","resource","console","info","folderId","fileId","alt","r","result","map","unescape","updateContent","content","request","path","method","body","error","message","listeners","state","googleSyncEnabled","persons","isLoading","getState","setState","newState","dispatchUpdate","forEach","listener","addListener","push","setup","update","getGoogleSyncButton","addEventListener","libLoaded","updatePersons","updateGoogleButton","alert","isEnabled","removeAttribute","document","querySelector","renderPersons","handleAdd","el","renderPerson","person","appendChild","renderAdd","index","createElement","classList","add","renderTitle","renderBirthday","birthday","age","daysToBirthday","renderSeen","seenBefore","resetSeen","renderCustomTexts","customTexts","filter","Boolean","field","value","renderText","innerHTML","days","personIndex","handleReset","button","innerText","bind","values","clearPersons","save","placeholder","view","personsView","getAge","getDaysToBirthday","getSeenBefore","seen","sort","sortByBirthday","addPerson","personA","personB","isoDay","now","Date","date","getTime","diff","Math","abs","getUTCFullYear","round","isoDate","nowYear","getMonth","getDate","ceil","diffNext","getValidationError","concat","match","i","year","month","padStart","day","ELEMENTS","overlay","selector","show","loader","singIn","showElement","element","style"],"mappings":"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","file":"src.1f4b7c54.map","sourceRoot":"..","sourcesContent":["const APP_FOLDER = 'App-Personas'\nlet onSignInChangeHandler = Function\nlet onUpdateHandler = Function\nlet onErrorHandler = Function\nlet file = Object\n\nconst init = (options = {}) => {\n\tsetupOptions(options)\n\treturn new Promise ((resolve, reject) => {\n\t\tgapi.load('client:auth2', () => {\n\t\t\tinitClient().then(resolve)\n\t\t})\n\t})\n}\n\nconst setupOptions = ({onError, onSignInChange, onUpdate}) => {\n\tif (onSignInChange) onSignInChangeHandler = onSignInChange\n\tif (onUpdate) onUpdateHandler = onUpdate\n\tif (onError) onErrorHandler = onError\n}\n\nconst initClient = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tgapi.client.init({\n\t\t\t'apiKey': 'AIzaSyBYItpNT8k2Y2AEHz2E2kI2EqMULh5C4m0',\n\t\t\t'discoveryDocs': ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],\n\t\t\t'clientId': '614338309616-st9nui22tf3sa1cm9m1l3nd439n50frg.apps.googleusercontent.com',\n\t\t\t'scope': 'https://www.googleapis.com/auth/drive.file'\n\t\t})\n\t\t.then(() => {\n\t\t\tgapi.auth2.getAuthInstance().isSignedIn.listen(updateSignInStatus)\n\t\t\tupdateSignInStatus(gapi.auth2.getAuthInstance().isSignedIn.get())\n\t\t\tresolve({isInitiated: true})\n\t\t})\n\t})\n}\n\nconst updateSignInStatus = (isLogged) => {\n\tonSignInChangeHandler(isLogged)\n}\n\nconst connect = () => {\n\tif (gapi.auth2.getAuthInstance().isSignedIn.get()) {\n\t\tfetchData()\n\t} else {\n\t\tgapi.auth2.getAuthInstance().signIn()\n\t}\n}\n\nconst fetchData = () => {\n\treturn getFolder()\n\t.then(findFile)\n\t.then((foundFile) => {\n\t\tfile = foundFile\n\t\treturn Promise.resolve()\n\t})\n\t.then(readFile)\n}\n\nconst getFolder = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst request = gapi.client.drive.files.list({\n\t\t\tq: `name='${APP_FOLDER}' and trashed=false`,\n\t\t})\n\n\t\trequest.execute((response) => {\n\t\t\tif (response.files.length === 0) {\n\t\t\t\tcreateFolder().then(resolve)\n\t\t\t} else {\n\t\t\t\tresolve(response.files[0].id)\n\t\t\t}\n\t\t})\n\t})\n}\n\nconst createFolder = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst metadata = {\n\t\t\tname: APP_FOLDER,\n\t\t\tmimeType: 'application/vnd.google-apps.folder'\n\t\t}\n\t\tconst request = gapi.client.drive.files.create({resource: metadata})\n\t\trequest.execute((response) => {\n\t\t\tconsole.info('ðŸ‘‰', 'created', response)\n\t\t\tresolve(response.id)\n\t\t})\n\t})\n}\n\nconst findFile = (folderId) => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst request = gapi.client.drive.files.list({\n\t\t\tq: `name=\"persons.json\" and '${folderId}' in parents`,\n\t\t})\n\t\trequest.execute((response) => {\n\t\t\tif (response.files.length === 0) {\n\t\t\t\t// create file\n\t\t\t\tresolve(null)\n\t\t\t} else {\n\t\t\t\tresolve(response.files[0])\n\t\t\t}\n\t\t})\n\t})\n}\n\nconst readFile = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst request = gapi.client.drive.files.get({\n\t\t\tfileId: file.id,\n\t\t\talt: 'media'\n\t\t})\n\t\trequest.execute((response) => {\n\t\t\tconst r = response.result.map(result => {\n\t\t\t\treturn {\n\t\t\t\t\t...result,\n\t\t\t\t\tname: unescape(result.name),\n\t\t\t\t}\n\t\t\t})\n\t\t\tresolve(r)\n\t\t})\n\t})\n}\n\nconst updateContent = (content) => {\n\tconst request = gapi.client.request({\n\t\tpath: '/upload/drive/v2/files/' + file.id,\n\t\tmethod: 'PUT',\n\t\talt: 'media',\n\t\tbody: content,\n\t})\n\trequest.execute((response) => {\n\t\tif (response.error) {\n\t\t\tonErrorHandler(`Error during sync: ${response.error.message}`)\n\t\t\treturn\n\t\t}\n\t\treadFile().then(onUpdateHandler)\n\t})\n}\n\nexport {\n\tconnect,\n\tfetchData,\n\tinit,\n\tupdateContent,\n}","const listeners = []\nlet state = {\n\tgoogleSyncEnabled: false,\n\tisSignedIn: false,\n\tpersons: [],\n\tisLoading: true,\n}\n\nconst getState = () => {\n\treturn state\n}\n\nconst setState = (newState) => {\n\tstate = {\n\t\t...state,\n\t\t...newState,\n\t}\n\tdispatchUpdate()\n}\n\nconst dispatchUpdate = () => {\n\tlisteners.forEach(listener => {\n\t\tlistener(getState())\n\t})\n}\n\nconst addListener = (listener) => {\n\tlisteners.push(listener)\n}\n\nexport {addListener, getState, dispatchUpdate, setState}\n","import {connect, fetchData, init} from './google-drive-api.js'\nimport {addListener, getState, setState} from './state.js'\n\nconst setup = () => {\n\taddListener(update)\n\tgetGoogleSyncButton().addEventListener('click', connect)\n}\n\nconst libLoaded = () => {\n\tconst options = {\n\t\tonSignInChange: onSignInChange,\n\t\tonUpdate: updatePersons,\n\t\tonError: onError,\n\t\t// TODO: apiKey, etc\n\t}\n\tinit(options).then((result) => {\n\t\tconst {isInitiated} = result\n\t\tsetState({'googleSyncEnabled': isInitiated})\n\t})\n}\n\nconst update = (state) => {\n\tupdateGoogleButton(state.googleSyncEnabled)\n}\n\nconst updatePersons = (persons) => {\n\tsetState({persons, isLoading: false})\n}\n\nconst onSignInChange = (isSignedIn) => {\n\tif (isSignedIn) {\n\t\tsetState({isSignedIn, isLoading: true})\n\t\tfetchData().then(updatePersons)\n\t} else {\n\t\tsetState({isSignedIn, isLoading: false})\n\t}\n}\n\nconst onError = (error) => {\n\tsetState({isLoading: false})\n\talert(error)\n}\n\nconst updateGoogleButton = (isEnabled) => {\n\tif (isEnabled) {\n\t\tgetGoogleSyncButton().removeAttribute('disabled')\n\t}\n}\n\nconst getGoogleSyncButton = () => {\n\treturn document.querySelector('button[data-prs=\"googleDriveButton\"]')\n}\n\nexport {libLoaded, setup}\n","import {getState, setState} from './state.js'\n\nconst renderPersons = (persons, handleAdd) => {\n\tconst el = document.querySelector('.persons')\n\tpersons\n\t\t.map(renderPerson)\n\t\t.forEach(person => el.appendChild(person))\n\tel.appendChild(renderAdd(handleAdd))\n}\n\nconst renderPerson = (person, index) => {\n\tconst el = document.createElement('div')\n\tel.classList.add('person')\n\tconst fields = [\n\t\trenderTitle(person.name),\n\t\trenderBirthday(person.birthday, person.age, person.daysToBirthday),\n\t\trenderSeen(person.seenBefore, index, person.resetSeen),\n\t\t...renderCustomTexts(person.customTexts),\n\t]\n\tfields\n\t.filter(Boolean)\n\t.forEach(field => el.appendChild(field))\n\treturn el\n}\n\nconst renderTitle = (value) => {\n\tconst el = renderText(value)\n\tel.classList.add('person-title')\n\treturn el\n}\n\nconst renderText = (value) => {\n\tconst el = document.createElement('div')\n\tel.innerHTML = value\n\treturn el\n}\n\nconst renderBirthday = (birthday, age, daysToBirthday) => {\n\tif (!birthday) return null\n\tconst el = document.createElement('div')\n\tel.innerHTML = `Age: ${age}<br />Birthday in ${daysToBirthday} days (${birthday})`\n\treturn el\n}\n\nconst renderSeen = (days, personIndex, handleReset) => {\n\tif (!days) return null\n\tconst el = document.createElement('div')\n\tconst button = document.createElement('button')\n\tbutton.classList.add('buttonSeen')\n\tbutton.innerText = 'Today'\n\tbutton.addEventListener('click', handleReset.bind(null, personIndex))\n\tel.innerHTML = `Seen before ${days} days`\n\tel.appendChild(button)\n\treturn el\n}\n\nconst renderCustomTexts = (values) => {\n\tif (!values) return []\n\treturn values.map(renderText)\n}\n\nconst clearPersons = () => {\n\tconst el = document.querySelector('.persons')\n\tel.innerHTML = ''\n}\n\nconst renderAdd = (handleAdd) => {\n\tconst el = document.createElement('div')\n\tconst name = document.createElement('input')\n\tconst birthday = document.createElement('input')\n\tconst save = document.createElement('button')\n\tname.placeholder = 'Name'\n\tbirthday.placeholder = 'Birthday (YYYY-MM-DD)'\n\tsave.innerHTML = 'Save'\n\tsave.addEventListener('click', () => {\n\t\thandleAdd(name.value, birthday.value)\n\t})\n\tel.appendChild(name)\n\tel.appendChild(birthday)\n\tel.appendChild(save)\n\treturn el\n}\n\nexport {clearPersons, renderPersons}\n","import {addListener, getState, setState} from './state.js'\nimport {updateContent} from './google-drive-api.js'\nimport * as view from './persons-view.js'\n\nconst setup = () => {\n\taddListener(update)\n}\n\nconst update = () => {\n\tupdatePersons()\n}\n\nconst updatePersons = () => {\n\tview.clearPersons()\n\trenderPersons(getState().persons)\n}\n\nconst renderPersons = (persons) => {\n\tconst personsView = persons\n\t\t.map(person => {\n\t\t\treturn {\n\t\t\t\t...person,\n\t\t\t\tage: getAge(person.birthday),\n\t\t\t\tdaysToBirthday: getDaysToBirthday(person.birthday),\n\t\t\t\tseenBefore: getSeenBefore(person.seen),\n\t\t\t\tresetSeen: resetSeen,\n\t\t\t}\n\t\t})\n\t\t.sort(sortByBirthday)\n\tview.renderPersons(personsView, addPerson)\n}\n\nconst sortByBirthday = (personA, personB) => {\n\tif (!personA.birthday || !personB.birthday) return 0\n\treturn getDaysToBirthday(personA.birthday) - getDaysToBirthday(personB.birthday)\n}\n\nconst getAge = (isoDay) => {\n\tif (!isoDay) return null\n\tconst now = Date.now()\n\tconst date = new Date(isoDay).getTime()\n\tconst diff = new Date(now - date)\n\tconst age = Math.abs(diff.getUTCFullYear() - 1970)\n\treturn age\n}\n\nconst getSeenBefore = (isoDay) => {\n\tif (!isoDay) return null\n\tconst now = Date.now()\n\tconst date = new Date(isoDay).getTime()\n\tconst days = Math.round((now - date) / 1000 / 60 / 60/ 24)\n\treturn days\n}\n\nconst getDaysToBirthday = (isoDate) => {\n\tif (!isoDate) return null\n\tconst birthday = new Date(isoDate)\n\tconst nowYear = new Date().getUTCFullYear()\n\tconst diff = Date.now() - new Date(`${nowYear}-${birthday.getMonth() + 1}-${birthday.getDate()}`).getTime()\n\tlet days\n\tif (diff < 0) {\n\t\t// this year\n\t\tdays = Math.abs(Math.ceil(diff / 1000 / 60 / 60 / 24))\n\t} else {\n\t\t// next year\n\t\tconst diffNext = Date.now() - new Date(`${nowYear + 1}-${birthday.getMonth() + 1}-${birthday.getDate()}`).getTime()\n\t\tdays = Math.abs(Math.ceil(diffNext / 1000 / 60 / 60 / 24))\n\t}\n\treturn days\n}\n\nconst addPerson = (name, birthday) => {\n\tconst error = getValidationError(name, birthday)\n\tif (error) {\n\t\talert(error)\n\t\treturn\n\t}\n\tsetState({isLoading: true})\n\tupdateContent(getState().persons.concat({name, birthday}))\n}\n\nconst getValidationError = (name, birthday) => {\n\tif (!name) {\n\t\treturn 'Empty name'\n\t}\n\tif (!birthday.match(/^\\d{4}-\\d{2}-\\d{2}$/)) {\n\t\treturn 'Wrong birthday format. Use YYYY-MM-DD.'\n\t}\n\treturn null\n}\n\nconst resetSeen = (personIndex) => {\n\tconst persons = getState().persons.map((person, i) => {\n\t\tif (i !== personIndex) return person\n\t\tconst now = new Date()\n\t\tconst year = now.getUTCFullYear()\n\t\tconst month = (now.getMonth() + 1 + '').padStart(2, '0')\n\t\tconst day = (now.getDate() + '').padStart(2, '0')\n\t\treturn {\n\t\t\t...person,\n\t\t\tseen: `${year}-${month}-${day}`,\n\t\t}\n\t})\n\tsetState({isLoading: true})\n\tupdateContent(persons)\n}\n\nexport {addPerson, resetSeen, setup}\n","import {addListener} from './state.js'\n\nconst ELEMENTS = {\n\toverlay: {\n\t\tselector: 'div[data-prs=\"overlay\"]',\n\t\tshow: 'flex',\n\t},\n\tloader: {\n\t\tselector: 'div[data-prs=\"loader\"]',\n\t\tshow: 'block',\n\t},\n\tsingIn: {\n\t\tselector: 'button[data-prs=\"googleDriveButton\"]',\n\t\tshow: 'block',\n\t},\n}\n\nconst update = (state) => {\n\tshowElement(ELEMENTS.loader, state.isLoading)\n\tshowElement(ELEMENTS.singIn, !state.isSignedIn)\n\tshowElement(ELEMENTS.overlay, state.isLoading || !state.isSignedIn)\n}\n\nconst showElement = (element, show) => {\n\tconst el = document.querySelector(element.selector)\n\tel.style['display'] = show ? element.show : 'none'\n}\n\nexport const setup = () => {\n\taddListener(update)\n}\n","import {libLoaded as googleLibLoaded, setup as setupGoogleDrive} from './google-drive-model.js'\nimport {setup as setupPersonModel} from './persons-model.js'\nimport {setup as setupOverlay} from './overlay.js'\n\nconst setup = () => {\n\tsetupGoogleDrive()\n\tsetupOverlay()\n\tsetupPersonModel()\n}\n\nexport {\n\tgoogleLibLoaded,\n\tsetup,\n}\n\n"]}