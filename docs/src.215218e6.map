{"version":3,"sources":["src/state.js","src/google-drive.js","src/google-model.js","src/persons-view.js","src/index.js"],"names":["listeners","state","googleSyncEnabled","getState","setState","newState","dispatchUpdate","forEach","listener","addListener","push","APP_FOLDER","init","Promise","resolve","reject","gapi","load","initClient","then","console","info","client","auth2","getAuthInstance","isSignedIn","listen","updateSigninStatus","get","loadFiles","co","currentUser","getFolder","findFile","readFile","drive","files","list","q","execute","response","length","createFolder","id","metadata","name","mimeType","create","resource","folderId","file","fileId","alt","r","result","map","decodeURIComponent","escape","connect","signIn","setup","update","getGoogleSyncButton","addEventListener","connectGoogle","updateGoogleButton","libLoaded","persons","isEnabled","removeAttribute","document","querySelector","renderPersons","el","renderPerson","person","appendChild","createElement","classList","add","renderText","renderBirthday","birthday","renderCustomTexts","customTexts","filter","Boolean","field","value","innerHTML","getRemainingDays","now","Date","date","getTime","diff","age","Math","abs","getUTCFullYear","nowYear","getMonth","getDate","days","ceil","diffNext","renderSeen","reset","round","button","innerText","values","clearPersons","updatePersons"],"mappings":"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","file":"src.215218e6.map","sourceRoot":"..","sourcesContent":["const listeners = []\nlet state = {\n\tgoogleSyncEnabled: false,\n}\n\nconst getState = () => {\n\treturn state\n}\n\nconst setState = (newState) => {\n\tstate = {\n\t\t...state,\n\t\t...newState,\n\t}\n\tdispatchUpdate()\n}\n\nconst dispatchUpdate = () => {\n\tlisteners.forEach(listener => {\n\t\tlistener(getState())\n\t})\n}\n\nconst addListener = (listener) => {\n\tlisteners.push(listener)\n}\n\nexport {addListener, getState, dispatchUpdate, setState}\n","const APP_FOLDER = 'App-Personas'\n\nconst init = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tgapi.load('client:auth2', () => {\n\t\t\tinitClient().then(resolve)\n\t\t})\n\t})\n}\n\nconst initClient = () => {\n\tconsole.info('ðŸ‘‰', 'init google client')\n\treturn new Promise ((resolve, reject) => {\n\t\tgapi.client.init({\n\t\t\t'apiKey': 'AIzaSyBYItpNT8k2Y2AEHz2E2kI2EqMULh5C4m0',\n\t\t\t'discoveryDocs': ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],\n\t\t\t'clientId': '614338309616-st9nui22tf3sa1cm9m1l3nd439n50frg.apps.googleusercontent.com',\n\t\t\t'scope': 'https://www.googleapis.com/auth/drive.file'\n\t\t})\n\t\t.then(() => {\n\t\t\tgapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus)\n\t\t\tif (gapi.auth2.getAuthInstance().isSignedIn.get()) {\n\t\t\t\tconsole.info('ðŸ‘‰', 'already logged')\n\t\t\t\tloadFiles().then(resolve)\n\t\t\t} else {\n\t\t\t\tresolve([])\n\t\t\t}\n\t\t})\n\t})\n}\n\nconst updateSigninStatus = (co) => {\n\tconsole.info('ðŸ‘‰', 'logged?', gapi.auth2.getAuthInstance().currentUser.get())\n}\n\nconst loadFiles = () => {\n\treturn getFolder()\n\t.then(findFile)\n\t.then(readFile)\n}\n\nconst getFolder = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst request = gapi.client.drive.files.list({\n\t\t\tq: `name='${APP_FOLDER}' and trashed=false`,\n\t\t})\n\n\t\trequest.execute((response) => {\n\t\t\tif (response.files.length === 0) {\n\t\t\t\tcreateFolder().then(resolve)\n\t\t\t} else {\n\t\t\t\tresolve(response.files[0].id)\n\t\t\t}\n\t\t})\n\t})\n}\n\nconst createFolder = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconsole.info('ðŸ‘‰', 'creating')\n\t\tconst metadata = {\n\t\t\tname: APP_FOLDER,\n\t\t\tmimeType: 'application/vnd.google-apps.folder'\n\t\t}\n\t\tconst request = gapi.client.drive.files.create({resource: metadata})\n\t\trequest.execute((response) => {\n\t\t\tconsole.info('ðŸ‘‰', 'created', response)\n\t\t\tresolve(response.id)\n\t\t})\n\t})\n}\n\nconst findFile = (folderId) => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconsole.info('ðŸ‘‰', 'folderId', folderId)\n\t\tconst request = gapi.client.drive.files.list({\n\t\t\tq: `name=\"persons.json\" and '${folderId}' in parents`,\n\t\t})\n\t\trequest.execute((response) => {\n\t\t\tconsole.info('ðŸ‘‰', 'find file response', response)\n\t\t\tif (response.files.length === 0) {\n\t\t\t\t// create file\n\t\t\t\tresolve(null)\n\t\t\t} else {\n\t\t\t\tresolve(response.files[0])\n\t\t\t}\n\t\t})\n\t})\n}\n\nconst readFile = (file) => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst request = gapi.client.drive.files.get({\n\t\t\tfileId: file.id,\n\t\t\talt: 'media'\n\t\t})\n\t\trequest.execute((response) => {\n\t\t\tconst r = response.result.map(result => {\n\t\t\t\treturn {\n\t\t\t\t\t...result,\n\t\t\t\t\tname: decodeURIComponent(escape(result.name)),\n\t\t\t\t}\n\t\t\t})\n\t\t\tresolve(r)\n\t\t})\n\t})\n}\n\nconst connect = () => {\n\tconsole.info('ðŸ‘‰', 'connect')\n\tif (gapi.auth2.getAuthInstance().isSignedIn.get()) {\n\t\tconsole.info('ðŸ‘‰', 'already logged')\n\t\tgapi.auth2.getAuthInstance().currentUser.get()\n\t\tloadFiles()\n\t} else {\n\t\tconsole.info('ðŸ‘‰', 'signign in...')\n\t\tgapi.auth2.getAuthInstance().signIn()\n\t}\n}\n\nexport {\n\tconnect,\n\tinit,\n}","import {\n\tconnect as connectGoogle,\n\tinit as googleInit\n} from './google-drive.js'\nimport {addListener, dispatchUpdate, getState, setState} from './state.js'\n\nconst setup = () => {\n\taddListener(update)\n\tgetGoogleSyncButton().addEventListener('click', connectGoogle)\n}\n\nconst update = (state) => {\n\tupdateGoogleButton(state.googleSyncEnabled)\n}\n\nconst libLoaded = () => {\n\tgoogleInit().then((persons) => {\n\t\tsetState({\n\t\t\t'googleSyncEnabled': true,\n\t\t\tpersons\n\t\t})\n\t})\n}\n\nconst updateGoogleButton = (isEnabled) => {\n\tif (isEnabled) {\n\t\tgetGoogleSyncButton().removeAttribute('disabled')\n\t}\n}\n\nconst getGoogleSyncButton = () => {\n\treturn document.querySelector('button[data-ps=\"googlePlusSync\"]')\n}\n\nexport {libLoaded, setup}\n","const renderPersons = (persons) => {\n\tconst el = document.querySelector('.persons')\n\tconst personsHtml = persons.map(renderPerson)\n\tpersonsHtml.forEach(person => el.appendChild(person))\n}\n\nconst renderPerson = (person) => {\n\tconst el = document.createElement('div')\n\tel.classList.add('person')\n\tconst fields = [\n\t\trenderText(person.name),\n\t\trenderBirthday(person.birthday),\n\t\t// renderSeen(person.seen),\n\t\t...renderCustomTexts(person.customTexts),\n\t]\n\tfields\n\t.filter(Boolean)\n\t.forEach(field => el.appendChild(field))\n\treturn el\n}\n\nconst renderText = (value) => {\n\tconst el = document.createElement('div')\n\tel.innerHTML = value\n\treturn el\n}\n\nconst renderBirthday = (value) => {\n\tconst getRemainingDays = () => {\n\t\tconst birthday = new Date(value)\n\t\tconst nowYear = new Date().getUTCFullYear()\n\t\tconst diff = Date.now() - new Date(`${nowYear}-${birthday.getMonth() + 1}-${birthday.getDate()}`).getTime()\n\t\tlet days\n\t\tif (diff < 0) {\n\t\t\t// this year\n\t\t\tdays = Math.abs(Math.ceil(diff / 1000 / 60 / 60 / 24))\n\t\t} else {\n\t\t\t// next year\n\t\t\tconst diffNext = Date.now() - new Date(`${nowYear + 1}-${birthday.getMonth() + 1}-${birthday.getDate()}`).getTime()\n\t\t\tdays = Math.abs(Math.ceil(diffNext / 1000 / 60 / 60 / 24))\n\t\t}\n\t\treturn days\n\t}\n\tconst now = Date.now()\n\tconst date = new Date(value).getTime()\n\tconst diff = new Date(now - date)\n\tconst age = Math.abs(diff.getUTCFullYear() - 1970)\n\tconst el = document.createElement('div')\n\tel.innerHTML = `Age: ${age}.<br />Birthday in ${getRemainingDays()} days (${value}).`\n\treturn el\n}\n\nconst renderSeen = (value) => {\n\tconst reset = () => {\n\t\tconsole.info('ðŸ‘‰', 'resettings')\n\t}\n\tconst now = Date.now()\n\tconst date = new Date(value).getTime()\n\tconst days = Math.round((now - date) / 1000 / 60 / 60/ 24)\n\tconst el = document.createElement('div')\n\tconst button = document.createElement('button')\n\tbutton.innerText = 'Dnes'\n\tbutton.addEventListener('click', reset)\n\tel.innerHTML = `VidÄ›li jsme se pÅ™ed: ${days} dny.`\n\tel.appendChild(button)\n\treturn el\n}\n\nconst renderCustomTexts = (values) => {\n\tif (!values) return []\n\treturn values.map(renderText)\n}\n\nconst clearPersons = () => {\n\tconst el = document.querySelector('.persons')\n\tel.innerHTML = ''\n}\n\nexport {clearPersons, renderPersons}\n","import {addListener} from './state.js'\nimport {libLoaded as googleLibLoaded, setup as googleSetup} from './google-model.js'\nimport {clearPersons, renderPersons} from './persons-view.js'\n\nconst setup = () => {\n\tgoogleSetup()\n\taddListener(update)\n}\n\nconst update = (state) => {\n\tupdatePersons(state.persons)\n}\nconst updatePersons = (persons) => {\n\tclearPersons()\n\trenderPersons(persons)\n}\n\nexport {\n\tgoogleLibLoaded,\n\tsetup,\n}\n\n"]}