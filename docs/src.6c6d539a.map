{"version":3,"sources":["src/google-drive-api.js","src/state.js","src/google-drive-model.js","src/persons-view.js","src/persons-model.js","src/overlay.js","src/index.js"],"names":["APP_FOLDER","onSignInChangeHandler","Function","onUpdateHandler","onErrorHandler","file","Object","init","options","setupOptions","Promise","resolve","reject","gapi","load","initClient","then","onError","onSignInChange","onUpdate","client","auth2","getAuthInstance","isSignedIn","listen","updateSignInStatus","get","isInitiated","isLogged","connect","fetchData","signIn","getFolder","findFile","foundFile","readFile","drive","files","list","q","execute","response","length","createFolder","id","metadata","name","mimeType","create","resource","console","info","folderId","fileId","alt","r","result","map","unescape","updateContent","content","request","path","method","body","error","message","listeners","state","googleSyncEnabled","persons","isLoading","view","editingPerson","getState","setState","newState","dispatchUpdate","forEach","listener","addListener","push","setup","update","getGoogleSyncButton","addEventListener","window","libLoaded","updatePersons","updateGoogleButton","person","Math","random","toString","substring","alert","isEnabled","removeAttribute","document","querySelector","renderPersons","handleAdd","el","renderPerson","appendChild","renderAdd","createElement","classList","add","renderTitle","renderBirthday","birthday","age","daysToBirthday","renderSeen","seenBefore","renderCustomTexts","customTexts","filter","Boolean","field","actions","edit","remove","innerText","handleEdit","bind","handleRemove","value","renderText","innerHTML","days","values","clearPersons","save","placeholder","personsView","getAge","getDaysToBirthday","getSeenBefore","seen","sort","sortByBirthday","addPerson","personA","personB","isoDay","now","Date","date","getTime","diff","abs","getUTCFullYear","round","isoDate","nowYear","getMonth","getDate","ceil","diffNext","getValidationError","concat","editPerson","match","resetSeen","year","month","padStart","day","ELEMENTS","overlay","selector","show","loader","singIn","showElement","includes","renderEdit","find","cancel","element","style"],"mappings":"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","file":"src.6c6d539a.map","sourceRoot":"..","sourcesContent":["const APP_FOLDER = 'App-Personas'\nlet onSignInChangeHandler = Function\nlet onUpdateHandler = Function\nlet onErrorHandler = Function\nlet file = Object\n\nconst init = (options = {}) => {\n\tsetupOptions(options)\n\treturn new Promise ((resolve, reject) => {\n\t\tgapi.load('client:auth2', () => {\n\t\t\tinitClient().then(resolve)\n\t\t})\n\t})\n}\n\nconst setupOptions = ({onError, onSignInChange, onUpdate}) => {\n\tif (onSignInChange) onSignInChangeHandler = onSignInChange\n\tif (onUpdate) onUpdateHandler = onUpdate\n\tif (onError) onErrorHandler = onError\n}\n\nconst initClient = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tgapi.client.init({\n\t\t\t'apiKey': 'AIzaSyBYItpNT8k2Y2AEHz2E2kI2EqMULh5C4m0',\n\t\t\t'discoveryDocs': ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],\n\t\t\t'clientId': '614338309616-st9nui22tf3sa1cm9m1l3nd439n50frg.apps.googleusercontent.com',\n\t\t\t'scope': 'https://www.googleapis.com/auth/drive.file'\n\t\t})\n\t\t.then(() => {\n\t\t\tgapi.auth2.getAuthInstance().isSignedIn.listen(updateSignInStatus)\n\t\t\tupdateSignInStatus(gapi.auth2.getAuthInstance().isSignedIn.get())\n\t\t\tresolve({isInitiated: true})\n\t\t})\n\t})\n}\n\nconst updateSignInStatus = (isLogged) => {\n\tonSignInChangeHandler(isLogged)\n}\n\nconst connect = () => {\n\tif (gapi.auth2.getAuthInstance().isSignedIn.get()) {\n\t\tfetchData()\n\t} else {\n\t\tgapi.auth2.getAuthInstance().signIn()\n\t}\n}\n\nconst fetchData = () => {\n\treturn getFolder()\n\t.then(findFile)\n\t.then((foundFile) => {\n\t\tfile = foundFile\n\t\treturn Promise.resolve()\n\t})\n\t.then(readFile)\n}\n\nconst getFolder = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst request = gapi.client.drive.files.list({\n\t\t\tq: `name='${APP_FOLDER}' and trashed=false`,\n\t\t})\n\n\t\trequest.execute((response) => {\n\t\t\tif (response.files.length === 0) {\n\t\t\t\tcreateFolder().then(resolve)\n\t\t\t} else {\n\t\t\t\tresolve(response.files[0].id)\n\t\t\t}\n\t\t})\n\t})\n}\n\nconst createFolder = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst metadata = {\n\t\t\tname: APP_FOLDER,\n\t\t\tmimeType: 'application/vnd.google-apps.folder'\n\t\t}\n\t\tconst request = gapi.client.drive.files.create({resource: metadata})\n\t\trequest.execute((response) => {\n\t\t\tconsole.info('ðŸ‘‰', 'created', response)\n\t\t\tresolve(response.id)\n\t\t})\n\t})\n}\n\nconst findFile = (folderId) => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst request = gapi.client.drive.files.list({\n\t\t\tq: `name=\"persons.json\" and '${folderId}' in parents`,\n\t\t})\n\t\trequest.execute((response) => {\n\t\t\tif (response.files.length === 0) {\n\t\t\t\t// create file\n\t\t\t\tresolve(null)\n\t\t\t} else {\n\t\t\t\tresolve(response.files[0])\n\t\t\t}\n\t\t})\n\t})\n}\n\nconst readFile = () => {\n\treturn new Promise ((resolve, reject) => {\n\t\tconst request = gapi.client.drive.files.get({\n\t\t\tfileId: file.id,\n\t\t\talt: 'media'\n\t\t})\n\t\trequest.execute((response) => {\n\t\t\tconst r = response.result.map(result => {\n\t\t\t\treturn {\n\t\t\t\t\t...result,\n\t\t\t\t\tname: unescape(result.name),\n\t\t\t\t}\n\t\t\t})\n\t\t\tresolve(r)\n\t\t})\n\t})\n}\n\nconst updateContent = (content) => {\n\tconst request = gapi.client.request({\n\t\tpath: '/upload/drive/v2/files/' + file.id,\n\t\tmethod: 'PUT',\n\t\talt: 'media',\n\t\tbody: content,\n\t})\n\trequest.execute((response) => {\n\t\tif (response.error) {\n\t\t\tonErrorHandler(`Error during sync: ${response.error.message}`)\n\t\t\treturn\n\t\t}\n\t\treadFile().then(onUpdateHandler)\n\t})\n}\n\nexport {\n\tconnect,\n\tfetchData,\n\tinit,\n\tupdateContent,\n}","const listeners = []\nlet state = {\n\tgoogleSyncEnabled: false,\n\tisSignedIn: false,\n\tpersons: [],\n\tisLoading: true,\n\tview: 'loading',\n\teditingPerson: null,\n}\n\nconst getState = () => {\n\treturn state\n}\n\nconst setState = (newState) => {\n\tstate = {\n\t\t...state,\n\t\t...newState,\n\t}\n\tdispatchUpdate()\n}\n\nconst dispatchUpdate = () => {\n\tlisteners.forEach(listener => {\n\t\tlistener(getState())\n\t})\n}\n\nconst addListener = (listener) => {\n\tlisteners.push(listener)\n}\n\nexport {addListener, getState, dispatchUpdate, setState}\n","import {connect, fetchData, init} from './google-drive-api.js'\nimport {addListener, getState, setState} from './state.js'\n\nconst setup = () => {\n\taddListener(update)\n\tgetGoogleSyncButton().addEventListener('click', connect)\n\twindow.getState = getState\n}\n\nconst libLoaded = () => {\n\tconst options = {\n\t\tonSignInChange: onSignInChange,\n\t\tonUpdate: updatePersons,\n\t\tonError: onError,\n\t\t// TODO: apiKey, etc\n\t}\n\tinit(options).then((result) => {\n\t\tconst {isInitiated} = result\n\t\tsetState({'googleSyncEnabled': isInitiated})\n\t})\n}\n\nconst update = (state) => {\n\tupdateGoogleButton(state.googleSyncEnabled)\n}\n\nconst updatePersons = (persons) => {\n\tpersons = persons.map(person => {\n\t\treturn {\n\t\t\t...person,\n\t\t\tid: Math.random().toString(36).substring(10),\n\t\t}\n\t})\n\tsetState({persons, view: 'persons'})\n}\n\nconst onSignInChange = (isSignedIn) => {\n\tif (isSignedIn) {\n\t\tsetState({isSignedIn, view: 'loading'})\n\t\tfetchData().then(updatePersons)\n\t} else {\n\t\tsetState({isSignedIn, view: 'signIn'})\n\t}\n}\n\nconst onError = (error) => {\n\tsetState({view: 'error'})\n\talert(error)\n}\n\nconst updateGoogleButton = (isEnabled) => {\n\tif (isEnabled) {\n\t\tgetGoogleSyncButton().removeAttribute('disabled')\n\t}\n}\n\nconst getGoogleSyncButton = () => {\n\treturn document.querySelector('button[data-prs=\"googleDriveButton\"]')\n}\n\nexport {libLoaded, setup}\n","const renderPersons = (persons, handleAdd) => {\n\tconst el = document.querySelector('.persons')\n\tpersons\n\t\t.map(renderPerson)\n\t\t.forEach(person => el.appendChild(person))\n\tel.appendChild(renderAdd(handleAdd))\n}\n\nconst renderPerson = (person) => {\n\tconst el = document.createElement('div')\n\tel.classList.add('person')\n\tconst fields = [\n\t\trenderTitle(person.name),\n\t\trenderBirthday(person.birthday, person.age, person.daysToBirthday),\n\t\trenderSeen(person.seenBefore),\n\t\t...renderCustomTexts(person.customTexts),\n\t]\n\tfields\n\t.filter(Boolean)\n\t.forEach(field => el.appendChild(field))\n\tconst actions = document.createElement('div')\n\tconst edit = document.createElement('button')\n\tconst remove = document.createElement('button')\n\tedit.innerText = 'Edit'\n\tremove.innerText = 'Remove'\n\tedit.addEventListener('click', person.handleEdit.bind(null, person.id))\n\tremove.addEventListener('click', person.handleRemove.bind(null, person.id))\n\tactions.appendChild(edit)\n\tactions.appendChild(remove)\n\tel.appendChild(actions)\n\treturn el\n}\n\nconst renderTitle = (value) => {\n\tconst el = renderText(value)\n\tel.classList.add('person-title')\n\treturn el\n}\n\nconst renderText = (value) => {\n\tconst el = document.createElement('div')\n\tel.innerHTML = value\n\treturn el\n}\n\nconst renderBirthday = (birthday, age, daysToBirthday) => {\n\tif (!birthday) return null\n\tconst el = document.createElement('div')\n\tel.innerHTML = `Age: ${age}<br />Birthday in ${daysToBirthday} days (${birthday})`\n\treturn el\n}\n\nconst renderSeen = (days) => {\n\tif (!days && days !== 0) return null\n\tconst el = document.createElement('div')\n\tconst button = document.createElement('button')\n\tel.innerHTML = `Seen before ${days} days`\n\treturn el\n}\n\nconst renderCustomTexts = (values) => {\n\tif (!values) return []\n\treturn values.map(renderText)\n}\n\nconst clearPersons = () => {\n\tconst el = document.querySelector('.persons')\n\tel.innerHTML = ''\n}\n\nconst renderAdd = (handleAdd) => {\n\tconst el = document.createElement('div')\n\tconst name = document.createElement('input')\n\tconst birthday = document.createElement('input')\n\tconst save = document.createElement('button')\n\tname.placeholder = 'Name'\n\tbirthday.placeholder = 'Birthday (YYYY-MM-DD)'\n\tsave.innerText = 'Save'\n\tsave.addEventListener('click', () => {\n\t\thandleAdd(name.value, birthday.value)\n\t})\n\tel.appendChild(name)\n\tel.appendChild(birthday)\n\tel.appendChild(save)\n\treturn el\n}\n\nexport {clearPersons, renderPersons}\n","import {addListener, getState, setState} from './state.js'\nimport {updateContent} from './google-drive-api.js'\nimport * as view from './persons-view.js'\n\nconst setup = () => {\n\taddListener(update)\n}\n\nconst update = () => {\n\tupdatePersons()\n}\n\nconst updatePersons = () => {\n\tview.clearPersons()\n\trenderPersons(getState().persons)\n}\n\nconst renderPersons = (persons) => {\n\tconst personsView = persons\n\t\t.map(person => {\n\t\t\treturn {\n\t\t\t\t...person,\n\t\t\t\tage: getAge(person.birthday),\n\t\t\t\tdaysToBirthday: getDaysToBirthday(person.birthday),\n\t\t\t\tseenBefore: getSeenBefore(person.seen),\n\t\t\t\thandleEdit: edit,\n\t\t\t\thandleRemove: remove,\n\t\t\t}\n\t\t})\n\t\t.sort(sortByBirthday)\n\tview.renderPersons(personsView, addPerson)\n}\n\nconst sortByBirthday = (personA, personB) => {\n\tif (!personA.birthday || !personB.birthday) return 0\n\treturn getDaysToBirthday(personA.birthday) - getDaysToBirthday(personB.birthday)\n}\n\nconst getAge = (isoDay) => {\n\tif (!isoDay) return null\n\tconst now = Date.now()\n\tconst date = new Date(isoDay).getTime()\n\tconst diff = new Date(now - date)\n\tconst age = Math.abs(diff.getUTCFullYear() - 1970)\n\treturn age\n}\n\nconst getSeenBefore = (isoDay) => {\n\tif (!isoDay) return null\n\tconst now = Date.now()\n\tconst date = new Date(isoDay).getTime()\n\tconst days = Math.round((now - date) / 1000 / 60 / 60/ 24)\n\treturn days\n}\n\nconst getDaysToBirthday = (isoDate) => {\n\tif (!isoDate) return null\n\tconst birthday = new Date(isoDate)\n\tconst nowYear = new Date().getUTCFullYear()\n\tconst diff = Date.now() - new Date(`${nowYear}-${birthday.getMonth() + 1}-${birthday.getDate()}`).getTime()\n\tlet days\n\tif (diff < 0) {\n\t\t// this year\n\t\tdays = Math.abs(Math.ceil(diff / 1000 / 60 / 60 / 24))\n\t} else {\n\t\t// next year\n\t\tconst diffNext = Date.now() - new Date(`${nowYear + 1}-${birthday.getMonth() + 1}-${birthday.getDate()}`).getTime()\n\t\tdays = Math.abs(Math.ceil(diffNext / 1000 / 60 / 60 / 24))\n\t}\n\treturn days\n}\n\nconst addPerson = (name, birthday) => {\n\tconst error = getValidationError(name, birthday)\n\tif (error) {\n\t\talert(error)\n\t\treturn\n\t}\n\tsetState({view: 'loading'})\n\tupdateContent(getState().persons.concat({name, birthday}))\n}\n\nconst editPerson = (id, name, birthday) => {\n\tconst error = getValidationError(name, birthday)\n\tif (error) {\n\t\talert(error)\n\t\treturn\n\t}\n\tconst persons = getState().persons.map(person => {\n\t\tif (person.id !== id) return person\n\t\treturn {\n\t\t\t...person,\n\t\t\tname,\n\t\t\tbirthday\n\t\t}\n\t})\n\tsetState({view: 'loading'})\n\tupdateContent(persons)\n}\n\nconst getValidationError = (name, birthday) => {\n\tif (!name) {\n\t\treturn 'Empty name'\n\t}\n\tif (!birthday.match(/^\\d{4}-\\d{2}-\\d{2}$/)) {\n\t\treturn 'Wrong birthday format. Use YYYY-MM-DD.'\n\t}\n\treturn null\n}\n\nconst resetSeen = (id) => {\n\tconst persons = getState().persons.map((person) => {\n\t\tif (id !== person.id) return person\n\t\tconst now = new Date()\n\t\tconst year = now.getUTCFullYear()\n\t\tconst month = (now.getMonth() + 1 + '').padStart(2, '0')\n\t\tconst day = (now.getDate() + '').padStart(2, '0')\n\t\treturn {\n\t\t\t...person,\n\t\t\tseen: `${year}-${month}-${day}`,\n\t\t}\n\t})\n\tsetState({view: 'loading'})\n\tupdateContent(persons)\n}\n\nconst edit = (id) => {\n\tsetState({view: 'edit', editingPerson: id})\n}\nconst remove = (id) => {\n\t// TODO\n}\n\nexport {editPerson, resetSeen, setup}\n","import {addListener} from './state.js'\nimport {setState} from './state.js'\nimport {editPerson, resetSeen} from './persons-model.js'\n\nconst ELEMENTS = {\n\toverlay: {\n\t\tselector: 'div[data-prs=\"overlay\"]',\n\t\tshow: 'flex',\n\t},\n\tloader: {\n\t\tselector: 'div[data-prs=\"loader\"]',\n\t\tshow: 'block',\n\t},\n\tsingIn: {\n\t\tselector: 'button[data-prs=\"googleDriveButton\"]',\n\t\tshow: 'block',\n\t},\n\tedit: {\n\t\tselector: 'div[data-prs=\"edit\"]',\n\t\tshow: 'block',\n\t},\n}\n\nconst update = (state) => {\n\tshowElement(ELEMENTS.loader, state.view === 'loading')\n\tshowElement(ELEMENTS.singIn, state.view === 'signIn')\n\tshowElement(ELEMENTS.edit, state.view === 'edit')\n\tshowElement(ELEMENTS.overlay, ['loading', 'edit', 'signIn'].includes(state.view))\n\tconsole.info('ðŸ‘‰', 'state.editingPerson', state.editingPerson)\n\tif (state.view === 'edit' && state.editingPerson) {\n\t\trenderEdit(state.persons.find(({id}) => id === state.editingPerson))\n\t}\n}\n\nconst renderEdit = (person) => {\n\tconst el = document.querySelector(ELEMENTS.edit.selector)\n\tel.innerHTML = ''\n\tconst name = document.createElement('input')\n\tconst birthday = document.createElement('input')\n\tconst save = document.createElement('button')\n\tconst seen = document.createElement('button')\n\tconst cancel = document.createElement('button')\n\tsave.innerText = 'Save'\n\tseen.innerText = 'Seen today'\n\tcancel.innerText = 'Cancel'\n\tname.value = person.name\n\tbirthday.value = person.birthday\n\tsave.addEventListener('click', () => {\n\t\teditPerson(person.id, name.value, birthday.value)\n\t})\n\tseen.addEventListener('click', () => {\n\t\tresetSeen(person.id)\n\t})\n\tcancel.addEventListener('click', () => {\n\t\tsetState({view: 'persons', editingPerson: null})\n\t})\n\tel.appendChild(name)\n\tel.appendChild(birthday)\n\tel.appendChild(save)\n\tel.appendChild(seen)\n\tel.appendChild(cancel)\n}\n\nconst showElement = (element, show) => {\n\tconst el = document.querySelector(element.selector)\n\tel.style['display'] = show ? element.show : 'none'\n}\n\nexport const setup = () => {\n\taddListener(update)\n}\n","import {libLoaded as googleLibLoaded, setup as setupGoogleDrive} from './google-drive-model.js'\nimport {setup as setupPersonModel} from './persons-model.js'\nimport {setup as setupOverlay} from './overlay.js'\n\nconst setup = () => {\n\tsetupGoogleDrive()\n\tsetupOverlay()\n\tsetupPersonModel()\n}\n\nexport {\n\tgoogleLibLoaded,\n\tsetup,\n}\n\n"]}